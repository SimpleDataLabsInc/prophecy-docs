"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[32045],{3717:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>d,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"analysts/development/gems/prepare/find-duplicates","title":"FindDuplicates","description":"Return rows that match a certain count","source":"@site/docs/analysts/development/gems/prepare/find-duplicates.md","sourceDirName":"analysts/development/gems/prepare","slug":"/analysts/find-duplicates","permalink":"/analysts/find-duplicates","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"gems","permalink":"/tags/gems"},{"inline":true,"label":"analyst","permalink":"/tags/analyst"},{"inline":true,"label":"prepare","permalink":"/tags/prepare"}],"version":"current","frontMatter":{"title":"FindDuplicates","id":"find-duplicates","slug":"/analysts/find-duplicates","description":"Return rows that match a certain count","tags":["gems","analyst","prepare"]},"sidebar":"mySidebar","previous":{"title":"Filter","permalink":"/analysts/filter"},"next":{"title":"FlattenSchema","permalink":"/analysts/flatten-schema"}}');var r=s(74848),i=s(28453),l=s(82824);const d={title:"FindDuplicates",id:"find-duplicates",slug:"/analysts/find-duplicates",description:"Return rows that match a certain count",tags:["gems","analyst","prepare"]},c=void 0,o={},h=[{value:"Input and Output",id:"input-and-output",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Unique rows generation scope",id:"unique-rows-generation-scope",level:3},{value:"Configure Grouping and Sorting",id:"configure-grouping-and-sorting",level:3},{value:"Output records selection strategy",id:"output-records-selection-strategy",level:3},{value:"Unique",id:"unique",level:4},{value:"Duplicate",id:"duplicate",level:4},{value:"Custom group count",id:"custom-group-count",level:4},{value:"Custom row number",id:"custom-row-number",level:4},{value:"Example: Custom group count",id:"example-custom-group-count",level:2},{value:"Example: Custom row number",id:"example-custom-row-number",level:2}];function a(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.A,{execution_engine:"SQL Warehouse",sql_package_name:"ProphecyDatabricksSqlBasics",sql_package_version:"0.0.12+"}),"\n",(0,r.jsx)(n.p,{children:"The FindDuplicates gem filters rows in a dataset based on how frequently they appear. You can configure the gem to return the first occurrence of each unique group, identify groups that have duplicates, or apply custom filters based on group frequency or row position within groups."}),"\n",(0,r.jsx)(n.h2,{id:"input-and-output",children:"Input and Output"}),"\n",(0,r.jsx)(n.p,{children:"The FindDuplicates gem accepts the following input and generates one output."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Port"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"in0"})}),(0,r.jsx)(n.td,{children:"Input dataset to evaluate for duplicates."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"out"})}),(0,r.jsx)(n.td,{children:"Output dataset with rows filtered according to the selected uniqueness and count criteria."})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsx)(n.p,{children:"Configure the FindDuplicates gem using the following parameters."}),"\n",(0,r.jsx)(n.h3,{id:"unique-rows-generation-scope",children:"Unique rows generation scope"}),"\n",(0,r.jsx)(n.p,{children:"Choose how to identify duplicates in your dataset."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Uniqueness across all columns"}),": Considers the entire row when checking for uniqueness. Use this option when you want to find rows that are completely identical across every column."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Uniqueness across selected columns"}),": Considers only specific columns when checking for uniqueness. Use this option when you want to find duplicates based on specific business keys or field combinations."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configure-grouping-and-sorting",children:"Configure Grouping and Sorting"}),"\n",(0,r.jsxs)(n.p,{children:["Complete this step only if you selected ",(0,r.jsx)(n.strong,{children:"Uniqueness across selected columns"}),"."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Group By Columns"}),": Select the columns that determine whether rows are considered duplicates. For example, to find duplicate customer accounts, select the ",(0,r.jsx)(n.code,{children:"email"})," column."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Order rows within each group (Optional)"}),": Select columns to sort by and specify the sort order (ascending or descending). When multiple duplicates exist, this controls which row appears first in the results."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"output-records-selection-strategy",children:"Output records selection strategy"}),"\n",(0,r.jsx)(n.p,{children:"Choose what to include in the output results. For each strategy, if you did not define a group, the dataset is grouped by all columns (groups consist of complete row matches)."}),"\n",(0,r.jsx)(n.h4,{id:"unique",children:"Unique"}),"\n",(0,r.jsx)(n.p,{children:"Returns the first row in each group. All other rows in the group are considered duplicates and are excluded."}),"\n",(0,r.jsx)(n.h4,{id:"duplicate",children:"Duplicate"}),"\n",(0,r.jsx)(n.p,{children:"Returns all rows in a group except the first one. This is the inverse of Unique."}),"\n",(0,r.jsx)(n.h4,{id:"custom-group-count",children:"Custom group count"}),"\n",(0,r.jsx)(n.p,{children:"Filters rows based on how many times each group appears."}),"\n",(0,r.jsx)(n.p,{children:"Select a filter type:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Group count equal to"}),": Returns rows that appear exactly ",(0,r.jsx)(n.code,{children:"n"})," times"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Group count less than"}),": Returns rows that appear fewer than ",(0,r.jsx)(n.code,{children:"n"})," times"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Group count greater than"}),": Returns rows that appear more than ",(0,r.jsx)(n.code,{children:"n"})," times"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Group count not equal to"}),": Returns rows whose count differs from ",(0,r.jsx)(n.code,{children:"n"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Group count between"}),": Returns rows with count within a specified range"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["In the ",(0,r.jsx)(n.strong,{children:"Grouped count"})," field, specify the count value ",(0,r.jsx)(n.code,{children:"n"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"custom-row-number",children:"Custom row number"}),"\n",(0,r.jsx)(n.p,{children:"Filters rows based on position within each group."}),"\n",(0,r.jsx)(n.p,{children:"Select a filter type:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Row number equal to"}),": Returns only the row with the specified position"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Row number less than"}),": Returns rows with a position less than ",(0,r.jsx)(n.code,{children:"n"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Row number greater than"}),": Returns rows with a position greater than ",(0,r.jsx)(n.code,{children:"n"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Row number not equal to"}),": Returns all rows except the one with the specified position"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Row number between"}),": Returns rows with a position within a specified range"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["In the ",(0,r.jsx)(n.strong,{children:"Row number"})," field, specify the position value."]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Row numbering starts at 1 for each group."})}),"\n",(0,r.jsx)(n.h2,{id:"example-custom-group-count",children:"Example: Custom group count"}),"\n",(0,r.jsx)(n.p,{children:"Given the following product catalog dataset:"}),"\n",(0,r.jsx)("div",{class:"table-example",children:(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"product_id"}),(0,r.jsx)(n.th,{children:"category"}),(0,r.jsx)(n.th,{children:"region"}),(0,r.jsx)(n.th,{children:"last_updated"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"001"}),(0,r.jsx)(n.td,{children:"laptop"}),(0,r.jsx)(n.td,{children:"us-east"}),(0,r.jsx)(n.td,{children:"2024-01-01"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"002"}),(0,r.jsx)(n.td,{children:"tablet"}),(0,r.jsx)(n.td,{children:"us-east"}),(0,r.jsx)(n.td,{children:"2024-01-02"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"003"}),(0,r.jsx)(n.td,{children:"laptop"}),(0,r.jsx)(n.td,{children:"us-east"}),(0,r.jsx)(n.td,{children:"2024-01-15"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"004"}),(0,r.jsx)(n.td,{children:"laptop"}),(0,r.jsx)(n.td,{children:"us-west"}),(0,r.jsx)(n.td,{children:"2024-01-03"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"005"}),(0,r.jsx)(n.td,{children:"laptop"}),(0,r.jsx)(n.td,{children:"us-east"}),(0,r.jsx)(n.td,{children:"2024-01-20"})]})]})]})}),"\n",(0,r.jsx)(n.p,{children:"If you configure the gem with the following settings:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Group by"}),": ",(0,r.jsx)(n.code,{children:"category"}),", ",(0,r.jsx)(n.code,{children:"region"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Order by"}),": ",(0,r.jsx)(n.code,{children:"last_updated"})," (descending)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Output strategy"}),": Custom group count equal to 3"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The gem creates the following groups:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"laptop"})," + ",(0,r.jsx)(n.code,{children:"us-east"}),": 3 occurrences"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tablet"})," + ",(0,r.jsx)(n.code,{children:"us-east"}),": 1 occurrence"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"laptop"})," + ",(0,r.jsx)(n.code,{children:"us-west"}),": 1 occurrence"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The output returns rows ",(0,r.jsx)(n.code,{children:"005"}),", ",(0,r.jsx)(n.code,{children:"003"}),", and ",(0,r.jsx)(n.code,{children:"001"})," (laptop in us-east group) because this group appears exactly 3 times. The rows are ordered by most recent update date first."]}),"\n",(0,r.jsx)(n.h2,{id:"example-custom-row-number",children:"Example: Custom row number"}),"\n",(0,r.jsx)(n.p,{children:"Given the following sales transactions dataset:"}),"\n",(0,r.jsx)("div",{class:"table-example",children:(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"transaction_id"}),(0,r.jsx)(n.th,{children:"customer_id"}),(0,r.jsx)(n.th,{children:"date"}),(0,r.jsx)(n.th,{children:"amount"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"T001"}),(0,r.jsx)(n.td,{children:"C101"}),(0,r.jsx)(n.td,{children:"2024-01-05"}),(0,r.jsx)(n.td,{children:"120.00"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"T002"}),(0,r.jsx)(n.td,{children:"C101"}),(0,r.jsx)(n.td,{children:"2024-02-10"}),(0,r.jsx)(n.td,{children:"250.00"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"T003"}),(0,r.jsx)(n.td,{children:"C102"}),(0,r.jsx)(n.td,{children:"2024-01-07"}),(0,r.jsx)(n.td,{children:"75.00"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"T004"}),(0,r.jsx)(n.td,{children:"C101"}),(0,r.jsx)(n.td,{children:"2024-03-15"}),(0,r.jsx)(n.td,{children:"300.00"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"T005"}),(0,r.jsx)(n.td,{children:"C102"}),(0,r.jsx)(n.td,{children:"2024-02-20"}),(0,r.jsx)(n.td,{children:"150.00"})]})]})]})}),"\n",(0,r.jsx)(n.p,{children:"If you configure the gem with the following settings:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Group by"}),": ",(0,r.jsx)(n.code,{children:"customer_id"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Order by"}),": ",(0,r.jsx)(n.code,{children:"date"})," (descending)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Output strategy"}),": Row number greater than 1"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The gem creates the following groups:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"C101"}),": 3 occurrences"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"C102"}),": 2 occurrences"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The output keeps only rows whose position in the sorted order within their group is greater than 1."}),"\n",(0,r.jsx)("div",{class:"table-example",children:(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"transaction_id"}),(0,r.jsx)(n.th,{children:"customer_id"}),(0,r.jsx)(n.th,{children:"date"}),(0,r.jsx)(n.th,{children:"amount"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"T002"}),(0,r.jsx)(n.td,{children:"C101"}),(0,r.jsx)(n.td,{children:"2024-02-10"}),(0,r.jsx)(n.td,{children:"250.00"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"T001"}),(0,r.jsx)(n.td,{children:"C101"}),(0,r.jsx)(n.td,{children:"2024-01-05"}),(0,r.jsx)(n.td,{children:"120.00"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"T003"}),(0,r.jsx)(n.td,{children:"C102"}),(0,r.jsx)(n.td,{children:"2024-01-07"}),(0,r.jsx)(n.td,{children:"75.00"})]})]})]})}),"\n",(0,r.jsx)(n.p,{children:"This output excludes the first (most recent) transaction from each customer group and returns all remaining transactions. Groups with only one row would not appear in the results."})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var t=s(96540);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}},82824:(e,n,s)=>{s.d(n,{A:()=>r});s(96540);var t=s(74848);function r(e){return(0,t.jsxs)("div",{children:[e.execution_engine&&(0,t.jsx)("a",{href:"https://docs.prophecy.io/administration/fabrics/prophecy-fabrics/",children:(0,t.jsx)("span",{className:"badge badge-runtime",children:e.execution_engine})}),e.sql_package_name&&e.sql_package_version&&(0,t.jsx)("a",{href:"https://docs.prophecy.io/engineers/package-hub/",children:(0,t.jsxs)("span",{className:"badge badge-dependency",children:[e.sql_package_name," ",e.sql_package_version]})}),(0,t.jsx)("br",{}),(0,t.jsx)("br",{})]})}}}]);