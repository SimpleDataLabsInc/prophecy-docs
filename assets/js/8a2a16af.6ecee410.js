"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[94301],{21970:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"administration/self-hosted/bring-your-own-spark","title":"Bring your own Spark (BYOS)","description":"Use your own Spark services in your Prophecy deployment","source":"@site/docs/administration/self-hosted/byos.md","sourceDirName":"administration/self-hosted","slug":"/administration/self-hosted/bring-your-own-spark","permalink":"/administration/self-hosted/bring-your-own-spark","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"spark","permalink":"/tags/spark"},{"inline":true,"label":"self-hosted","permalink":"/tags/self-hosted"}],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Bring your own Spark (BYOS)","sidebar_label":"Bring your own Spark","id":"bring-your-own-spark","description":"Use your own Spark services in your Prophecy deployment","sidebar_position":4,"tags":["spark","self-hosted"]},"sidebar":"adminSidebar","previous":{"title":"Sandbox Configuration","permalink":"/administration/self-hosted/configurations/sandbox-configuration"},"next":{"title":"Upgrades and backups","permalink":"/administration/self-hosted/upgrade-backup-restore"}}');var s=r(74848),o=r(28453);const t={title:"Bring your own Spark (BYOS)",sidebar_label:"Bring your own Spark",id:"bring-your-own-spark",description:"Use your own Spark services in your Prophecy deployment",sidebar_position:4,tags:["spark","self-hosted"]},a=void 0,l={},d=[{value:"Code Understanding Module",id:"code-understanding-module",level:2},{value:"Prerequisites for BYOS",id:"prerequisites-for-byos",level:2},{value:"Set up BYOS",id:"set-up-byos",level:2},{value:"Download Spark libraries",id:"download-spark-libraries",level:3},{value:"Enable environment settings",id:"enable-environment-settings",level:3},{value:"Update Athena environment variables",id:"update-athena-environment-variables",level:3},{value:"Restart services",id:"restart-services",level:3},{value:"Update Prophecy deployment",id:"update-prophecy-deployment",level:3}];function p(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Prophecy services utilize various Spark libraries, and Prophecy consistently updates these libraries with the latest available versions. However, some organizations prefer to bring their own commercially supported Spark distribution to their self-hosted Prophecy deployment. This page describes why Prophecy uses Spark, and how you can Bring your own Spark (BYOS) to your Prophecy deployment."}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Bring your own Spark only applies to the various Spark libraries used for ",(0,s.jsx)(n.strong,{children:"services in the Prophecy deployment"}),". The Spark you use in a fabric for pipeline execution is separate from BYOS."]})}),"\n",(0,s.jsx)(n.h2,{id:"code-understanding-module",children:"Code Understanding Module"}),"\n",(0,s.jsx)(n.p,{children:"Prophecy uses Spark primarily for the Code Understanding Module in the Prophecy deployment. This module enables:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Detecting code issues"}),"\n",(0,s.jsx)(n.li,{children:"Previewing transformation schemas"}),"\n",(0,s.jsx)(n.li,{children:"Computing column-level lineage"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These capabilities run instantaneously during pipeline development, so you don't have to wait until Prophecy compiles or executes your project code."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites-for-byos",children:"Prerequisites for BYOS"}),"\n",(0,s.jsx)(n.p,{children:"Review the following prerequisites for BYOS."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"BYOS only applies to self-hosted deployments."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The following Spark versions have been validated for BYOS:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Apache Spark: 3.5.x (recommended: 3.5.1)"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Databricks Spark: 3.5.x (recommended: 3.5.0)"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"set-up-byos",children:"Set up BYOS"}),"\n",(0,s.jsx)(n.h3,{id:"download-spark-libraries",children:"Download Spark libraries"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Download Spark libraries from your preferred source."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Extract the archive on your local machine."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Locate the ",(0,s.jsx)(n.code,{children:"jars"})," folder."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Upload the files into the ",(0,s.jsx)(n.code,{children:"pkg-manager"})," pod."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl -n <namespace> cp jars/* <pkg-manager-pod-name>:/prophecy/sparklibs --retries=-1\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"enable-environment-settings",children:"Enable environment settings"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Ensure the package manager is enabled in your environment."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Make sure the ",(0,s.jsx)(n.code,{children:"prophecyinit"})," image matching your Prophecy version is available in your container registry. The ",(0,s.jsx)(n.code,{children:"prophecyinit"})," image tag may change across releases. Verify that the image corresponding to your Prophecy version is present in your registry."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"update-athena-environment-variables",children:"Update Athena environment variables"}),"\n",(0,s.jsx)(n.p,{children:"Update Athena with the following environment variables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'- name: ENABLE_SLIM_IMAGES\n  value: "true"\n- name: IMAGE_REGISTRY\n  value: <your-image-registry>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"restart-services",children:"Restart services"}),"\n",(0,s.jsx)(n.p,{children:"Once the Spark libraries have been uploaded, restart the necessary pods:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"app / metagraph / edweb / sparkedge / transpiler / edwed / execution\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will allow all services to initialize with the custom Spark libraries."}),"\n",(0,s.jsx)(n.h3,{id:"update-prophecy-deployment",children:"Update Prophecy deployment"}),"\n",(0,s.jsxs)(n.p,{children:["The final step is to upgrade your Prophecy deployment to a version that includes BYOS image support. During the upgrade, ensure ",(0,s.jsx)(n.strong,{children:"no-rollback"})," is selected."]})]})}function c(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>a});var i=r(96540);const s={},o=i.createContext(s);function t(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);