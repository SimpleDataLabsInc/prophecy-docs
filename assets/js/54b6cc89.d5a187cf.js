"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[99935],{28453:(e,i,r)=>{r.d(i,{R:()=>l,x:()=>a});var n=r(96540);const s={},o=n.createContext(s);function l(e){const i=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),n.createElement(o.Provider,{value:i},e.children)}},34188:(e,i,r)=>{r.r(i),r.d(i,{assets:()=>t,contentTitle:()=>a,default:()=>d,frontMatter:()=>l,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"administration/fabrics/Spark-fabrics/databricks/volumes-plibs","title":"Set up Prophecy libraries in Databricks volumes","description":"Add ProphecyLibs directly to volumes when Maven/PyPI is blocked on Databricks","source":"@site/docs/administration/fabrics/Spark-fabrics/databricks/volumns-plibs.md","sourceDirName":"administration/fabrics/Spark-fabrics/databricks","slug":"/admin/dbx-volumes-plibs","permalink":"/admin/dbx-volumes-plibs","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"unity catalog","permalink":"/tags/unity-catalog"},{"inline":true,"label":"databricks","permalink":"/tags/databricks"},{"inline":true,"label":"plibs","permalink":"/tags/plibs"}],"version":"current","frontMatter":{"title":"Set up Prophecy libraries in Databricks volumes","sidebar_label":"ProphecyLibs in volumes","id":"volumes-plibs","slug":"/admin/dbx-volumes-plibs","description":"Add ProphecyLibs directly to volumes when Maven/PyPI is blocked on Databricks","tags":["unity catalog","databricks","plibs"]},"sidebar":"adminSidebar","previous":{"title":"Allowlist ProphecyLibs","permalink":"/admin/dbx-whitelist-plibs"},"next":{"title":"Prophecy-managed","permalink":"/engineers/prophecy-managed-fabric"}}');var s=r(74848),o=r(28453);const l={title:"Set up Prophecy libraries in Databricks volumes",sidebar_label:"ProphecyLibs in volumes",id:"volumes-plibs",slug:"/admin/dbx-volumes-plibs",description:"Add ProphecyLibs directly to volumes when Maven/PyPI is blocked on Databricks",tags:["unity catalog","databricks","plibs"]},a=void 0,t={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Prepare a Databricks volume",id:"prepare-a-databricks-volume",level:2},{value:"Upload Prophecy libraries",id:"upload-prophecy-libraries",level:2},{value:"Update fabric configuration",id:"update-fabric-configuration",level:2},{value:"Whitelist for UC standard clusters",id:"whitelist-for-uc-standard-clusters",level:2}];function p(e){const i={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.p,{children:"If Maven or PyPI is blocked in your Databricks environment, you can add Prophecy libraries directly to Databricks volumes."}),"\n",(0,s.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(i.p,{children:"Before you set up Prophecy libraries in a Databricks volume, you need to know which library version your project uses. That version must be present in the volume for the setup to work."}),"\n",(0,s.jsx)(i.p,{children:"To check your project\u2019s Prophecy library version:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Open your project metadata."}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click on the ",(0,s.jsx)(i.strong,{children:"Dependencies"})," tab."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Find the relevant Prophecy library (Scala or Python) and note the version."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.admonition,{type:"note",children:(0,s.jsxs)(i.p,{children:["If using ProphecyLibsScala, you can look up versions on ",(0,s.jsx)(i.a,{href:"https://mvnrepository.com/artifact/io.prophecy/prophecy-libs",children:"Maven Repository"})," that are compatible with your Spark version."]})}),"\n",(0,s.jsx)(i.h2,{id:"prepare-a-databricks-volume",children:"Prepare a Databricks volume"}),"\n",(0,s.jsx)(i.p,{children:"To get started, you'll need to define a Databricks volume where you will store the Prophecy libraries."}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Create a volume in your workspace where you'll maintain Prophecy libraries:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"databricks volumes create --name prophecy-libs --storage-location <your-volume-location>\n"})}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Download ",(0,s.jsx)(i.a,{href:"https://pypi.org/project/pyhocon/",children:"pyhocon"})," from PyPI or an internal artifactory."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Upload the dependency to the volumes path."}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"databricks fs cp pyhocon-0.3.61-py3-none-any.whl /Volumes/<your-volume-location>/prophecy-libs/\n"})}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Create a local Init Script. For example, create ",(0,s.jsx)(i.code,{children:"install_pyhocon.sh"})," with the following content:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"#!/bin/bash\npip install /Volumes/<your-volume-location>/prophecy-libs/pyhocon-0.3.61-py3-none-any.whl\n"})}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Upload the script to your volumes path."}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"databricks fs cp install_pyhocon.sh /Volumes/<your-volume-location>/prophecy-libs/\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"upload-prophecy-libraries",children:"Upload Prophecy libraries"}),"\n",(0,s.jsxs)(i.p,{children:["Download the appropriate Prophecy library versions from the public buckets and upload them to the same volume path. Replace ",(0,s.jsx)(i.code,{children:"<version>"})," in the example URLs based on what's used in your Prophecy project."]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"ProphecyPythonLibs"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"wget https://prophecy-public-bucket.s3.us-east-2.amazonaws.com/python-prophecy-libs/prophecy_libs-<version>-py3-none-any.whl\n\ndatabricks fs cp prophecy_libs-<version>-py3-none-any.whl /Volumes/<your-volume-location>/prophecy-libs/\n"})}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"ProphecyScalaLibs"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"wget https://prophecy-public-bucket.s3.us-east-2.amazonaws.com/prophecy-libs/prophecy-libs-assembly-<version>.jar\n\ndatabricks fs cp prophecy-libs-assembly-<version>.jar /Volumes/<your-volume-location>/prophecy-libs/\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["You can also download Prophecy libraries from Azure and GCP. For a full list of paths, visit ",(0,s.jsx)(i.a,{href:"/engineers/prophecy-libraries#download-prophecy-libraries",children:"Prophecy libraries"}),"."]}),"\n",(0,s.jsx)(i.h2,{id:"update-fabric-configuration",children:"Update fabric configuration"}),"\n",(0,s.jsx)(i.p,{children:"For all relevant Databricks fabrics, you'll need to update the location of the Prophecy libraries."}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Open the fabric settings."}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Toward the end of the page, find the ",(0,s.jsx)(i.strong,{children:"Prophecy Library"})," settings."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["For Scala and/or Python, change the ",(0,s.jsx)(i.strong,{children:"Resolution mode"})," to ",(0,s.jsx)(i.strong,{children:"File System"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Under ",(0,s.jsx)(i.strong,{children:"Path"}),", add the volume path that you created earlier."]}),"\n",(0,s.jsxs)(i.p,{children:["Example: ",(0,s.jsx)(i.code,{children:"/Volumes/<your-volume-location>/prophecy-libs/"})]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click ",(0,s.jsx)(i.strong,{children:"Update"})," to save this change."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"whitelist-for-uc-standard-clusters",children:"Whitelist for UC standard clusters"}),"\n",(0,s.jsxs)(i.p,{children:["To whitelist the Init Script and the JAR path, follow the instructions to ",(0,s.jsx)(i.a,{href:"/admin/dbx-whitelist-plibs",children:"add Prophecy libraries to your Databricks allowlist"}),"."]})]})}function d(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}}}]);