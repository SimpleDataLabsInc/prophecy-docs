"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[33145],{28453:(e,r,t)=>{t.d(r,{R:()=>d,x:()=>i});var s=t(96540);const o={},n=s.createContext(o);function d(e){const r=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),s.createElement(n.Provider,{value:r},e.children)}},39838:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"analysts/extensibility/stored-procedure","title":"Stored procedures","description":"Create and call stored procedures to use in pipelines","source":"@site/docs/analysts/extensibility/stored-procedure.md","sourceDirName":"analysts/extensibility","slug":"/analysts/stored-procedure","permalink":"/analysts/stored-procedure","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"extensibility","permalink":"/tags/extensibility"}],"version":"current","frontMatter":{"title":"Stored procedures","id":"stored-procedure","slug":"/analysts/stored-procedure","description":"Create and call stored procedures to use in pipelines","tags":["extensibility"]},"sidebar":"mySidebar","previous":{"title":"Functions","permalink":"/analysts/functions"},"next":{"title":"Gem Builder","permalink":"/analysts/gem-builder"}}');var o=t(74848),n=t(28453);const d={title:"Stored procedures",id:"stored-procedure",slug:"/analysts/stored-procedure",description:"Create and call stored procedures to use in pipelines",tags:["extensibility"]},i=void 0,c={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create stored procedure",id:"create-stored-procedure",level:2},{value:"Argument Modes",id:"argument-modes",level:3},{value:"Procedure Options",id:"procedure-options",level:3},{value:"Call stored procedure",id:"call-stored-procedure",level:2}];function a(e){const r={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.p,{children:"Stored procedures let you run procedural logic within your pipeline. While most business logic should be implemented using standard Prophecy gems or declarative SQL, stored procedures are useful in specific scenarios where procedural control is required."}),"\n",(0,o.jsx)(r.p,{children:"Use stored procedures when:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Migrating existing logic from systems that use stored procedures."}),"\n",(0,o.jsx)(r.li,{children:"Running DDL operations, such as creating or cleaning up tables."}),"\n",(0,o.jsx)(r.li,{children:"Bookkeeping, such as writing execution metadata (run time, parameters, status) to an audit table after a pipeline run finishes."}),"\n",(0,o.jsx)(r.li,{children:"Iterative operations, such as looping through all tables in a database to extract metadata or perform cleanup tasks."}),"\n"]}),"\n",(0,o.jsx)(r.admonition,{type:"info",children:(0,o.jsxs)(r.p,{children:["This page describes how to create new stored procedures in Prophecy. For information about calling stored procedures in a pipeline, visit ",(0,o.jsx)(r.a,{href:"/analysts/stored-procedure-gem",children:"StoredProcedure"}),"."]})}),"\n",(0,o.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsx)(r.p,{children:"To use stored procedures, you need:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Prophecy 4.1.2 or later."}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"create-stored-procedure",children:"Create stored procedure"}),"\n",(0,o.jsxs)(r.p,{children:["To create a stored procedure in a project, click ",(0,o.jsx)(r.strong,{children:"+ Add Entity > Stored Procedure"})," in the project browser. Then, configure and save the stored procedure."]}),"\n",(0,o.jsxs)(r.p,{children:["The following table describes the parameters of a stored procedure using the visual view. In the code view, you can write the entire procedure using BigQuery SQL syntax, including the ",(0,o.jsx)(r.code,{children:"CREATE PROCEDURE"})," statement and procedure body."]}),"\n",(0,o.jsxs)(r.table,{children:[(0,o.jsx)(r.thead,{children:(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.th,{children:"Parameter"}),(0,o.jsx)(r.th,{children:"Description"})]})}),(0,o.jsxs)(r.tbody,{children:[(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"Project"}),(0,o.jsx)(r.td,{children:"The Google Cloud project that contains the dataset where the stored procedure will be created."})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"Dataset"}),(0,o.jsx)(r.td,{children:"The BigQuery dataset where the stored procedure will be created."})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"Arguments"}),(0,o.jsxs)(r.td,{children:["Define the parameters passed to the stored procedure. ",(0,o.jsx)("br",{}),"Each argument includes a name, data type, and mode (",(0,o.jsx)(r.code,{children:"IN"}),", ",(0,o.jsx)(r.code,{children:"OUT"}),", or ",(0,o.jsx)(r.code,{children:"INOUT"}),"). Learn more in ",(0,o.jsx)(r.a,{href:"#argument-modes",children:"Argument Modes"}),"."]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"Code"}),(0,o.jsx)(r.td,{children:"The body of the stored procedure written in BigQuery SQL."})]})]})]}),"\n",(0,o.jsx)(r.admonition,{type:"info",children:(0,o.jsxs)(r.p,{children:["To learn about and view examples of stored procedures in BigQuery, visit ",(0,o.jsx)(r.a,{href:"https://cloud.google.com/bigquery/docs/procedures",children:"Work with SQL stored procedures"}),"."]})}),"\n",(0,o.jsx)(r.h3,{id:"argument-modes",children:"Argument Modes"}),"\n",(0,o.jsx)(r.p,{children:"Stored procedures support the following argument modes:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"IN"})," mode: Passes a value into the stored procedure. The procedure can read the value but cannot modify it."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"OUT"})," mode: Returns a value from the stored procedure. The procedure assigns a value to the argument."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"INOUT"})," mode: Passes a value into the procedure and returns a (possibly updated) value back to the caller."]}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"procedure-options",children:"Procedure Options"}),"\n",(0,o.jsx)(r.p,{children:"Prophecy supports additional options that you can find in the top right corner of the stored procedure configuration."}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Strict Mode"}),": When ",(0,o.jsx)(r.code,{children:"True"})," (default), the procedure body is checked for errors such as non-existent tables or columns. The procedure fails if the body fails any of these checks. When ",(0,o.jsx)(r.code,{children:"False"}),", the procedure body is checked only for syntax. Learn more about ",(0,o.jsx)(r.code,{children:"strictMode"})," in the ",(0,o.jsx)(r.a,{href:"https://cloud.google.com/bigquery/docs/reference/rest/v2/routines",children:"BigQuery API reference documentation"}),"."]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Description"}),": Use this field to document the purpose and behavior of the stored procedure. The description is saved with the procedure in BigQuery."]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"call-stored-procedure",children:"Call stored procedure"}),"\n",(0,o.jsxs)(r.p,{children:["Once you have created a stored procedure, you can call it using the ",(0,o.jsx)(r.a,{href:"/analysts/stored-procedure-gem",children:"StoredProcedure gem"}),"."]})]})}function u(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}}}]);