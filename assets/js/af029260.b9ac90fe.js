"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[5934],{3905:function(e,n,i){i.d(n,{Zo:function(){return u},kt:function(){return f}});var t=i(67294);function a(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function o(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,t)}return i}function r(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?o(Object(i),!0).forEach((function(n){a(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function l(e,n){if(null==e)return{};var i,t,a=function(e,n){if(null==e)return{};var i,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)i=o[t],n.indexOf(i)>=0||(a[i]=e[i]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)i=o[t],n.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var s=t.createContext({}),c=function(e){var n=t.useContext(s),i=n;return e&&(i="function"==typeof e?e(n):r(r({},n),e)),i},u=function(e){var n=c(e.components);return t.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},g=t.forwardRef((function(e,n){var i=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),g=c(i),f=a,d=g["".concat(s,".").concat(f)]||g[f]||p[f]||o;return i?t.createElement(d,r(r({ref:n},u),{},{components:i})):t.createElement(d,r({ref:n},u))}));function f(e,n){var i=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=i.length,r=new Array(o);r[0]=g;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var c=2;c<o;c++)r[c]=i[c];return t.createElement.apply(null,r)}return t.createElement.apply(null,i)}g.displayName="MDXCreateElement"},72360:function(e,n,i){i.d(n,{Z:function(){return r}});var t=i(67294),a=i(86010),o="tabItem_OmH5";function r(e){var n=e.children,i=e.hidden,r=e.className;return t.createElement("div",{role:"tabpanel",className:(0,a.Z)(o,r),hidden:i},n)}},9877:function(e,n,i){i.d(n,{Z:function(){return f}});var t=i(87462),a=i(67294),o=i(72389),r=i(67392),l=i(7094),s=i(12466),c=i(86010),u="tabList_uSqn",p="tabItem_LplD";function g(e){var n,i,o,g=e.lazy,f=e.block,d=e.defaultValue,m=e.values,h=e.groupId,v=e.className,k=a.Children.map(e.children,(function(e){if((0,a.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),b=null!=m?m:k.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),y=(0,r.l)(b,(function(e,n){return e.value===n.value}));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var w=null===d?d:null!=(n=null!=d?d:null==(i=k.find((function(e){return e.props.default})))?void 0:i.props.value)?n:null==(o=k[0])?void 0:o.props.value;if(null!==w&&!b.some((function(e){return e.value===w})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+w+'" but none of its children has the corresponding value. Available values are: '+b.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var C=(0,l.U)(),x=C.tabGroupChoices,N=C.setTabGroupChoices,S=(0,a.useState)(w),Z=S[0],P=S[1],_=[],O=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var T=x[h];null!=T&&T!==Z&&b.some((function(e){return e.value===T}))&&P(T)}var E=function(e){var n=e.currentTarget,i=_.indexOf(n),t=b[i].value;t!==Z&&(O(n),P(t),null!=h&&N(h,t))},j=function(e){var n,i=null;switch(e.key){case"ArrowRight":var t=_.indexOf(e.currentTarget)+1;i=_[t]||_[0];break;case"ArrowLeft":var a=_.indexOf(e.currentTarget)-1;i=_[a]||_[_.length-1]}null==(n=i)||n.focus()};return a.createElement("div",{className:(0,c.Z)("tabs-container",u)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,c.Z)("tabs",{"tabs--block":f},v)},b.map((function(e){var n=e.value,i=e.label,o=e.attributes;return a.createElement("li",(0,t.Z)({role:"tab",tabIndex:Z===n?0:-1,"aria-selected":Z===n,key:n,ref:function(e){return _.push(e)},onKeyDown:j,onFocus:E,onClick:E},o,{className:(0,c.Z)("tabs__item",p,null==o?void 0:o.className,{"tabs__item--active":Z===n})}),null!=i?i:n)}))),g?(0,a.cloneElement)(k.filter((function(e){return e.props.value===Z}))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},k.map((function(e,n){return(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==Z})}))))}function f(e){var n=(0,o.Z)();return a.createElement(g,(0,t.Z)({key:String(n)},e))}},9560:function(e,n,i){i.r(n),i.d(n,{assets:function(){return g},contentTitle:function(){return u},default:function(){return m},frontMatter:function(){return c},metadata:function(){return p},toc:function(){return f}});var t=i(87462),a=i(63366),o=(i(67294),i(3905)),r=i(9877),l=i(72360),s=["components"],c={title:"Configuration",id:"configuration",description:"Low-code Spark Configuration",sidebar_position:4,tags:["spark","development","config"]},u=void 0,p={unversionedId:"low-code-spark/configuration",id:"low-code-spark/configuration",title:"Configuration",description:"Low-code Spark Configuration",source:"@site/docs/low-code-spark/configuration.md",sourceDirName:"low-code-spark",slug:"/low-code-spark/configuration",permalink:"/low-code-spark/configuration",draft:!1,tags:[{label:"spark",permalink:"/tags/spark"},{label:"development",permalink:"/tags/development"},{label:"config",permalink:"/tags/config"}],version:"current",sidebarPosition:4,frontMatter:{title:"Configuration",id:"configuration",description:"Low-code Spark Configuration",sidebar_position:4,tags:["spark","development","config"]},sidebar:"defaultSidebar",previous:{title:"Interactive Execution",permalink:"/low-code-spark/interactive-execution"},next:{title:"Unit Testing",permalink:"/low-code-spark/tests"}},g={},f=[{value:"Spark Configuration",id:"spark-configuration",level:2},{value:"Hadoop Configuration",id:"hadoop-configuration",level:2},{value:"Pipeline Configuration",id:"pipeline-configuration",level:2},{value:"Examples for Pipeline level configurations",id:"examples-for-pipeline-level-configurations",level:2},{value:"Using Config in limit Gem",id:"using-config-in-limit-gem",level:3},{value:"SQL Visual Language",id:"sql-visual-language",level:4},{value:"Scala/Python Visual Language",id:"scalapython-visual-language",level:4},{value:"Using Spark-expression Config type in Gem",id:"using-spark-expression-config-type-in-gem",level:3},{value:"SQL Visual Language",id:"Spark-expression",level:4},{value:"Scala/Python Visual Language",id:"Spark-expression",level:4},{value:"Using config in paths for Source/Target Gems",id:"using-config-in-paths-for-sourcetarget-gems",level:3},{value:"Pipeline Configuration instances",id:"pipeline-configuration-instances",level:2},{value:"Using a particular configuration instance for interactive runs",id:"using-a-particular-configuration-instance-for-interactive-runs",level:3},{value:"Using configuration instances in Jobs",id:"using-configuration-instances-in-jobs",level:3},{value:"Overriding configuration values in Jobs",id:"overriding-configuration-values-in-jobs",level:3},{value:"Code",id:"code",level:2},{value:"Scala Config code",id:"scala-config-code",level:3},{value:"Python Config code",id:"python-config-code",level:3},{value:"Component code",id:"component-code",level:3}],d={toc:f};function m(e){var n=e.components,c=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,t.Z)({},d,c,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Allows you to define configurations to control various aspects of your Pipeline.\n",(0,o.kt)("img",{alt:"Config Option",src:i(42530).Z,width:"3398",height:"396"})),(0,o.kt)("p",null,"Prophecy IDE allows you to define three kinds of configurations:"),(0,o.kt)("h2",{id:"spark-configuration"},"Spark Configuration"),(0,o.kt)("p",null,"Set runtime Spark configurations as name-value pairs. The name-value pairs will be set inside the Spark runtime configurations as ",(0,o.kt)("inlineCode",{parentName:"p"},"spark.conf.set(name, value)")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Configurations - Spark",src:i(84694).Z,width:"3048",height:"406"})),(0,o.kt)("h2",{id:"hadoop-configuration"},"Hadoop Configuration"),(0,o.kt)("p",null,"Hadoop configurations as name-value pairs. The name-value pairs will be set inside the Hadoop configuration as ",(0,o.kt)("inlineCode",{parentName:"p"},"spark.sparkContext.hadoopConfiguration.set(name, value)")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Configurations - Spark",src:i(46066).Z,width:"2987",height:"381"})),(0,o.kt)("h2",{id:"pipeline-configuration"},"Pipeline Configuration"),(0,o.kt)("p",null,"Config values which can be set at Pipeline level and then be accessed inside any component in the Pipeline. ",(0,o.kt)("a",{parentName:"p",href:"#pipeline-configuration-instances"},"Multiple instances"),"\nof configuration can be created per Pipeline.\n",(0,o.kt)("img",{alt:"Configurations - Common",src:i(33321).Z,width:"3456",height:"1850"})),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Syntax for using configuration inside Gems:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Visual Language Selection",src:i(64547).Z,width:"3452",height:"1844"})),(0,o.kt)("p",null,"For visual language SQL : ",(0,o.kt)("inlineCode",{parentName:"p"},"'$config_name'")),(0,o.kt)("p",null,"For visual language Scala/Python : ",(0,o.kt)("inlineCode",{parentName:"p"},"Config.config_name")),(0,o.kt)("p",null,"For using Spark expression with visual language SQL : ",(0,o.kt)("inlineCode",{parentName:"p"},"expr('$config_name')")),(0,o.kt)("p",null,"For using Spark expression with visual language Scala/Python : ",(0,o.kt)("inlineCode",{parentName:"p"},"expr(Config.config_name)")),(0,o.kt)("h2",{id:"examples-for-pipeline-level-configurations"},"Examples for Pipeline level configurations"),(0,o.kt)("p",null,"Now let's use the ",(0,o.kt)("a",{parentName:"p",href:"#pipeline-configuration"},"above defined configurations")," in the below Pipeline.\n",(0,o.kt)("img",{alt:"Pipeline view",src:i(24733).Z,width:"3450",height:"1846"})),(0,o.kt)("h3",{id:"using-config-in-limit-gem"},"Using Config in limit Gem"),(0,o.kt)("h4",{id:"sql-visual-language"},"SQL Visual Language"),(0,o.kt)("p",null,"In the below image ",(0,o.kt)("inlineCode",{parentName:"p"},"'$num_top_customers'")," is fetching the integer value defined in configurations."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Config Limit Example",src:i(18757).Z,width:"3456",height:"1850"})),(0,o.kt)("h4",{id:"scalapython-visual-language"},"Scala/Python Visual Language"),(0,o.kt)("p",null,"In the below image ",(0,o.kt)("inlineCode",{parentName:"p"},"Config.num_top_customers")," is fetching the integer value defined in configurations."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Config Limit Example",src:i(3394).Z,width:"3448",height:"1842"})),(0,o.kt)("h3",{id:"using-spark-expression-config-type-in-gem"},"Using Spark-expression Config type in Gem"),(0,o.kt)("p",null,"Here we have used Spark expression directly from our config value to populate a column."),(0,o.kt)("h4",{id:"Spark-expression"},"SQL Visual Language"),(0,o.kt)("p",null,"In the below image:",(0,o.kt)("br",null)),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"(1)")," ",(0,o.kt)("inlineCode",{parentName:"p"},"amounts")," -> ",(0,o.kt)("inlineCode",{parentName:"p"},"expr('$test_expression')")," is coming from configuration type defined as ",(0,o.kt)("inlineCode",{parentName:"p"},"Spark-expression")," ",(0,o.kt)("br",null),"\n",(0,o.kt)("strong",{parentName:"p"},"(2)")," ",(0,o.kt)("inlineCode",{parentName:"p"},"report_name")," -> ",(0,o.kt)("inlineCode",{parentName:"p"},"'$report_name'")," is coming configuration type defined as string"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Config Reformat example",src:i(61231).Z,width:"3456",height:"1850"})),(0,o.kt)("h4",{id:"Spark-expression"},"Scala/Python Visual Language"),(0,o.kt)("p",null,"In the below image: ",(0,o.kt)("br",null)),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"(1)")," ",(0,o.kt)("inlineCode",{parentName:"p"},"amounts")," -> ",(0,o.kt)("inlineCode",{parentName:"p"},"expr(Config.test_expression)")," is coming from configuration type defined as ",(0,o.kt)("inlineCode",{parentName:"p"},"Spark-expression")," ",(0,o.kt)("br",null),"\n",(0,o.kt)("strong",{parentName:"p"},"(2)")," ",(0,o.kt)("inlineCode",{parentName:"p"},"report_name")," -> ",(0,o.kt)("inlineCode",{parentName:"p"},"Config.report_name")," is coming configuration type defined as string"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Config Reformat example",src:i(54233).Z,width:"3452",height:"1848"})),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Similarly configurations defined as type ",(0,o.kt)("inlineCode",{parentName:"p"},"Spark-expression")," can be used directly in filter, join, reformat etc Gems directly."))),(0,o.kt)("h3",{id:"using-config-in-paths-for-sourcetarget-gems"},"Using config in paths for Source/Target Gems"),(0,o.kt)("p",null,"Config can also be used to refer to paths. This type of configuration comes in handy in situation where we have DEV, QA and PROD data.\nAnd want to configure Dataset (or in general the Job runs) based on which environment we are running it in."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Config path example",src:i(95902).Z,width:"3456",height:"1842"})),(0,o.kt)("h2",{id:"pipeline-configuration-instances"},"Pipeline Configuration instances"),(0,o.kt)("p",null,"Different configuration instances can be defined as per requirement. This comes in handy when Pipeline needs to run with different\nconfigurations in different environments or different users."),(0,o.kt)("p",null,"New instances can be configured to override default values as shown in image below:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Create config instance",src:i(37924).Z,width:"3456",height:"1142"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Create pipeline override",src:i(55078).Z,width:"3446",height:"1852"})),(0,o.kt)("h3",{id:"using-a-particular-configuration-instance-for-interactive-runs"},"Using a particular configuration instance for interactive runs"),(0,o.kt)("p",null,"For interactive runs, configuration can be selected as shown in image below.\n",(0,o.kt)("img",{alt:"Config interactive run",src:i(8597).Z,width:"3450",height:"1846"})),(0,o.kt)("h3",{id:"using-configuration-instances-in-jobs"},"Using configuration instances in Jobs"),(0,o.kt)("p",null,"Particular instances can also be configured in Databricks Jobs."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Config inside job",src:i(621).Z,width:"3444",height:"1846"})),(0,o.kt)("h3",{id:"overriding-configuration-values-in-jobs"},"Overriding configuration values in Jobs"),(0,o.kt)("p",null,"Specific values from configuration instance can be overridden as shown in images below:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Config job override",src:i(69804).Z,width:"3452",height:"1840"})),(0,o.kt)("h2",{id:"code"},"Code"),(0,o.kt)("p",null,"All configuration instances and values are automatically converted to code as well. Default configurations are stored as code and\nspecific instance overrides are stored as JSON files as shown in image below."),(0,o.kt)("h3",{id:"scala-config-code"},"Scala Config code"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Config scala code",src:i(29530).Z,width:"3452",height:"1842"})),(0,o.kt)("h3",{id:"python-config-code"},"Python Config code"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Config python code",src:i(89467).Z,width:"3450",height:"1838"})),(0,o.kt)("h3",{id:"component-code"},"Component code"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},'def Reformat(spark: SparkSession, in0: DataFrame) -> DataFrame:\n    return in0.select(\n        col("customer_id"),\n        col("orders"),\n        col("account_length_days"),\n        expr(Config.test_expression).as("amounts"),\n        lit(Config.report_name).as("report_name")\n    )\n'))),(0,o.kt)(l.Z,{value:"scala",label:"Scala",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'object Reformat {\n\n  def apply(spark: SparkSession, in: DataFrame): DataFrame =\n    in.select(col("customer_id"),\n              col("orders"),\n              col("account_length_days"),\n              expr(Config.test_expression).as("amounts"),\n              lit(Config.report_name).as("report_name")\n    )\n\n}\n\n')))))}m.isMDXComponent=!0},621:function(e,n,i){n.Z=i.p+"assets/images/config-inside-job-da462a1b4cb3c14c0a01176ecff0a26b.png"},8597:function(e,n,i){n.Z=i.p+"assets/images/config-instance-interactive-run-2d81aa4b6687a2937704666f5ef0432d.png"},69804:function(e,n,i){n.Z=i.p+"assets/images/config-job-override-d17adca511bb853b7974d79eb7ce0f87.png"},37924:function(e,n,i){n.Z=i.p+"assets/images/config-new-instance-d1ab8ec7e33a045ca32ee5531ed6ffc1.png"},42530:function(e,n,i){n.Z=i.p+"assets/images/config-option-3dff53640308d125b387ff0c89cfd064.png"},33321:function(e,n,i){n.Z=i.p+"assets/images/config-pipeline-eg1-708f4ca2486ceee0fb64f232f213db67.png"},3394:function(e,n,i){n.Z=i.p+"assets/images/config-pipeline-limit-eg-scala-python-75bb5df32fd0626272b6804efba49823.png"},18757:function(e,n,i){n.Z=i.p+"assets/images/config-pipeline-limit-eg-0d39b48978c3e7f1fa34e4055cf98b71.png"},55078:function(e,n,i){n.Z=i.p+"assets/images/config-pipeline-override-2b1087f68db48de0b9db16d3790b6cfa.png"},95902:function(e,n,i){n.Z=i.p+"assets/images/config-pipeline-path-eg-69dd68fd535736a6a3489cfebde729d6.png"},54233:function(e,n,i){n.Z=i.p+"assets/images/config-pipeline-reformat-eg-scala-python-17e496a27d1b42aec0f5cada46e80650.png"},61231:function(e,n,i){n.Z=i.p+"assets/images/config-pipeline-reformat-eg-710011eb69b4d8d12273872c90746ed0.png"},24733:function(e,n,i){n.Z=i.p+"assets/images/config-pipeline-view-eg-d0b83c8f00fba2b5ad9ec668a823808b.png"},64547:function(e,n,i){n.Z=i.p+"assets/images/config-pipeline-visual-language-f7acc4e8ca772caa1d2d869519d147aa.png"},89467:function(e,n,i){n.Z=i.p+"assets/images/config-python-code-0c98aac73937d55179c6d5b2fda2b85d.png"},29530:function(e,n,i){n.Z=i.p+"assets/images/config-scala-code-c0c5c02a564e24afabb80d15caf27dae.png"},46066:function(e,n,i){n.Z=i.p+"assets/images/configs_hadoop-c4da78b7ebf4205d9867c8f0f99aac8e.png"},84694:function(e,n,i){n.Z=i.p+"assets/images/configs_spark-4dc24fb44c969bbb974db83384e72f2a.png"}}]);