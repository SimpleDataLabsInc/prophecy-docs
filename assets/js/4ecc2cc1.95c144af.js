"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[82669],{8883:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/externalip-14d94f9be32eb3313cd74a434d232955.png"},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>c});var t=r(96540);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}},33004:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/createkey-df185df0c31ff443686691fe7acf65d5.png"},33041:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/selectdataproc-c2d482f0c1741fbcdff9d93c38fe857e.png"},37706:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>g,frontMatter:()=>o,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"administration/Spark-fabrics/dataproc/gcp-dataproc-fabric-guide","title":"Google Cloud Dataproc","description":"Configuring GCP Dataproc Fabric","source":"@site/docs/administration/Spark-fabrics/dataproc/dataproc.md","sourceDirName":"administration/Spark-fabrics/dataproc","slug":"/administration/Spark-fabrics/dataproc/","permalink":"/administration/Spark-fabrics/dataproc/","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"deployment","permalink":"/tags/deployment"},{"inline":true,"label":"configuration","permalink":"/tags/configuration"},{"inline":true,"label":"google","permalink":"/tags/google"},{"inline":true,"label":"gcp","permalink":"/tags/gcp"},{"inline":true,"label":"dataproc","permalink":"/tags/dataproc"},{"inline":true,"label":"livy","permalink":"/tags/livy"}],"version":"current","sidebarPosition":8,"frontMatter":{"title":"Google Cloud Dataproc","id":"gcp-dataproc-fabric-guide","description":"Configuring GCP Dataproc Fabric","sidebar_position":8,"tags":["deployment","configuration","google","gcp","dataproc","livy"]},"sidebar":"adminSidebar","previous":{"title":"Azure Synapse Analytics","permalink":"/administration/Spark-fabrics/azure-synapse-fabric-guide"},"next":{"title":"Connectivity Tips","permalink":"/administration/Spark-fabrics/dataproc/gcp-dataproc-fabric-tips"}}');var s=r(74848),i=r(28453),a=r(99563),c=r(89791);const o={title:"Google Cloud Dataproc",id:"gcp-dataproc-fabric-guide",description:"Configuring GCP Dataproc Fabric",sidebar_position:8,tags:["deployment","configuration","google","gcp","dataproc","livy"]},l=void 0,d={},p=[{value:"Create a Dataproc Cluster",id:"create-a-dataproc-cluster",level:2},{value:"Create a Dataproc fabric",id:"create-a-dataproc-fabric",level:2}];function u(e){const n={admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"In the context of Spark execution engines, users have the flexibility to opt for Google Cloud Dataproc. This guide offers step-by-step instructions on creating a fabric that enables seamless connectivity to the Dataproc environment."}),"\n",(0,s.jsx)(n.h2,{id:"create-a-dataproc-cluster",children:"Create a Dataproc Cluster"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsx)(n.p,{children:"Livy is required for the fabric. Prophecy provides a script required to deploy a Dataproc Cluster."})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["If you don't already have a private key, create a private key for the service account that you're using.","\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("img",{src:r(33004).A,alt:"dataproc security",width:"75%"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Ensure you have the following permissions configured."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'  gcloud projects add-iam-policy-binding <project-name> \\\n --member "<service-account-name>" \\\n --role "roles/serviceusage.serviceUsageViewer"\n\n  gcloud projects add-iam-policy-binding <project-name> \\\n --member "<service-account-name>" \\\n --role "roles/dataproc.worker"\n\n  gcloud projects add-iam-policy-binding core-shard-398601 \\\n --member "<service-account-name>" \\\n --role "storage.objects.get"\n\n  gcloud storage buckets add-iam-policy-binding gs://<bucket-name> \\\n --member="<service-account-name>" --role=roles/storage.admin --project <project-name>\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Associate secret key to service account."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"gcloud config set account meitestserviceaccount@core-shard-398601.iam.gserviceaccount.com \\\n--key-file=<local-private-key-location>\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Start a Dataproc cluster using ",(0,s.jsx)(n.code,{children:"install-livy.sh"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:' gcloud dataproc clusters create <cluster-name> \\\n--scopes <permission-scope> \\\n--region <cluster-region> \\\n--initialization-actions \'gs://prophecy-public-gcp/livy-installer-script/install-livy.sh\' \\\n--properties "hive:hive.metastore.warehouse.dir=<gs://bucket/datasets>" \\\n--metadata "enable-cloud-sql-proxy-on-workers=false" \\\n--bucket <cluster-data-bucket-name> \\\n--region <region> \\\n--zone <zone> \\\n--single-node \\\n--master-machine-type n2-standard-4 \\\n--master-boot-disk-size 500 \\\n--image-version 2.0-debian10 \\\n--project <project-name> \\\n--service-account="<service-account-name>" \\\n--dataproc-metastore=projects/<project-name>/locations/<region>/services/<metastore-service-name>\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"create-a-dataproc-fabric",children:"Create a Dataproc fabric"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Create a fabric and select ",(0,s.jsx)(n.strong,{children:"Dataproc"}),".","\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("img",{src:r(33041).A,alt:"select dataproc",width:"75%"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Fill out your ",(0,s.jsx)(n.strong,{children:"Project Name"})," and ",(0,s.jsx)(n.strong,{children:"Region"}),", and upload the ",(0,s.jsx)(n.strong,{children:"Private Key"}),".","\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("img",{src:r(88041).A,alt:"configure dataproc",width:"75%"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.strong,{children:"Fetch environments"})," and select the Dataproc ",(0,s.jsx)(n.strong,{children:"cluster"})," that you created earlier.","\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("img",{src:r(72452).A,alt:"select cluster",width:"75%"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Leave everything as default and provide the ",(0,s.jsx)(n.strong,{children:"Livy URL"}),". Locate the ",(0,s.jsx)(n.strong,{children:"External IP"})," of your cluster instance. Optionally, you may configure the DNS instead of using the IP. The URL is ",(0,s.jsx)(n.code,{children:"http://<external-ip>:8998"}),".","\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("img",{src:r(8883).A,alt:"livy ip",width:"75%"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Configure the bucket associated with your cluster.","\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("img",{src:r(89029).A,alt:"bucket location",width:"75%"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Add the ",(0,s.jsx)(n.strong,{children:"Job Size"}),".","\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("img",{src:r(98699).A,alt:"Job Size",width:"55%"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Configure Scala Library Path.\n",(0,s.jsx)(n.code,{children:"gs://prophecy-public-gcp/prophecy-scala-libs/"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Configure Python Library Path.\n",(0,s.jsx)(n.code,{children:"gs://prophecy-public-gcp/prophecy-python-libs/"}),".","\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("img",{src:r(87660).A,alt:"dependences",width:"85%"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.strong,{children:"Complete"}),".","\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n","Run a simple pipeline and make sure that the interim returns data properly."]}),"\n"]}),"\n","\n",(0,s.jsx)(a.A,{items:(0,c.$S)().items})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},72452:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/selectenv-b717862604ca2782864c0295f3004b0d.png"},81430:(e,n,r)=>{r.d(n,{W:()=>l});var t=r(96540),s=r(40797);const i=["zero","one","two","few","many","other"];function a(e){return i.filter((n=>e.includes(n)))}const c={locale:"en",pluralForms:a(["one","other"]),select:e=>1===e?"one":"other"};function o(){const{i18n:{currentLocale:e}}=(0,s.A)();return(0,t.useMemo)((()=>{try{return function(e){const n=new Intl.PluralRules(e);return{locale:e,pluralForms:a(n.resolvedOptions().pluralCategories),select:e=>n.select(e)}}(e)}catch(n){return console.error(`Failed to use Intl.PluralRules for locale "${e}".\nDocusaurus will fallback to the default (English) implementation.\nError: ${n.message}\n`),c}}),[e])}function l(){const e=o();return{selectMessage:(n,r)=>function(e,n,r){const t=e.split("|");if(1===t.length)return t[0];t.length>r.pluralForms.length&&console.error(`For locale=${r.locale}, a maximum of ${r.pluralForms.length} plural forms are expected (${r.pluralForms.join(",")}), but the message contains ${t.length}: ${e}`);const s=r.select(n),i=r.pluralForms.indexOf(s);return t[Math.min(i,t.length-1)]}(r,n,e)}}},87660:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/proclib-3851b837a56dad4601bdb874c93b4191.png"},88041:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/configuredataproc-de836f1a36174699c6b423a4020b1468.png"},89029:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/bucketloc-daf4b54c4bce9935598c9fd2697f7673.png"},89791:(e,n,r)=>{r.d(n,{$S:()=>t});r(40797);function t(){return r(56942).$S(...arguments)}},98699:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/procjobsize-bea0c95d10965dae7f92b60097ba9f52.png"},99563:(e,n,r)=>{r.d(n,{A:()=>f});r(96540);var t=r(18215),s=r(93751),i=r(56289),a=r(81430),c=r(22887),o=r(50539),l=r(9303);const d={cardContainer:"cardContainer_fWXF",cardTitle:"cardTitle_rnsV",cardDescription:"cardDescription_PWke"};var p=r(74848);function u(e){let{href:n,children:r}=e;return(0,p.jsx)(i.A,{href:n,className:(0,t.A)("card padding--lg",d.cardContainer),children:r})}function g(e){let{href:n,icon:r,title:s,description:i}=e;return(0,p.jsxs)(u,{href:n,children:[(0,p.jsxs)(l.A,{as:"h2",className:(0,t.A)("text--truncate",d.cardTitle),title:s,children:[r," ",s]}),i&&(0,p.jsx)("p",{className:(0,t.A)("text--truncate",d.cardDescription),title:i,children:i})]})}function m(e){let{item:n}=e;const r=(0,s.Nr)(n),t=function(){const{selectMessage:e}=(0,a.W)();return n=>e(n,(0,o.T)({message:"1 item|{count} items",id:"theme.docs.DocCard.categoryDescription.plurals",description:"The default description for a category card in the generated index about how many items this category includes"},{count:n}))}();return r?(0,p.jsx)(g,{href:r,icon:"\ud83d\uddc3\ufe0f",title:n.label,description:n.description??t(n.items.length)}):null}function h(e){let{item:n}=e;const r=(0,c.A)(n.href)?"\ud83d\udcc4\ufe0f":"\ud83d\udd17",t=(0,s.cC)(n.docId??void 0);return(0,p.jsx)(g,{href:n.href,icon:r,title:n.label,description:n.description??t?.description})}function b(e){let{item:n}=e;switch(n.type){case"link":return(0,p.jsx)(h,{item:n});case"category":return(0,p.jsx)(m,{item:n});default:throw new Error(`unknown item type ${JSON.stringify(n)}`)}}function x(e){let{className:n}=e;const r=(0,s.$S)();return(0,p.jsx)(f,{items:r.items,className:n})}function f(e){const{items:n,className:r}=e;if(!n)return(0,p.jsx)(x,{...e});const i=(0,s.d1)(n);return(0,p.jsx)("section",{className:(0,t.A)("row",r),children:i.map(((e,n)=>(0,p.jsx)("article",{className:"col col--6 margin-bottom--lg",children:(0,p.jsx)(b,{item:e})},n)))})}}}]);