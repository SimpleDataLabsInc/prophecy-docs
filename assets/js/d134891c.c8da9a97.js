"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[6256],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>g});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(a),m=r,g=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return a?n.createElement(g,i(i({ref:t},p),{},{components:a})):n.createElement(g,i({ref:t},p))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},42709:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var n=a(87462),r=(a(67294),a(3905));const o={title:"Audit Events Configuration",id:"audit-events",description:"Prophecy on-prem installations audit events (logs) being synced to object stores like S3, Azure Blob Storage, GCP Cloud Storage etc.",sidebar_position:1,tags:["audit events","audit logs","disaster recovery","s3","azure blob","NFS","GCS"]},i=void 0,l={unversionedId:"architecture/deployment/on-premise/audit-events",id:"architecture/deployment/on-premise/audit-events",title:"Audit Events Configuration",description:"Prophecy on-prem installations audit events (logs) being synced to object stores like S3, Azure Blob Storage, GCP Cloud Storage etc.",source:"@site/docs/architecture/deployment/on-premise/configure-audit-logs.md",sourceDirName:"architecture/deployment/on-premise",slug:"/architecture/deployment/on-premise/audit-events",permalink:"/architecture/deployment/on-premise/audit-events",draft:!1,tags:[{label:"audit events",permalink:"/tags/audit-events"},{label:"audit logs",permalink:"/tags/audit-logs"},{label:"disaster recovery",permalink:"/tags/disaster-recovery"},{label:"s3",permalink:"/tags/s-3"},{label:"azure blob",permalink:"/tags/azure-blob"},{label:"NFS",permalink:"/tags/nfs"},{label:"GCS",permalink:"/tags/gcs"}],version:"current",sidebarPosition:1,frontMatter:{title:"Audit Events Configuration",id:"audit-events",description:"Prophecy on-prem installations audit events (logs) being synced to object stores like S3, Azure Blob Storage, GCP Cloud Storage etc.",sidebar_position:1,tags:["audit events","audit logs","disaster recovery","s3","azure blob","NFS","GCS"]},sidebar:"defaultSidebar",previous:{title:"On-premise",permalink:"/architecture/deployment/on-premise/"},next:{title:"Backup/Restore Configuration",permalink:"/architecture/deployment/on-premise/backup-restore"}},s={},u=[{value:"Usecase",id:"usecase",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Navigating to the Audit config UI",id:"navigating-to-the-audit-config-ui",level:3},{value:"JSON format",id:"json-format",level:3},{value:"Supported Configuration Variables",id:"supported-configuration-variables",level:3},{value:"To enable user events audit logs",id:"to-enable-user-events-audit-logs",level:3},{value:"User events audit logs output",id:"user-events-audit-logs-output",level:2},{value:"Sample output of user audit logs",id:"sample-output-of-user-audit-logs",level:3}],p={toc:u},d="wrapper";function c(e){let{components:t,...a}=e;return(0,r.kt)(d,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Prophecy offers robust support for storing audit events (logs) on two of the industry's leading cloud object stores: AWS S3, Azure Blob Storage, GCP Cloud Storage or even local persistent volume (PV). Leveraging the capabilities of these object stores, Prophecy seamlessly synchronizes and persistently stores audit events. This not only ensures the secure retention of crucial data but also facilitates streamlined tracking and in-depth analysis of user interactions and activities for enhanced operational insights."),(0,r.kt)("p",null,"\u26a0\ufe0f Certain ",(0,r.kt)("a",{parentName:"p",href:"/architecture/deployment/on-premise/object-store-config"},"object store level configurations")," are shared with ",(0,r.kt)("a",{parentName:"p",href:"/architecture/deployment/on-premise/backup-restore"},"backup restore configurations"),". Make sure to configure the ",(0,r.kt)("a",{parentName:"p",href:"/architecture/deployment/on-premise/object-store-config"},"object store level configurations")," before proceeding below."),(0,r.kt)("h2",{id:"usecase"},"Usecase"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The overarching objective is to comprehensively track and log every user-level action."),(0,r.kt)("li",{parentName:"ul"},"All user actions will be meticulously recorded and stored, enabling easy retrieval from a persistent storage or object store, particularly when an audit is required."),(0,r.kt)("li",{parentName:"ul"},"To achieve this, each user action will be meticulously tracked and written into designated database tables."),(0,r.kt)("li",{parentName:"ul"},"The data accumulated in these database tables will be periodically transferred and pushed to an object store for efficient storage and management.")),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"There are certain environment variables that need to be configured in Athena based on the kind of user events audit logs required."),(0,r.kt)("h3",{id:"navigating-to-the-audit-config-ui"},"Navigating to the Audit config UI"),(0,r.kt)("p",null,"To configure object store settings in the Prophecy UI, follow these steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Log in to the Prophecy UI as an admin user."),(0,r.kt)("li",{parentName:"ol"},"Click on the ",(0,r.kt)("inlineCode",{parentName:"li"},"three dots")," at the bottom left corner and select the ",(0,r.kt)("inlineCode",{parentName:"li"},"settings icon")," from the submenu."),(0,r.kt)("li",{parentName:"ol"},"Navigate to the ",(0,r.kt)("inlineCode",{parentName:"li"},"Admin")," main tab."),(0,r.kt)("li",{parentName:"ol"},"Within the Admin main tab, access the ",(0,r.kt)("inlineCode",{parentName:"li"},"Config")," sub tab."),(0,r.kt)("li",{parentName:"ol"},"Finally, click on the ",(0,r.kt)("inlineCode",{parentName:"li"},"auditConfig")," sub tab to configure the audit settings.")),(0,r.kt)("h3",{id:"json-format"},"JSON format"),(0,r.kt)("p",null,"Below are JSON configurations within the Prophecy UI that need to be enabled to support this functionality. You will have to configure only the options which you require. Please make sure to maintain a JSON format mentioned below while configuring the different options."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "disableUeventsGC": false,\n  "enableUserEvents": false,\n  "ueventsGCSchedule": "0 0 1 * * *",\n  "ueventsSchedule": "0 0 */1 * * *"\n}\n')),(0,r.kt)("h3",{id:"supported-configuration-variables"},"Supported Configuration Variables"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Configuration variable name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Default value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"disableUeventsGC")),(0,r.kt)("td",{parentName:"tr",align:null},"Garbage collection of user events from local DB is enabled by default once the events have been pushed to upstream object store. Set this to ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," to disable this garbage collection to retain this data locally as well. Please note that setting this to ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," could potentially result in a very large DB size."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"enableUserEvents")),(0,r.kt)("td",{parentName:"tr",align:null},"Set to ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," to enable user event audit logs"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ueventsSchedule")),(0,r.kt)("td",{parentName:"tr",align:null},"How frequently to push user events to object store. Defaults to every one hour. Uses ",(0,r.kt)("a",{parentName:"td",href:"https://pkg.go.dev/github.com/robfig/cron#hdr-CRON_Expression_Format"},"6-digit CRON")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"0 0 */1 * * *"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ueventsGCSchedule")),(0,r.kt)("td",{parentName:"tr",align:null},"How frequently to purge old user events from the internal database. Defaults to daily 1 am. Uses ",(0,r.kt)("a",{parentName:"td",href:"https://pkg.go.dev/github.com/robfig/cron#hdr-CRON_Expression_Format"},"6-digit CRON")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"0 0 1 * * *"))))),(0,r.kt)("h3",{id:"to-enable-user-events-audit-logs"},"To enable user events audit logs"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"enableUserEvents")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"true")),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"ueventsSchedule")," to the ",(0,r.kt)("a",{parentName:"li",href:"https://pkg.go.dev/github.com/robfig/cron#hdr-CRON_Expression_Format"},"CRON")," string for how frequently you'd like user events pushed to the object store."),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"ueventsGCSchedule")," to the ",(0,r.kt)("a",{parentName:"li",href:"https://pkg.go.dev/github.com/robfig/cron#hdr-CRON_Expression_Format"},"CRON")," string for how frequently you'd like old user events removed from the database.\nPVC Mount point with storage | ",(0,r.kt)("inlineCode",{parentName:"li"},"/backup")," |")),(0,r.kt)("h2",{id:"user-events-audit-logs-output"},"User events audit logs output"),(0,r.kt)("p",null,"By default pushes events to ",(0,r.kt)("inlineCode",{parentName:"p"},"/namespace/audit/")," directory in the S3 bucket configured."),(0,r.kt)("h3",{id:"sample-output-of-user-audit-logs"},"Sample output of user audit logs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{"opType": "Query", "createdAt": 1690610557857, "nameHints": ["User"], "userEmail": "prophecy-system@prophecy.io", "customerName": "prophecy.io", "responseCode": 200, "requestParams": {"email": "\\"adminuser@prophecy.io\\""}, "requestPayload": "[\\"_id\\",\\"name\\",\\"firstName\\",\\"lastName\\",\\"email\\",\\"created\\",\\"createdBy\\",\\"aspects(aspect:[Info]){AspectName AspectValue}\\"]", "latencyInMillis": 11}\n{"opType": "Query", "createdAt": 1690552930350, "nameHints": ["ProjectReleaseByProjectIdAndStatus"], "userEmail": "prophecy-system@prophecy.io", "customerName": "prophecy.io", "responseCode": 200, "requestParams": {"statuses": "[Pending,Running,Retrying]"}, "requestPayload": "[\\"_id\\",\\"releaseTag\\",\\"status\\",\\"attempt\\",\\"createdBy\\",\\"project{_id name}\\"]", "latencyInMillis": 5}\n{"opType": "Query", "createdAt": 1690610557967, "nameHints": ["User"], "userEmail": "prophecy-system@prophecy.io", "customerName": "prophecy.io", "responseCode": 200, "requestParams": {"email": "\\"adminuser@prophecy.io\\""}, "requestPayload": "[\\"_id\\",\\"name\\",\\"firstName\\",\\"lastName\\",\\"email\\",\\"created\\",\\"createdBy\\",\\"aspects(aspect:[Info]){AspectName AspectValue}\\"]", "latencyInMillis": 10}\n')))}c.isMDXComponent=!0}}]);