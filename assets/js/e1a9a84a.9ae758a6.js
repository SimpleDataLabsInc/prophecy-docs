"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[2099],{3905:function(e,t,r){r.d(t,{Zo:function(){return u},kt:function(){return d}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(r),d=a,g=c["".concat(s,".").concat(d)]||c[d]||m[d]||l;return r?n.createElement(g,i(i({ref:t},u),{},{components:r})):n.createElement(g,i({ref:t},u))}));function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=r.length,i=new Array(l);i[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var p=2;p<l;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},7306:function(e,t,r){r.r(t),r.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return m}});var n=r(7462),a=r(3366),l=(r(7294),r(3905)),i=["components"],o={title:"On premise",id:"on-premise",description:"On-premise deployments. Bring Your Own Hardware",sidebar_position:2,tags:["deployment","on-prem","cdp","hdp","mapr"]},s=void 0,p={unversionedId:"architecture/deployment/on-premise",id:"architecture/deployment/on-premise",title:"On premise",description:"On-premise deployments. Bring Your Own Hardware",source:"@site/docs/architecture/deployment/on-premise.md",sourceDirName:"architecture/deployment",slug:"/architecture/deployment/on-premise",permalink:"/architecture/deployment/on-premise",draft:!1,tags:[{label:"deployment",permalink:"/tags/deployment"},{label:"on-prem",permalink:"/tags/on-prem"},{label:"cdp",permalink:"/tags/cdp"},{label:"hdp",permalink:"/tags/hdp"},{label:"mapr",permalink:"/tags/mapr"}],version:"current",sidebarPosition:2,frontMatter:{title:"On premise",id:"on-premise",description:"On-premise deployments. Bring Your Own Hardware",sidebar_position:2,tags:["deployment","on-prem","cdp","hdp","mapr"]},sidebar:"defaultSidebar",previous:{title:"Deployment",permalink:"/architecture/deployment/"},next:{title:"Tutorials",permalink:"/tutorials/"}},u={},m=[{value:"Requirements",id:"requirements",level:2},{value:"Cluster",id:"cluster",level:3},{value:"Storage",id:"storage",level:3},{value:"Role",id:"role",level:3},{value:"Networking",id:"networking",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Spark",id:"spark",level:3},{value:"Airflow",id:"airflow",level:3},{value:"Logging / Metrics",id:"logging--metrics",level:3},{value:"Scaling",id:"scaling",level:2}],c={toc:m};function d(e){var t=e.components,o=(0,a.Z)(e,i);return(0,l.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Prophecy can be deployed on-premise for customers who require maximum security or want to run on their own on-premise\nSpark versions (e.g. CDP, HDP, MapR). As for the cloud deployments, also for on-premise, Prophecy is deployed on a\nKubernetes cluster. With that setup, Prophecy seamlessly integrates with the rest of your infrastructure."),(0,l.kt)("p",null,"Prophecy is installed through a Prophecy kubernetes operator, which automatically takes care of the common ops tasks,\nlike maintenance of the service, health checks, updates, version rollback etc."),(0,l.kt)("img",{src:r(7480).Z,alt:"Example banner",width:"75%"}),(0,l.kt)("h2",{id:"requirements"},"Requirements"),(0,l.kt)("p",null,"To install Prophecy on-premise the following infrastructure requirements must be satisfied:"),(0,l.kt)("h3",{id:"cluster"},"Cluster"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Kubernetes Version (minimum): ")," 1.14"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Images: ")," Accessible from a secure container registry available at gcr.io. This location can be configured to\ncustomer's internal container registry.")),(0,l.kt)("p",null,"Minimum service requirements:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Namespace"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"# Cores"),(0,l.kt)("th",{parentName:"tr",align:null},"# RAM"),(0,l.kt)("th",{parentName:"tr",align:null},"# Block Storage"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Control Plane"),(0,l.kt)("td",{parentName:"tr",align:null},"Main services (front-end, code editor, metadata, lineage, etc)"),(0,l.kt)("td",{parentName:"tr",align:null},"31 Cores"),(0,l.kt)("td",{parentName:"tr",align:null},"62GB"),(0,l.kt)("td",{parentName:"tr",align:null},"150GB")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Data Plane"),(0,l.kt)("td",{parentName:"tr",align:null},"Services serving as a bridge between Spark and Prophecy UI"),(0,l.kt)("td",{parentName:"tr",align:null},"8 Cores"),(0,l.kt)("td",{parentName:"tr",align:null},"15GB"),(0,l.kt)("td",{parentName:"tr",align:null},"40GB")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Backup"),(0,l.kt)("td",{parentName:"tr",align:null},"Twice-a-day snapshot-based backups service (configurable)"),(0,l.kt)("td",{parentName:"tr",align:null},"1 Core"),(0,l.kt)("td",{parentName:"tr",align:null},"2GB"),(0,l.kt)("td",{parentName:"tr",align:null},"90GB")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Search"),(0,l.kt)("td",{parentName:"tr",align:null},"Metadata search engine and storage"),(0,l.kt)("td",{parentName:"tr",align:null},"6 Proces"),(0,l.kt)("td",{parentName:"tr",align:null},"12GB"),(0,l.kt)("td",{parentName:"tr",align:null},"90GB")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ProService"),(0,l.kt)("td",{parentName:"tr",align:null},"Prophecy maintance service used to e.g. update the platform"),(0,l.kt)("td",{parentName:"tr",align:null},"3 Cores"),(0,l.kt)("td",{parentName:"tr",align:null},"6GB"),(0,l.kt)("td",{parentName:"tr",align:null},"8GB")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Platform"),(0,l.kt)("td",{parentName:"tr",align:null},"Monitoring, logging services (optional)"),(0,l.kt)("td",{parentName:"tr",align:null},"16 Cores"),(0,l.kt)("td",{parentName:"tr",align:null},"36GB"),(0,l.kt)("td",{parentName:"tr",align:null},"N / A")))),(0,l.kt)("h3",{id:"storage"},"Storage"),(0,l.kt)("p",null,"Prophecy requires:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Both ",(0,l.kt)("strong",{parentName:"li"},"block and file storage")," available in the kubernetes cluster"),(0,l.kt)("li",{parentName:"ul"},"Kubernetes cluster configured in either ",(0,l.kt)("strong",{parentName:"li"},"multi-AZ")," or ",(0,l.kt)("strong",{parentName:"li"},"single-AZ")," mode. For multi-AZ mode, the block storage has\nto have\nvolume binding mode as ",(0,l.kt)("inlineCode",{parentName:"li"},"waitforfirstconsumer")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Dynamic provisioning")," of block and file storage"),(0,l.kt)("li",{parentName:"ul"},"Prophecy supports any storage-class out of the box.")),(0,l.kt)("h3",{id:"role"},"Role"),(0,l.kt)("p",null,"Prophecy requires:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ClusterRole")," permissions are optional for CRD installation"),(0,l.kt)("li",{parentName:"ul"},"If not available, the customer can create the required CRDs, by deploying of a single helm chart (shared on request)")),(0,l.kt)("h3",{id:"networking"},"Networking"),(0,l.kt)("p",null,"Prophecy requires:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Ingress")," - Prophecy supports a Prophecy-managed or customer-managed nginx ingress controller. Either k8s nginx or\nofficial nginx controllers are supported of any version (the latest stable recommended).",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Non-nginx controller configuration is possible, however, not recommended."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Certificates")," - Wildcard certificates for path-based routing. Certificates are to be managed by the ",(0,l.kt)("inlineCode",{parentName:"li"},"cert-manager"),",\nwhich can be Prophecy or customer-managed. Certificates are automatically generated for every ingress resource\ncreated."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"External-DNS")," - To successfully resolve the service host names.")),(0,l.kt)("h3",{id:"authentication"},"Authentication"),(0,l.kt)("p",null,"Prophecy supports all most popular ",(0,l.kt)("strong",{parentName:"p"},"authentication providers")," as\nper ",(0,l.kt)("a",{parentName:"p",href:"/architecture/authentication/"},"Authentication")," documentation."),(0,l.kt)("h3",{id:"spark"},"Spark"),(0,l.kt)("p",null,"For interactive development, Prophecy requires:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Databricks API 1.2")," - for Databricks-based Spark deployments or"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Livy 0.7.x")," - for any other Spark-deployment support (e.g. CDP, HDP, MapR, Spark on Kubernetes)")),(0,l.kt)("p",null,"For jobs deployment, Prophecy requires"),(0,l.kt)("h3",{id:"airflow"},"Airflow"),(0,l.kt)("p",null,"For interactive and jobs deployment to Airflow, Prophecy requires a customer-managed ",(0,l.kt)("strong",{parentName:"p"},"Airflow deployment version\n2.x.x")," (latest recommended). ",(0,l.kt)("strong",{parentName:"p"},"Astronomer"),"'s managed Airflow offering is supported."),(0,l.kt)("h3",{id:"logging--metrics"},"Logging / Metrics"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Prophecy comes with its own built-in ",(0,l.kt)("strong",{parentName:"li"},"lightweight infrastructure for monitoring")," (based on Elasticsearch & Kibana)\nand\n",(0,l.kt)("strong",{parentName:"li"},"logging")," (based on Prometheus, Grafana and alert-manager, etc.)."),(0,l.kt)("li",{parentName:"ul"},"Customer can connect to it, to ",(0,l.kt)("strong",{parentName:"li"},"redirect the logs and metrics"),", to their logging services (optionally).")),(0,l.kt)("h2",{id:"scaling"},"Scaling"),(0,l.kt)("p",null,"The requirements outlined ",(0,l.kt)("a",{parentName:"p",href:"#cluster"},"above")," can support up-to 25 concurrent developers (folks actively developing\npipelines at the same time). To enable more concurrent users, Prophecy supports vertical and horizontal scalling and\nthe following estimates are available:"),(0,l.kt)("p",null,"It is taken care of by the ",(0,l.kt)("strong",{parentName:"p"},"Autoscaler")," component in our platform. The initial pod size specification that we provided\nis for a single pod only, that can be used by around 10 users, depending on the usage. Therefore, e.g., if the number of\nusers increases by 10 times, the Prophecy deployment will automatically scale appropriately and require up to 10 times\nthe amount of resources (pod replicas)."),(0,l.kt)("p",null,"For 150 concurrent users, around 640 CPUs, 1010GB RAM, and 1TB would be required (in practice much less, due to\nmost of the containers running lean)."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Number of users"),(0,l.kt)("th",{parentName:"tr",align:null},"30"),(0,l.kt)("th",{parentName:"tr",align:null},"90"),(0,l.kt)("th",{parentName:"tr",align:null},"150"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"CPUs"),(0,l.kt)("td",{parentName:"tr",align:null},"60 vCPUs"),(0,l.kt)("td",{parentName:"tr",align:null},"90 vCPUs"),(0,l.kt)("td",{parentName:"tr",align:null},"200 vCPUs")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Memory"),(0,l.kt)("td",{parentName:"tr",align:null},"256 GB"),(0,l.kt)("td",{parentName:"tr",align:null},"512 GB"),(0,l.kt)("td",{parentName:"tr",align:null},"1,280 GB")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Disk space (with backups)"),(0,l.kt)("td",{parentName:"tr",align:null},"500 GB"),(0,l.kt)("td",{parentName:"tr",align:null},"1 TB"),(0,l.kt)("td",{parentName:"tr",align:null},"2 TB")))),(0,l.kt)("p",null,"Please, note that the recommended resource may vary based on the intensity of the usage of each developer. The numbers\npresented above are based on the average recorded usage of the Prophecy customers."))}d.isMDXComponent=!0},7480:function(e,t,r){t.Z=r.p+"assets/images/arch_customervpc-9606898420e67c54bfda2880228e6f3a.png"}}]);