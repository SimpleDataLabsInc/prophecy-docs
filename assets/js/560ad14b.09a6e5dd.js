"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[1796],{15680:(e,t,a)=>{a.d(t,{xA:()=>d,yg:()=>m});var n=a(96540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},d=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),p=l(a),u=r,m=p["".concat(c,".").concat(u)]||p[u]||h[u]||o;return a?n.createElement(m,s(s({ref:t},d),{},{components:a})):n.createElement(m,s({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[p]="string"==typeof e?e:r,s[1]=i;for(var l=2;l<o;l++)s[l]=a[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},76022:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var n=a(58168),r=(a(96540),a(15680));const o={title:"Metadata Connections",id:"metadata-connections",description:"Sync catalogs, tables, schemas, etc into Prophecy's project viewer",sidebar_position:3,tags:["metadata","datasets","tables","connections","data"]},s=void 0,i={unversionedId:"concepts/fabrics/metadata-connections",id:"concepts/fabrics/metadata-connections",title:"Metadata Connections",description:"Sync catalogs, tables, schemas, etc into Prophecy's project viewer",source:"@site/docs/concepts/fabrics/metadata-connections.md",sourceDirName:"concepts/fabrics",slug:"/concepts/fabrics/metadata-connections",permalink:"/concepts/fabrics/metadata-connections",draft:!1,tags:[{label:"metadata",permalink:"/tags/metadata"},{label:"datasets",permalink:"/tags/datasets"},{label:"tables",permalink:"/tags/tables"},{label:"connections",permalink:"/tags/connections"},{label:"data",permalink:"/tags/data"}],version:"current",sidebarPosition:3,frontMatter:{title:"Metadata Connections",id:"metadata-connections",description:"Sync catalogs, tables, schemas, etc into Prophecy's project viewer",sidebar_position:3,tags:["metadata","datasets","tables","connections","data"]},sidebar:"mySidebar",previous:{title:"Fabrics",permalink:"/concepts/fabrics/"},next:{title:"Git",permalink:"/concepts/git/"}},c={},l=[{value:"Definition of entities",id:"definition-of-entities",level:2},{value:"Metadata Connection",id:"metadata-connection",level:3},{value:"Fabric",id:"fabric",level:3},{value:"Cluster/Warehouse",id:"clusterwarehouse",level:3},{value:"Setup Resources",id:"setup-resources",level:2},{value:"Setup Provider Tokens",id:"setup-provider-tokens",level:3},{value:"Grant permissions",id:"grant-permissions",level:3},{value:"Setup SQL Warehouse or Cluster",id:"setup-sql-warehouse-or-cluster",level:3},{value:"Setup Prophecy Entities",id:"setup-prophecy-entities",level:2},{value:"User Permissions",id:"user-permissions",level:3},{value:"Add a Metadata Connection",id:"add-a-metadata-connection",level:3}],d={toc:l},p="wrapper";function h(e){let{components:t,...o}=e;return(0,r.yg)(p,(0,n.A)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"At Prophecy we're always looking to make your development faster. For teams that manage hundreds or thousands of tables, listing data catalogs, tables, and schemas can take precious minutes. In order to make this easier, Prophecy introduced Metadata Connections in release 3.2. The major benefit to Metadata Connections: you can list and view your data directly in the ",(0,r.yg)("a",{parentName:"p",href:"/concepts/project/#Environment-tab"},"Prophecy UI"),"."),(0,r.yg)("p",null,"Let's get down to basics by ",(0,r.yg)("a",{parentName:"p",href:"#definition-of-entities"},"defining")," the relevant entities in Prophecy, setup the relevant data resource, then we'll walk through how to ",(0,r.yg)("a",{parentName:"p",href:"/#setup-resources"},"setup")," Metadata Connections in Prophecy."),(0,r.yg)("h2",{id:"definition-of-entities"},"Definition of entities"),(0,r.yg)("h3",{id:"metadata-connection"},"Metadata Connection"),(0,r.yg)("p",null,"A Metadata Connection is a user-defined link between Prophecy and a data provider. Its purpose is to establish communication between Prophecy and external systems. For instance, a Metadata Connection can be established between Prophecy and platforms like Databricks (Catalog or JDBC). Different from Metadata Connections, Prophecy also supports Airflow Connections which perform a similar function for Airflow jobs."),(0,r.yg)("h3",{id:"fabric"},"Fabric"),(0,r.yg)("p",null,"A fabric represents a logical grouping of Connections. For Prophecy 3.2, each fabric will enable only one Metadata Connection. Fabrics contain the user credentials for a data provider, whereas Metadata Connections have the added benefit of syncing metadata from the data provider at a defined interval."),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},"The fabric token should provide the user's personal permissions to read / write data.\nThe Metadata Connection token, optionally provided to enhance performance, should be a service principal with read-only permissions on the appropriate catalog and JDBC tables.")),(0,r.yg)("h3",{id:"clusterwarehouse"},"Cluster/Warehouse"),(0,r.yg)("p",null,"A Cluster, also referred to as a Warehouse, represents a collection of resources that a Metadata Connection can utilize. Clusters are specific to certain data platforms or systems. For instance, a Snowflake Metadata Connection can access different warehouses that are available to the user. By associating a Metadata Connection with a workspace or warehouse, users can leverage the resources defined by the data providers."),(0,r.yg)("h2",{id:"setup-resources"},"Setup Resources"),(0,r.yg)("h3",{id:"setup-provider-tokens"},"Setup Provider Tokens"),(0,r.yg)("p",null,"Prophecy Metadata Connections will use APIs to make calls to your data provider accounts. For this access, a Service Principal is recommended. For Databricks providers, follow these ",(0,r.yg)("a",{parentName:"p",href:"https://docs.databricks.com/en/dev-tools/service-principals.html#provision-a-service-principal-for-databricks-automation---databricks-ui"},"instructions")," to create a service principal and associated token. If you are unable to setup a Service Principal, use a standard Personal Access Token."),(0,r.yg)("p",null,"The Service Principal will need access to the ",(0,r.yg)("a",{parentName:"p",href:"https://docs.databricks.com/en/security/auth-authz/access-control/enable-access-control.html#enable-access-control-for-workspace-objects"},"Workspace")," and, if you're using a cluster for the metadata connection, the Service Principal will need access to create clusters. If you're not using Unity Catalog for the Metadata Connection, the Service Principal will need access to ",(0,r.yg)("a",{parentName:"p",href:"https://docs.databricks.com/en/sql/admin/index.html#grant-user-access-to-databricks-sql"},"Databricks SQL.")),(0,r.yg)("h3",{id:"grant-permissions"},"Grant permissions"),(0,r.yg)("p",null,"The service principal must be able to collect metadata from any desired catalog or metastore in the workspace."),(0,r.yg)("p",null,"To grant the needed permissions on Unity Catalog, grant permissions to the service principal to read the catalogs, which by default grants the same permission on all schemas within that catalog:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"GRANT SELECT ON CATALOG <catalog> TO <service_principal>;\n")),(0,r.yg)("p",null,"To grant the needed permissions on a Hive Metastore, grant usage, read, and select on the catalog, which by default applies these same permissions to the catalog's schemas. These permissions would be needed for any relevant metastore catalog in addition to the default Hive Metastore catalog."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"GRANT USAGE, READ_METADATA, SELECT ON CATALOG <hive_metastore> TO <service_principal>;\n")),(0,r.yg)("h3",{id:"setup-sql-warehouse-or-cluster"},"Setup SQL Warehouse or Cluster"),(0,r.yg)("p",null,"Prophecy supports metadata collection through SQL Warehouses and Clusters on Databricks and Snowflake. In general, we recommend to create a ",(0,r.yg)("a",{parentName:"p",href:"https://docs.databricks.com/en/sql/admin/create-sql-warehouse.html#create-a-sql-warehouse"},"SQL Warehouse")," or cluster dedicated to the Metadata Connection. Using this approach, the recurring metadata syncs can have a cluster defined with appropriate resources, whereas execution clusters defined in the ",(0,r.yg)("a",{parentName:"p",href:"/concepts/fabrics/"},"fabric")," ",(0,r.yg)("inlineCode",{parentName:"p"},"Provider")," would have a separate resource profile."),(0,r.yg)("p",null,"Alternatively, the Metadata Connection can use the same Warehouse or Cluster which is being used for execution. In that case, the resources would be shared."),(0,r.yg)("h2",{id:"setup-prophecy-entities"},"Setup Prophecy Entities"),(0,r.yg)("h3",{id:"user-permissions"},"User Permissions"),(0,r.yg)("p",null,"System Admins can define and monitor Metadata Connections for platform users. Then, Data Practitioners can use Metadata Connections within their pipelines."),(0,r.yg)("h3",{id:"add-a-metadata-connection"},"Add a Metadata Connection"),(0,r.yg)("p",null,"Once a ",(0,r.yg)("a",{parentName:"p",href:"/administration/Spark-fabrics/databricks/"},"fabric")," is ",(0,r.yg)("strong",{parentName:"p"},"(1)created"),", a ",(0,r.yg)("strong",{parentName:"p"},"(2)Metadata Connection")," is an optional step to enable syncing metadata for a particular cluster or warehouse accessible via the Data Provider. Add a Metadata Connection by providing the following details."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"CreateConnection",src:a(31970).A,width:"2880",height:"1726"})),(0,r.yg)("p",null,"Define a ",(0,r.yg)("strong",{parentName:"p"},"(3)Connection Name"),", and add an optional ",(0,r.yg)("strong",{parentName:"p"},"(4)Description")," for your team's understanding. Define the ",(0,r.yg)("strong",{parentName:"p"},"(5)Workspace URL"),", which could be a Databricks workspace. Within that Workspace, all the accessible Data Catalogs will be included in the syncing. If you choose to define a ",(0,r.yg)("strong",{parentName:"p"},"(6)JDBC URL")," different than that defined in the fabric, the Metadata Connection JDBC will be the only JDBC included in the syncing. Now define the ",(0,r.yg)("strong",{parentName:"p"},"(7)Access Token")," for the Metadata Connection. Like the JDBC URL, the Access Token is only required if different from that defined in the fabric. The Access Token created for the workspace must have read permission for the Catalogs or JDBC databases, tables, and schemas of interest. The access token should be a ",(0,r.yg)("a",{parentName:"p",href:"https://docs.databricks.com/en/administration-guide/users-groups/service-principals.html#manage-service-principals-in-your-account"},"service principle token")," (recommended) or a personal access token."),(0,r.yg)("p",null,"Define the ",(0,r.yg)("strong",{parentName:"p"},"(8)Refresh Frequency")," for Prophecy to sync the metadata from the workspace catalogs and JDBC warehouses accessible to the access token. ",(0,r.yg)("strong",{parentName:"p"},"(9)Enable")," the Metadata Connection to proceed with the sync and ",(0,r.yg)("strong",{parentName:"p"},"(10)Add")," the Metadata Connection."),(0,r.yg)("p",null,"Once a Connection is configured, the Connection details will be used to display data in the ",(0,r.yg)("a",{parentName:"p",href:"/concepts/project/#project-browser"},"Project Browser")," ",(0,r.yg)("inlineCode",{parentName:"p"},"Environment")," tab."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"AddGem",src:a(58763).A,width:"2880",height:"1726"})),(0,r.yg)("p",null,"Inside a project, ",(0,r.yg)("strong",{parentName:"p"},"(1)Attach a Fabric")," which has a Metadata Connection. Now the ",(0,r.yg)("strong",{parentName:"p"},"(2)Environment")," tab lists the data accessible in the provider ",(0,r.yg)("strong",{parentName:"p"},"(3)Workspace")," synced at the frequency defined in the Metadata Connection. So thousands of tables should be visible more quickly as the data is synced regularly. Browse the catalogs, databases, and tables. Add a ",(0,r.yg)("strong",{parentName:"p"},"(4)table")," to the canvas as a dataset, and define whether your dataset should be a ",(0,r.yg)("strong",{parentName:"p"},"(5)Source or Target"),". Now the dataset ",(0,r.yg)("strong",{parentName:"p"},"(6)appears")," on the canvas, ready for transformations."),(0,r.yg)("admonition",{type:"caution"},(0,r.yg)("p",{parentName:"admonition"},"Only one Metadata Connection can be enabled per fabric at once.")))}h.isMDXComponent=!0},31970:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/1-create-connection-32e780af5ae3aae96d48e0f88b34cf15.png"},58763:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/2-add-gem-51174acca3a1248cd4d1527fdc38260a.png"}}]);