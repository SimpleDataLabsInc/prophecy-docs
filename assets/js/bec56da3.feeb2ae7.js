"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[28838],{15680:(e,n,t)=>{t.d(n,{xA:()=>p,yg:()=>d});var a=t(96540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=a.createContext({}),u=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=u(e.components);return a.createElement(o.Provider,{value:n},e.children)},g="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),g=u(t),m=r,d=g["".concat(o,".").concat(m)]||g[m]||c[m]||i;return t?a.createElement(d,s(s({ref:n},p),{},{components:t})):a.createElement(d,s({ref:n},p))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,s=new Array(i);s[0]=m;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l[g]="string"==typeof e?e:r,s[1]=l;for(var u=2;u<i;u++)s[u]=t[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},10511:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var a=t(58168),r=(t(96540),t(15680));const i={sidebar_position:8,title:"Business Rules Engine",id:"business-rules-engine",description:"Create business rules as functions",tags:["business rules"]},s=void 0,l={unversionedId:"Spark/business-rules-engine/business-rules-engine",id:"Spark/business-rules-engine/business-rules-engine",title:"Business Rules Engine",description:"Create business rules as functions",source:"@site/docs/Spark/business-rules-engine/business-rules-engine.md",sourceDirName:"Spark/business-rules-engine",slug:"/Spark/business-rules-engine/",permalink:"/Spark/business-rules-engine/",draft:!1,tags:[{label:"business rules",permalink:"/tags/business-rules"}],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8,title:"Business Rules Engine",id:"business-rules-engine",description:"Create business rules as functions",tags:["business rules"]},sidebar:"mySidebar",previous:{title:"Unit Testing",permalink:"/Spark/tests"},next:{title:"Pipeline Monitoring",permalink:"/Spark/pipeline-monitoring/"}},o={},u=[{value:"Configuration",id:"configuration",level:2},{value:"Create a business rule",id:"create-a-business-rule",level:2},{value:"Example: IdentifyHighSpendingCustomer",id:"example-identifyhighspendingcustomer",level:3},{value:"Use a business rule in your Pipeline",id:"use-a-business-rule-in-your-pipeline",level:2},{value:"Managing business rules in Packages",id:"managing-business-rules-in-packages",level:2},{value:"Example: PromoCodeRule",id:"example-promocoderule",level:3},{value:"Viewing the business rules in code",id:"viewing-the-business-rules-in-code",level:2}],p={toc:u},g="wrapper";function c(e){let{components:n,...i}=e;return(0,r.yg)(g,(0,a.A)({},p,i,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Business rules can be created in Spark Projects as functions. They can also be grouped and released via ",(0,r.yg)("a",{parentName:"p",href:"/package-hub/"},"Packages"),"."),(0,r.yg)("h2",{id:"configuration"},"Configuration"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Field"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Column Name"),(0,r.yg)("td",{parentName:"tr",align:null},"The name of the output column that the business rule will calculate.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Parameters"),(0,r.yg)("td",{parentName:"tr",align:null},"The columns you would like to use in your business rule condition(s). Each column must have a Name and Type defined.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Rules"),(0,r.yg)("td",{parentName:"tr",align:null},"The set(s) of conditions that define the business rule.")))),(0,r.yg)("h2",{id:"create-a-business-rule"},"Create a business rule"),(0,r.yg)("p",null,"To create a new business rule:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"In the Project browser, click the ",(0,r.yg)("strong",{parentName:"li"},"plus")," icon next to ",(0,r.yg)("strong",{parentName:"li"},"Functions"),"."),(0,r.yg)("li",{parentName:"ol"},"Name the Rule and choose ",(0,r.yg)("strong",{parentName:"li"},"Business Rule")," as the ",(0,r.yg)("strong",{parentName:"li"},"Function Type"),". Then, click ",(0,r.yg)("strong",{parentName:"li"},"OK"),".")),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Create business rule",src:t(68718).A,width:"2812",height:"900"})),(0,r.yg)("p",null,"Next, you need to define the rule parameters."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Fill in the ",(0,r.yg)("strong",{parentName:"li"},"Column Name"),". This will be the name of your output column."),(0,r.yg)("li",{parentName:"ol"},"Define columns in the ",(0,r.yg)("strong",{parentName:"li"},"Parameters")," table using a Name, Type, and (optionally) Description."),(0,r.yg)("li",{parentName:"ol"},"Each column in the ",(0,r.yg)("strong",{parentName:"li"},"Parameters")," table will automatically be added to the ",(0,r.yg)("strong",{parentName:"li"},"Rules")," table under ",(0,r.yg)("strong",{parentName:"li"},"Inputs"),".")),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Rule Parameters",src:t(96337).A,width:"2620",height:"1508"})),(0,r.yg)("p",null,"Each row in the Rules table corresponds to one rule condition. To add a rule condition:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Add conditions under the corresponding inputs in SQL expression format. Note that each expression must be true in a row (logical ",(0,r.yg)("inlineCode",{parentName:"li"},"AND"),") for the rule condition to be met."),(0,r.yg)("li",{parentName:"ol"},"Add an output value for your condition. This can be a hard-coded value, or you can write in SQL expression format. The default output value is ",(0,r.yg)("inlineCode",{parentName:"li"},"Null"),"."),(0,r.yg)("li",{parentName:"ol"},"Optionally, you can add a description of the rule.")),(0,r.yg)("h3",{id:"example-identifyhighspendingcustomer"},"Example: IdentifyHighSpendingCustomer"),(0,r.yg)("p",null,"Take a look at the business rule in the following image."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"IdentifyHighSpendingCustomer Rule",src:t(5460).A,width:"2620",height:"1508"})),(0,r.yg)("p",null,"In this example, we created an ",(0,r.yg)("strong",{parentName:"p"},"IdentifyHighSpendingCustomer")," business rule. This rule represents the following statement:"),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"If a customer's spending is more than $500, or their total order amount is more than $500, then they are a high spending customer. Otherwise, they are not a high spending customer.")),(0,r.yg)("p",null,"As you can see, we needed to use multiple rule conditions to achieve this outcome. Additionally, you can see that the output is either ",(0,r.yg)("inlineCode",{parentName:"p"},"1")," or ",(0,r.yg)("inlineCode",{parentName:"p"},"0"),".\nThis is because we decided to represent whether a customer was a high spender or not with a binary flag."),(0,r.yg)("h2",{id:"use-a-business-rule-in-your-pipeline"},"Use a business rule in your Pipeline"),(0,r.yg)("p",null,"To use a business rule in your Pipeline, you can use the ",(0,r.yg)("a",{parentName:"p",href:"/Spark/gems/transform/schema-transform"},"SchemaTransform Gem"),"."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Add a SchemaTransform Gem to the Pipeline."),(0,r.yg)("li",{parentName:"ol"},"Open the Gem and add the appropriate input."),(0,r.yg)("li",{parentName:"ol"},"Click ",(0,r.yg)("strong",{parentName:"li"},"Add Transformation"),"."),(0,r.yg)("li",{parentName:"ol"},"In the ",(0,r.yg)("strong",{parentName:"li"},"Operation")," dropdown, choose ",(0,r.yg)("strong",{parentName:"li"},"Add Rule"),"."),(0,r.yg)("li",{parentName:"ol"},"Choose the appropriate rule in the ",(0,r.yg)("strong",{parentName:"li"},"Rule")," field. This will populate the ",(0,r.yg)("strong",{parentName:"li"},"New Column")," field. If an input column has the same name as the new column, then its data will be overwritten\u2014no new column will be appended.")),(0,r.yg)("p",null,"After completing these steps, you will see the required inputs for the business rule. Prophecy will automatically check if each the required input columns are present in the Gem input. Prophecy will also check to see if the column types match. Any error messages can be found in the Diagnostics of the Gem."),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"You can add multiple business rules to the SchemaTransform Gem at a time. You can also use the output column of one rule as an input column for a subsequent rule.")),(0,r.yg)("h2",{id:"managing-business-rules-in-packages"},"Managing business rules in Packages"),(0,r.yg)("p",null,"You can also import business rules into Projects via Packages. Imported rules are read-only and can only be edited from their source Project."),(0,r.yg)("p",null,"This can be useful if:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"You want to group rules by their function or use case."),(0,r.yg)("li",{parentName:"ul"},"You only want specific users to create and edit rules."),(0,r.yg)("li",{parentName:"ul"},"You want to reuse rules in multiple projects.")),(0,r.yg)("h3",{id:"example-promocoderule"},"Example: PromoCodeRule"),(0,r.yg)("p",null,"Let's say you want to create a PromoCodeRule that will be used in various other Projects."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Start by creating a Project where you will define the business rule."),(0,r.yg)("li",{parentName:"ol"},"Add the business rule to the Project."),(0,r.yg)("li",{parentName:"ol"},"Commit your changes to the Project."),(0,r.yg)("li",{parentName:"ol"},"Merge the changes to the main branch."),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("a",{parentName:"li",href:"/deployment/##how-to-release-a-project"},"Release and deploy")," the Project.")),(0,r.yg)("p",null,"Then, you must give other users access to your Project."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"In your Project metadata, open the ",(0,r.yg)("strong",{parentName:"li"},"Access")," tab."),(0,r.yg)("li",{parentName:"ol"},"Toggle-on the option to ",(0,r.yg)("strong",{parentName:"li"},"Publish to Package Hub"),". This will make the Package available to others.")),(0,r.yg)("p",null,"When someone adds the Package as a ",(0,r.yg)("a",{parentName:"p",href:"/Spark/extensibility/dependencies"},"dependency")," in their Project, they will be able to see the rule definition. However, they will not be able to edit the fields."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"PromoCodeRule",src:t(77597).A,width:"2620",height:"1508"})),(0,r.yg)("p",null,"This example rule includes a set of conditions to determine the type of promotions that a customer is eligible for."),(0,r.yg)("h2",{id:"viewing-the-business-rules-in-code"},"Viewing the business rules in code"),(0,r.yg)("p",null,"Prophecy automatically compiles visually-developed business rules into code."),(0,r.yg)("p",null,"Business rules are stored in the ",(0,r.yg)("strong",{parentName:"p"},"functions")," folder of your Pipeline's code. This is true for both Python and Scala Projects. Note that you can also see the imported business rules in the code view."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Business rules in Python and Scala",src:t(31005).A,width:"2812",height:"900"})))}c.isMDXComponent=!0},31005:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/bre-code-0a0f8e886214c9b99fa54c361764e6ed.png"},68718:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/create-bre-f7259c8757bdf33d39b9bc2326c9de1e.png"},5460:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/high-spending-rule-8c80a66b0ba6aa44ec3663f734e22a83.png"},77597:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/promo-code-rule-5f8f098a278077d983a770ffcab8cc84.png"},96337:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/rule-parameters-8a48e6fbff4ec978a80ceaeb12941994.png"}}]);