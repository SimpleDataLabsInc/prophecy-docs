"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[62974],{3116:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-new-definition-9d021f9b34b9f8a0c12e15614b19055f.png"},8793:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-create-new-113413f515ccadef0f57f9070105b686.png"},9826:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-advanced-6dc5eee7d59abbcea42809b7c1f654ed.png"},22871:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"analysts/development/data-tests/use-model-tests","title":"Use model and column tests","description":"Reusable SQL query tests","source":"@site/docs/analysts/development/data-tests/use-model-tests.md","sourceDirName":"analysts/development/data-tests","slug":"/analysts/model-column-tests","permalink":"/analysts/model-column-tests","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"how-to","permalink":"/tags/how-to"},{"inline":true,"label":"testing","permalink":"/tags/testing"},{"inline":true,"label":"sql","permalink":"/tags/sql"}],"version":"current","frontMatter":{"title":"Use model and column tests","id":"use-model-tests","slug":"/analysts/model-column-tests","description":"Reusable SQL query tests","tags":["how-to","testing","sql"]},"sidebar":"mySidebar","previous":{"title":"Data tests for SQL","permalink":"/analysts/data-tests"},"next":{"title":"Use project tests","permalink":"/analysts/project-tests"}}');var o=s(74848),i=s(28453);const a={title:"Use model and column tests",id:"use-model-tests",slug:"/analysts/model-column-tests",description:"Reusable SQL query tests",tags:["how-to","testing","sql"]},r=void 0,l={},d=[{value:"Set up a test",id:"set-up-a-test",level:2},{value:"Develop a test",id:"develop-a-test",level:3},{value:"Run a test",id:"run-a-test",level:3},{value:"Fix a failed test",id:"fix-a-failed-test",level:2},{value:"Configure a test",id:"configure-a-test",level:2},{value:"Schedule a test",id:"schedule-a-test",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["Model and column data tests are dbt macro generated tests that can be parametrized and applied to a given model or any number of columns. These tests are called generic data tests, and are based on the following ",(0,o.jsx)(t.a,{href:"https://docs.getdbt.com/docs/build/data-tests#generic-data-tests",children:"dbt generic test types"}),"."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Model-level tests: Can span across many columns for a given model, or even multiple models, and are defined at a model level"}),"\n",(0,o.jsx)(t.li,{children:"Column-level tests: Are defined on a column level of each model"}),"\n"]}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"There could be many tests within a project. Each test is checking a table created by your choice of input models, data sources, and transformation gems."})}),"\n",(0,o.jsx)(t.p,{children:"For each model, you can create a macro-based test definition to use as a model test."}),"\n",(0,o.jsx)(t.p,{children:"For each column within a model, you can define out-of-the-box supported dbt Simple data tests."}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Unique: Asserts that each value within a column is unique"}),"\n",(0,o.jsx)(t.li,{children:"Not null: Asserts that each value within a column is not null"}),"\n",(0,o.jsx)(t.li,{children:"Accepted values: Asserts that column contains values present within a pre-defined set of values"}),"\n",(0,o.jsx)(t.li,{children:"Relationships: Asserts that column contains values present within another column"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"You can also use generic tests defined within the project or those defined within dependency packages."}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"Prophecy doesn't differentiate between model and column tests, and refers to these generic tests as simply data tests."})}),"\n",(0,o.jsx)(t.h2,{id:"set-up-a-test",children:"Set up a test"}),"\n",(0,o.jsx)(t.p,{children:"Depending on the type of test, you can set up a new model or column test from either the Tests section of the project tab or the Data Tests tab of the Target model."}),"\n",(0,o.jsx)(t.h3,{id:"develop-a-test",children:"Develop a test"}),"\n",(0,o.jsx)(t.p,{children:"You can create a new data test definition to use in your model or column test. You can also skip creating a data test definition, and use one of the Simple data tests previously mentioned."}),"\n",(0,o.jsx)(t.p,{children:"To develop a model or column test, start by opening a project:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Under the Project Browser, click ",(0,o.jsx)(t.strong,{children:"Add Test definition"}),". You can also click ",(0,o.jsx)(t.strong,{children:"+ New Data Test Type"})," from the Target Model Data Tests tab."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Add a new model test definition",src:s(3116).A+"",width:"2812",height:"897"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Enter your ",(0,o.jsx)(t.strong,{children:"Test Definition Name"}),", and then click ",(0,o.jsx)(t.strong,{children:"Create"}),". The test definition page opens. Data tests are saved to a tests > generic SQL file in the Git directory by default."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Create a new model test definition",src:s(77080).A+"",width:"2812",height:"898"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"On the test definition page, enter the description, parameters, and definition. In the previous image example, we created a test definition that checks that the column value doesn't exceed a certain threshold value."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["To create a new data test, whether it's one that uses a test definition or one that uses an out-of-the-box Simple data test, navigate to the Data Tests tab in the Target model, and then click ",(0,o.jsx)(t.strong,{children:"+ New Test"}),"."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Create a new model test",src:s(8793).A+"",width:"2620",height:"1507"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Choose your Data Test Type from the drop down menu, and then click ",(0,o.jsx)(t.strong,{children:"Create Test"}),". You can find the Simple data tests, the test definition you created earlier under the current project name, and any data tests from dependencies connected to your project listed here."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Create a new model test type",src:s(98611).A+"",width:"2620",height:"1507"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["After selecting your Data Test Type, fill out the column fields and any other required for your data test. The following image example on the left uses the Simple data test ",(0,o.jsx)(t.code,{children:"unique"}),", while the example on the right uses the created test definition."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Model test types examples",src:s(74549).A+"",width:"2812",height:"898"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.admonition,{type:"caution",children:(0,o.jsx)(t.p,{children:"If changes are made to the columns or schemas used in your data test, then Prophecy will delete the data test. For example, if you run into a data mismatch error on the Schema tab of your Target model or update the schema, then your data test will be affected."})}),"\n",(0,o.jsx)(t.h3,{id:"run-a-test",children:"Run a test"}),"\n",(0,o.jsx)(t.p,{children:"After you\u2019ve developed your model or column test, you can run it."}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["From the Data Tests tab of your Target model, select the data tests that you'd like to run, and then click ",(0,o.jsx)(t.strong,{children:"Run tests"})," to execute your tests. The table input to the Target model gem is what\u2019s tested."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Run model tests",src:s(60725).A+"",width:"2812",height:"898"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["You can click to view the ",(0,o.jsx)(t.strong,{children:"Test Summary"}),", ",(0,o.jsx)(t.strong,{children:"Copy"})," the logs, or ",(0,o.jsx)(t.strong,{children:"Download"})," them. Depending on the outcome of the test, different colored icons are presented."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"fix-a-failed-test",children:"Fix a failed test"}),"\n",(0,o.jsxs)(t.p,{children:["If your model or column test fails, you can check the stored failed records using the Store Failures advanced setting. See ",(0,o.jsx)(t.a,{href:"#configure-a-test",children:"Configure a test"})," to learn how to set up this setting."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Check the test output tables to see your failed rows."}),"\n"]}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"Make sure you have write permission to create a new table in your data warehouse, otherwise you may run into errors while trying to run your own tests."})}),"\n",(0,o.jsx)(t.h2,{id:"configure-a-test",children:"Configure a test"}),"\n",(0,o.jsx)(t.p,{children:"You can configure your model or column test to help decide which cases to focus on."}),"\n",(0,o.jsx)(t.p,{children:"To configure a test, follow these steps:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"From the Data Tests tab of your Target model, hover over the data test that you'd like to configure, and then click the edit icon."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Edit a test",src:s(99424).A+"",width:"2620",height:"1507"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Click ",(0,o.jsx)(t.strong,{children:"Advanced"})," to open the advanced settings, and then enter the conditional values for the following options:"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Advanced settings",src:s(9826).A+"",width:"2620",height:"1507"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Continued Advanced settings",src:s(26038).A+"",width:"2812",height:"898"})}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"(A)"})," ",(0,o.jsx)(t.strong,{children:"Filter Condition"}),": Sets a filter for what you want your test to run on."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"(B)"})," ",(0,o.jsx)(t.strong,{children:"Severity"}),": Determines whether the failure of the test returns an error or warning. The severity operates from the highest priority selection, error, to the lowest, warning. So if you select error, then the test first checks for errors. If it doesn\u2019t find any, then it then checks for warnings. If you select warning, then the test only checks for warnings. If you don\u2019t select a severity, then error is chosen by default.\nYou can set conditions for when to return an error or warning using ",(0,o.jsx)(t.strong,{children:"Error If"})," and ",(0,o.jsx)(t.strong,{children:"Warn If"})," respectively. You can set the number of failed rows to determine an error, or otherwise just return a warning."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"(C)"})," ",(0,o.jsx)(t.strong,{children:"Store Failures"}),": Stores all records that failed the test. The records are saved in a new table with schema ",(0,o.jsx)(t.code,{children:"dbt_test\\_\\_audit"})," in your database. The table is named after the name of the model and data test."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"(D)"})," ",(0,o.jsx)(t.strong,{children:"Set max no of failures"}),": Sets the maximum number of failures returned by a test query. You can set the limit to save resources and time by having the test stop its query as soon as it encounters a certain number of failed rows."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Click ",(0,o.jsx)(t.strong,{children:"Save"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"schedule-a-test",children:"Schedule a test"}),"\n",(0,o.jsx)(t.p,{children:"When scheduling your project, you can opt in to run a test along with the project or model. Scheduling a test allows you to ensure on a daily basis that your data is correct. You can only schedule a test with a project or model. You cannot schedule one individually."}),"\n",(0,o.jsx)(t.p,{children:"To Schedule your project to run with tests, follow these steps:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Under the Project Browser, click ",(0,o.jsx)(t.strong,{children:"Add Job"}),". Enter a name for your job and click ",(0,o.jsx)(t.strong,{children:"Create New"}),"."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Create a job",src:s(46122).A+"",width:"2812",height:"898"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Drag a Model gem to your visual canvas."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Click the model to open the model properties."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Select the database object you want to run the test on. You can schedule the entire project or just a single model:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Run entire project"}),"\n",(0,o.jsx)(t.li,{children:"Run a SQL model"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Schedule a job",src:s(71461).A+"",width:"2620",height:"1507"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Select ",(0,o.jsx)(t.strong,{children:"Run tests"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Check that your ",(0,o.jsx)(t.strong,{children:"project, model"}),", and ",(0,o.jsx)(t.strong,{children:"fabric"})," are correct."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Click ",(0,o.jsx)(t.strong,{children:"Save"}),". The job runs automatically. You can see the job status by clicking ",(0,o.jsx)(t.strong,{children:"Detail"}),"."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},26038:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-advanced-settings-90548798cc9b872af73c35d8e18884aa.png"},28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>r});var n=s(96540);const o={},i=n.createContext(o);function a(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(i.Provider,{value:t},e.children)}},46122:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-create-job-b0fb009053ee2c16abb348a7c8a3bcef.png"},60725:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-run-27f41cdc447c050ba34a2c4ae96ba8b1.png"},71461:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-schedule-job-2912c896ee7ccd09cbbde3bde93fed27.png"},74549:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-types-0cc8c9be7be2efa76a9bd2df9795e66d.png"},77080:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-create-definition-c089e4a452ed4babfa172865aef8a3bf.png"},98611:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-new-test-bce5fc3606997e45c6f3a8281b2023bc.png"},99424:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/model-test-edit-1eab9ec03f3192abec711e5689deb3dc.png"}}]);