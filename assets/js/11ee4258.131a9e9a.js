"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[57654],{15680:(e,n,t)=>{t.d(n,{xA:()=>g,yg:()=>m});var r=t(96540);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=r.createContext({}),p=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},g=function(e){var n=p(e.components);return r.createElement(l.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},y=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,g=s(e,["components","mdxType","originalType","parentName"]),c=p(t),y=i,m=c["".concat(l,".").concat(y)]||c[y]||u[y]||a;return t?r.createElement(m,o(o({ref:n},g),{},{components:t})):r.createElement(m,o({ref:n},g))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,o=new Array(a);o[0]=y;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[c]="string"==typeof e?e:i,o[1]=s;for(var p=2;p<a;p++)o[p]=t[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}y.displayName="MDXCreateElement"},25437:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=t(58168),i=(t(96540),t(15680));const a={title:"SAML Using AzureAD with SCIM",id:"azuread-scim",description:"SAML authentication using AzureAD with SCIM",sidebar_position:4,tags:["authentication","saml","azuread","scim"]},o=void 0,s={unversionedId:"architecture/self-hosted/authentication/azuread-scim",id:"architecture/self-hosted/authentication/azuread-scim",title:"SAML Using AzureAD with SCIM",description:"SAML authentication using AzureAD with SCIM",source:"@site/docs/architecture/self-hosted/authentication/azuread-scim.md",sourceDirName:"architecture/self-hosted/authentication",slug:"/architecture/self-hosted/authentication/azuread-scim",permalink:"/architecture/self-hosted/authentication/azuread-scim",draft:!1,tags:[{label:"authentication",permalink:"/tags/authentication"},{label:"saml",permalink:"/tags/saml"},{label:"azuread",permalink:"/tags/azuread"},{label:"scim",permalink:"/tags/scim"}],version:"current",sidebarPosition:4,frontMatter:{title:"SAML Using AzureAD with SCIM",id:"azuread-scim",description:"SAML authentication using AzureAD with SCIM",sidebar_position:4,tags:["authentication","saml","azuread","scim"]},sidebar:"mySidebar",previous:{title:"Azure Active Directory",permalink:"/architecture/self-hosted/authentication/azure-ad"},next:{title:"SAML Using Okta",permalink:"/architecture/self-hosted/authentication/saml-okta"}},l={},p=[{value:"Configure AzureAD",id:"configure-azuread",level:2},{value:"Basic SAML Configuration",id:"basic-saml-configuration",level:3},{value:"Attributes &amp; Claims",id:"attributes--claims",level:3},{value:"SAML certificates",id:"saml-certificates",level:3},{value:"Set up ProphecyAzureADApp",id:"set-up-prophecyazureadapp",level:3},{value:"Configure Prophecy to connect to Azure AD",id:"configure-prophecy-to-connect-to-azure-ad",level:2},{value:"Assigning Users/Groups to Prophecy in Azure AD",id:"assigning-usersgroups-to-prophecy-in-azure-ad",level:2},{value:"Sync Users and Groups from Azure AD using SCIM",id:"sync-users-and-groups-from-azure-ad-using-scim",level:2},{value:"Requirements",id:"requirements",level:3},{value:"About SCIM provisioning in Prophecy",id:"about-scim-provisioning-in-prophecy",level:3},{value:"Enable SCIM Provisioning for <em>Prophecy Enterprise App</em> in AzureAD",id:"enable-scim-provisioning-for-prophecy-enterprise-app-in-azuread",level:3}],g={toc:p},c="wrapper";function u(e){let{components:n,...a}=e;return(0,i.yg)(c,(0,r.A)({},g,a,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("p",null,"Single sign-on (SSO) enables you to authenticate your users using your organization\u2019s identity provider.\nThis document focuses on using AzureAD as the SAML IdP for Prophecy and enabling SCIM provisioning for syncing users and\ngroups."),(0,i.yg)("h2",{id:"configure-azuread"},"Configure AzureAD"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"Log into AzureAD as an administrator and create a new Enterprise Application like ",(0,i.yg)("inlineCode",{parentName:"li"},"ProphecyAzureADApp"),"."),(0,i.yg)("li",{parentName:"ol"},"In the home page search bar, search for ",(0,i.yg)("strong",{parentName:"li"},"Enterprise Applications"),"."),(0,i.yg)("li",{parentName:"ol"},"Click ",(0,i.yg)("strong",{parentName:"li"},"New Application > Create your own application"),"."),(0,i.yg)("li",{parentName:"ol"},"Give name for the application like ",(0,i.yg)("inlineCode",{parentName:"li"},"ProphecyAzureADApp"),"."),(0,i.yg)("li",{parentName:"ol"},"Choose the radio button ",(0,i.yg)("strong",{parentName:"li"},"Integrate any other application you don't find in the gallery (Non-gallery)"),"."),(0,i.yg)("li",{parentName:"ol"},"Click ",(0,i.yg)("strong",{parentName:"li"},"Create"),"."),(0,i.yg)("li",{parentName:"ol"},"In Manage section on the left, click ",(0,i.yg)("strong",{parentName:"li"},"Single sign-on"),"."),(0,i.yg)("li",{parentName:"ol"},"Choose ",(0,i.yg)("strong",{parentName:"li"},"SAML")," as the Single sign-on method.")),(0,i.yg)("p",null,"Now the form for ",(0,i.yg)("strong",{parentName:"p"},"Set up Single Sign-On with SAML")," will open. You'll have to fill out different sections of the form."),(0,i.yg)("h3",{id:"basic-saml-configuration"},"Basic SAML Configuration"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"Provide an Identifier (Entity ID) which is a unique ID to identify this application to Azure Active Directory."),(0,i.yg)("li",{parentName:"ol"},"In the same section, configure ",(0,i.yg)("strong",{parentName:"li"},"Reply URL")," and ",(0,i.yg)("strong",{parentName:"li"},"Sign on URL")," as:",(0,i.yg)("br",{parentName:"li"}),(0,i.yg)("inlineCode",{parentName:"li"},"https://your-prophecy-ide-url.domain/api/oauth/samlCallback")),(0,i.yg)("li",{parentName:"ol"},"Click ",(0,i.yg)("strong",{parentName:"li"},"Save"),".")),(0,i.yg)("h3",{id:"attributes--claims"},"Attributes & Claims"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"Click ",(0,i.yg)("strong",{parentName:"li"},"Edit")," button and then ",(0,i.yg)("strong",{parentName:"li"},"Add new claim"),"."),(0,i.yg)("li",{parentName:"ol"},"Give ",(0,i.yg)("strong",{parentName:"li"},"Name")," as ",(0,i.yg)("inlineCode",{parentName:"li"},"email")," and ",(0,i.yg)("strong",{parentName:"li"},"Source Attribute")," as ",(0,i.yg)("inlineCode",{parentName:"li"},"user.userprincipalname"),", and click ",(0,i.yg)("strong",{parentName:"li"},"Save"),"."),(0,i.yg)("li",{parentName:"ol"},"Add one more claim by clicking on ",(0,i.yg)("strong",{parentName:"li"},"Add new claim"),"."),(0,i.yg)("li",{parentName:"ol"},"Give ",(0,i.yg)("strong",{parentName:"li"},"Name")," as ",(0,i.yg)("inlineCode",{parentName:"li"},"name")," and ",(0,i.yg)("strong",{parentName:"li"},"Source Attribute")," as ",(0,i.yg)("inlineCode",{parentName:"li"},"user.givenname"),", and click ",(0,i.yg)("strong",{parentName:"li"},"Save"),".")),(0,i.yg)("h3",{id:"saml-certificates"},"SAML certificates"),(0,i.yg)("p",null,"In the ",(0,i.yg)("strong",{parentName:"p"},"SAML certificates")," section, download ",(0,i.yg)("inlineCode",{parentName:"p"},"Certificate (Base64)")," file to be used while configuring SSO in Prophecy UI."),(0,i.yg)("h3",{id:"set-up-prophecyazureadapp"},"Set up ProphecyAzureADApp"),(0,i.yg)("p",null,"In the ",(0,i.yg)("strong",{parentName:"p"},"Set up ProphecyAzureADApp")," section, copy ",(0,i.yg)("inlineCode",{parentName:"p"},"Login URL")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"Azure AD Identifier")," to be used while configuring SSO in Prophecy UI."),(0,i.yg)("p",null,(0,i.yg)("img",{alt:"AzureAD config example",src:t(39092).A,width:"674",height:"679"})),(0,i.yg)("h2",{id:"configure-prophecy-to-connect-to-azure-ad"},"Configure Prophecy to connect to Azure AD"),(0,i.yg)("p",null,"Before configuring rest of the sections like ",(0,i.yg)("strong",{parentName:"p"},"Users and groups")," and ",(0,i.yg)("strong",{parentName:"p"},"Provisioning")," in this Enterprise Application, lets configure SSO in Prophecy UI and get the SCIM token."),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"Log in to Prophecy IDE as an admin user."),(0,i.yg)("li",{parentName:"ol"},"Navigate to the ",(0,i.yg)("strong",{parentName:"li"},"SSO")," tab of the Prophecy ",(0,i.yg)("strong",{parentName:"li"},"Settings")," page."),(0,i.yg)("li",{parentName:"ol"},"Under ",(0,i.yg)("strong",{parentName:"li"},"Authentication Provider"),", select ",(0,i.yg)("strong",{parentName:"li"},"Prophecy Managed"),".")),(0,i.yg)("p",null,(0,i.yg)("img",{alt:"SSO Settings",src:t(63463).A,width:"2780",height:"1282"})),(0,i.yg)("ol",{start:3},(0,i.yg)("li",{parentName:"ol"},"Fill in ",(0,i.yg)("strong",{parentName:"li"},"Organization ID")," and ",(0,i.yg)("strong",{parentName:"li"},"Team Name")," that you want to set for your organization and team respectively. Make sure both these fields are of the regex ",(0,i.yg)("inlineCode",{parentName:"li"},"[a-zA-z0-9]*")," and have no spaces or special characters."),(0,i.yg)("li",{parentName:"ol"},"Click ",(0,i.yg)("strong",{parentName:"li"},"Configure")," to generate a SCIM Token. Make a note of this token, which needs to be filled later while Provisioning SCIM in AzureAD. Also, now the Authentication Provider should show as ",(0,i.yg)("inlineCode",{parentName:"li"},"SAML"),".")),(0,i.yg)("p",null,(0,i.yg)("img",{alt:"SSO Settings With SCIM token",src:t(38714).A,width:"2770",height:"1274"})),(0,i.yg)("ol",{start:5},(0,i.yg)("li",{parentName:"ol"},"Click ",(0,i.yg)("strong",{parentName:"li"},"Save"),"."),(0,i.yg)("li",{parentName:"ol"},"From the IDP dropdown, select ",(0,i.yg)("strong",{parentName:"li"},"Azure Active Directory"),"."),(0,i.yg)("li",{parentName:"ol"},"Fill in ",(0,i.yg)("strong",{parentName:"li"},"SSO URL")," with the Login URL you copied from Azure AD application in the section above."),(0,i.yg)("li",{parentName:"ol"},"Upload the Base64 certificate downloaded from Azure AD application in the section above."),(0,i.yg)("li",{parentName:"ol"},"In the ",(0,i.yg)("strong",{parentName:"li"},"Entity issuer")," field, paste the ",(0,i.yg)("inlineCode",{parentName:"li"},"Identifier (Entity ID)")," you chose in the Azure AD application to identify it to Azure Active Directory. We used ",(0,i.yg)("strong",{parentName:"li"},"prophecyWithSamlEntity")," in a previous example."),(0,i.yg)("li",{parentName:"ol"},"In the ",(0,i.yg)("strong",{parentName:"li"},"SSO issuer")," field, paste the ",(0,i.yg)("inlineCode",{parentName:"li"},"Azure AD Identifier")," you copied from the Azure AD application."),(0,i.yg)("li",{parentName:"ol"},"Once SCIM Provisioning is enabled for the ",(0,i.yg)("em",{parentName:"li"},"Prophecy Enterprise app")," in Azure AD and users/groups are assigned to it, you can logout from Prophecy IDE and the assigned users will be able to login to Prophecy IDE via AzureAD.")),(0,i.yg)("p",null,(0,i.yg)("img",{alt:"SSO Detailed Settings for AzureAD",src:t(53539).A,width:"720",height:"585"})),(0,i.yg)("h2",{id:"assigning-usersgroups-to-prophecy-in-azure-ad"},"Assigning Users/Groups to Prophecy in Azure AD"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"Go to ",(0,i.yg)("strong",{parentName:"li"},"Users and Groups")," tab in the ",(0,i.yg)("strong",{parentName:"li"},"Manage")," section of ",(0,i.yg)("em",{parentName:"li"},"Prophecy Enterprise App")," in Azure AD."),(0,i.yg)("li",{parentName:"ol"},"Click ",(0,i.yg)("strong",{parentName:"li"},"Add user/group > Users/Groups None Selected"),". Search for your users/groups and assign them to Prophecy app.")),(0,i.yg)("p",null,"Note: To be able to assign groups to an Enterprise Application in Azure, your plan should be ",(0,i.yg)("strong",{parentName:"p"},"Azure AD Premium P2"),"."),(0,i.yg)("h2",{id:"sync-users-and-groups-from-azure-ad-using-scim"},"Sync Users and Groups from Azure AD using SCIM"),(0,i.yg)("p",null,"This section describes how to configure your Azure AD and Prophecy to provision users and groups to Prophecy using SCIM,\nor System for Cross-domain Identity Management, an open standard that allows you to automate user provisioning."),(0,i.yg)("h3",{id:"requirements"},"Requirements"),(0,i.yg)("p",null,"To provision users/groups to your Prophecy account using SCIM:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"You must be AzureAD admin."),(0,i.yg)("li",{parentName:"ul"},"You must be a Prophecy account admin.")),(0,i.yg)("h3",{id:"about-scim-provisioning-in-prophecy"},"About SCIM provisioning in Prophecy"),(0,i.yg)("p",null,"Prophecy provides a SCIM connector that lets you use Azure AD to create/update users and groups/teams in Prophecy, give them the proper level of access,\nand remove access (de-provision them) when they leave your organization or no longer need access to Prophecy."),(0,i.yg)("p",null,"The ",(0,i.yg)("em",{parentName:"p"},"Prophecy Enterprise App")," in Azure AD must be assigned to users/groups in AzureAD for the SCIM connector to be triggered and\ncreate corresponding users in Prophecy."),(0,i.yg)("p",null,"Note:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Importing user/groups from AzureAD to Prophecy is supported but not vice-versa i.e. any changes made to a synced user in\nProphecy IDE will not be synced back to AzureAD and will get overwritten whenever any update to user is synced from AzureAD."),(0,i.yg)("li",{parentName:"ul"},"Any changes to user/groups in AzureAD are not immediately synced from AzureAD to Prophecy and get reflected in next synchronization cycle. If you want the changes to immediately reflect in Prophecy,\nyou need to go to ",(0,i.yg)("inlineCode",{parentName:"li"},"Provisioning")," section of ",(0,i.yg)("em",{parentName:"li"},"Prophecy Enterprise App")," and click ",(0,i.yg)("inlineCode",{parentName:"li"},"Provision on Demand"),"."),(0,i.yg)("li",{parentName:"ul"},"Updates to primary email is not supported in Prophecy via SCIM."),(0,i.yg)("li",{parentName:"ul"},"Login via secondary emails registered with AzureAD is not supported in Prophecy."),(0,i.yg)("li",{parentName:"ul"},"De-provisioning of a user from Azure deletes that user from Prophecy and not deactivates it. As a result, a\nde-provisioned user will lose their personal projects in Prophecy.")),(0,i.yg)("h3",{id:"enable-scim-provisioning-for-prophecy-enterprise-app-in-azuread"},"Enable SCIM Provisioning for ",(0,i.yg)("em",{parentName:"h3"},"Prophecy Enterprise App")," in AzureAD"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Go to ",(0,i.yg)("strong",{parentName:"li"},"Provisioning")," tab in ",(0,i.yg)("strong",{parentName:"li"},"Manage")," section of ",(0,i.yg)("em",{parentName:"li"},"Prophecy Enterprise App")," in Azure AD and click on ",(0,i.yg)("strong",{parentName:"li"},"Get Started"),"."),(0,i.yg)("li",{parentName:"ul"},"Choose the ",(0,i.yg)("strong",{parentName:"li"},"Provisioning Mode")," to be ",(0,i.yg)("strong",{parentName:"li"},"Automatic")," from the drop-down."),(0,i.yg)("li",{parentName:"ul"},"In ",(0,i.yg)("strong",{parentName:"li"},"Admin Credentials"),", provide the ",(0,i.yg)("strong",{parentName:"li"},"Tenant URL")," as ",(0,i.yg)("inlineCode",{parentName:"li"},"https://your-prophecy-ide-url.domain/proscim"),"."),(0,i.yg)("li",{parentName:"ul"},"For the ",(0,i.yg)("strong",{parentName:"li"},"Secret Token"),", provide the ",(0,i.yg)("strong",{parentName:"li"},"SCIM token")," copied from the Prophecy IDE."),(0,i.yg)("li",{parentName:"ul"},"Click ",(0,i.yg)("strong",{parentName:"li"},"Test Connection")," to check the connectivity with Prophecy's SCIM connector."),(0,i.yg)("li",{parentName:"ul"},"Click ",(0,i.yg)("strong",{parentName:"li"},"Save"),"."),(0,i.yg)("li",{parentName:"ul"},"User Provisioning doesn't start automatically. You need to go back to ",(0,i.yg)("strong",{parentName:"li"},"Provisioning")," section of the app and click on ",(0,i.yg)("strong",{parentName:"li"},"Start Provisioning"),".")))}u.isMDXComponent=!0},39092:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/azure_enterpriseapp_sso-3d4936d29f9ecbe90eb9228ca6bfa896.png"},63463:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/sso_settings-62ba5ad052ba828f7a54e744aca56185.png"},53539:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/sso_settings_detailed_azuread-f445eb479065ae18fa43e5920c81739a.png"},38714:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/sso_settings_with_token-f630a2a7a200a1985f487657cf3c0af1.png"}}]);