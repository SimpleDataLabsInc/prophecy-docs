<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ci-cd/prophecy-build-tool/prophecy-build-tool-jenkins" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">PBT on Jenkins | Prophecy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.prophecy.io/ci-cd/prophecy-build-tool/prophecy-build-tool-jenkins"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="PBT on Jenkins | Prophecy"><meta data-rh="true" name="description" content="Example Usage of Prophecy Build Tool on Jenkins"><meta data-rh="true" property="og:description" content="Example Usage of Prophecy Build Tool on Jenkins"><link data-rh="true" rel="icon" href="/img/favicon2.png"><link data-rh="true" rel="canonical" href="https://docs.prophecy.io/ci-cd/prophecy-build-tool/prophecy-build-tool-jenkins"><link data-rh="true" rel="alternate" href="https://docs.prophecy.io/ci-cd/prophecy-build-tool/prophecy-build-tool-jenkins" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.prophecy.io/ci-cd/prophecy-build-tool/prophecy-build-tool-jenkins" hreflang="x-default"><link rel="search" type="application/opensearchdescription+xml" title="Prophecy" href="/opensearch.xml">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/assets/css/styles.16451571.css">
<script src="/assets/js/runtime~main.1f4a7428.js" defer="defer"></script>
<script src="/assets/js/main.29d909ef.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Prophecy Logo.png" alt="Prophecy Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/Prophecy Logo White.png" alt="Prophecy Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/administration">Administration</a><a href="https://transpiler.docs.prophecy.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Transpiler</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/getting-help">Help</a><a href="mailto:docs@prophecy.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Feedback</a><a href="http://app.prophecy.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Login</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div id="inkeep-shadowradix-:R1spa5:" style="display:contents"></div><span></span></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Prophecy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/getting-started/">Getting started</a><button aria-label="Expand sidebar category &#x27;Getting started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-copilot">Data Copilot</a><button aria-label="Expand sidebar category &#x27;Data Copilot&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/release_notes/">Release notes</a><button aria-label="Expand sidebar category &#x27;Release notes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-divider"></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item sidebar-title">Analysts <span class="badge">Preview</span></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/analysts/pipeline-development">Pipeline development</a><button aria-label="Expand sidebar category &#x27;Pipeline development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/analysts/versioning">Versioning</a><button aria-label="Expand sidebar category &#x27;Versioning&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/analysts/scheduling">Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/analysts/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/analysts/extensibility">Extensibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/analysts/business-applications">Apps</a><button aria-label="Expand sidebar category &#x27;Apps&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-divider"></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item sidebar-title">Engineers</li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Spark/">Pipeline development</a><button aria-label="Expand sidebar category &#x27;Pipeline development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-modeling/">Model development</a><button aria-label="Expand sidebar category &#x27;Model development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/lineage/">Lineage</a><button aria-label="Expand sidebar category &#x27;Lineage&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/ci-cd/reliable-ci-cd">CI/CD</a><button aria-label="Collapse sidebar category &#x27;CI/CD&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/ci-cd/git/">Git</a><button aria-label="Expand sidebar category &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ci-cd/tests">Unit tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ci-cd/data-diff">Data diff</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/ci-cd/deployment/">Release and Deploy</a><button aria-label="Expand sidebar category &#x27;Release and Deploy&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/ci-cd/prophecy-build-tool/">Prophecy Build Tool (PBT)</a><button aria-label="Collapse sidebar category &#x27;Prophecy Build Tool (PBT)&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ci-cd/prophecy-build-tool/prophecy-build-tool-github-actions">PBT on GitHub Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ci-cd/prophecy-build-tool/prophecy-build-tool-jenkins">PBT on Jenkins</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Orchestration/">Orchestration</a><button aria-label="Expand sidebar category &#x27;Orchestration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/extensibility/">Extensibility</a><button aria-label="Expand sidebar category &#x27;Extensibility&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/ci-cd/reliable-ci-cd"><span itemprop="name">CI/CD</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/ci-cd/prophecy-build-tool/"><span itemprop="name">Prophecy Build Tool (PBT)</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">PBT on Jenkins</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>PBT on Jenkins</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-github-repo"><a href="https://github.com/prophecy-samples/external-cicd-template" target="_blank" rel="noopener noreferrer">Example GitHub Repo</a><a href="#example-github-repo" class="hash-link" aria-label="Direct link to example-github-repo" title="Direct link to example-github-repo">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="context-of-the-jenkins-cicd-example">Context of the Jenkins CI/CD Example<a href="#context-of-the-jenkins-cicd-example" class="hash-link" aria-label="Direct link to Context of the Jenkins CI/CD Example" title="Direct link to Context of the Jenkins CI/CD Example">​</a></h2>
<p>In this section we will explore how to set up separate &quot;testing&quot; and &quot;deploying&quot; Jenkins jobs using declarative pipelines. These jobs will be triggered when items are merged into the following protected branches
<code>prod</code>, <code>qa</code>, <code>develop</code>. Each of these three branches represents a different Databricks Workspace environment. We
want to be able to test and deploy our pipelines into each of these three workspaces during our release workflow.</p>
<p>The release process on GitHub is defined as merging and testing to branches in the following
order: <code>feature-branch</code> &gt; <code>develop</code> &gt; <code>qa</code> &gt; <code>prod</code></p>
<p><img decoding="async" loading="lazy" alt="branch_protection_checks_example.png" src="/assets/images/branch_protection_checks_example-7e8c4c644e13a1ba1063b02c12bc69bf.png" width="1042" height="252" class="img_ev3q">
<em>When PRs are made to a protected branch, the unit tests must pass before the PR can be merged</em></p>
<p>Once the PR is merged successfully, we deploy the artifacts and job definitions to Databricks.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The Git project for this example will soon be made publicly available. To keep as much
of the CICD logic attached to the Git project itself, we will store the Jenkinsfiles
directly in the repo and only store the Jenkins Triggers and Credentials in the Jenkins
server.</p><p>This example is currently designed for Pyspark pipelines. To use the same recipe
for Scala pipelines, just make sure <code>JDK 11</code> is installed on your Jenkins nodes.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="preparation">Preparation<a href="#preparation" class="hash-link" aria-label="Direct link to Preparation" title="Direct link to Preparation">​</a></h2>
<p>You should have access to:</p>
<ul>
<li>a Git repo with an existing Prophecy project</li>
<li>a Jenkins Server where you can create new pipelines and credentials</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jenkins-plugins">Jenkins plugins<a href="#jenkins-plugins" class="hash-link" aria-label="Direct link to Jenkins plugins" title="Direct link to Jenkins plugins">​</a></h3>
<p>The following plugins were used for this example:</p>
<ul>
<li><a href="https://plugins.jenkins.io/ghprb/" target="_blank" rel="noopener noreferrer">GitHub Pull Request Builder</a>
<ul>
<li>for the build/test job</li>
</ul>
</li>
<li><a href="https://plugins.jenkins.io/github/" target="_blank" rel="noopener noreferrer">GitHub</a>
<ul>
<li>for the deploy job</li>
</ul>
</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>These plugins may have published vulnerabilities for older versions of Jenkins.
Please make sure to check with your Jenkins server admin or
security admin before installing any plugins.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jenkins-secrets">Jenkins Secrets<a href="#jenkins-secrets" class="hash-link" aria-label="Direct link to Jenkins Secrets" title="Direct link to Jenkins Secrets">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>You may require more or less secrets depending on the number of workspaces you
are deploying to.</p></div></div>
<ul>
<li>DEMO_DATABRICKS_HOST<!-- -->
<ul>
<li>the hostname for our Databricks workspace that houses our <code>qa</code> and <code>dev</code> environments.</li>
</ul>
</li>
<li>DEMO_DATBRICKS_TOKEN<!-- -->
<ul>
<li>the token for DATABRICKS_HOST</li>
</ul>
</li>
<li>PROD_DATABRICKS_HOST<!-- -->
<ul>
<li>the hostname for our Databricks workspace that houses our <code>prod</code> environment.</li>
</ul>
</li>
<li>PROD_DATBRICKS_TOKEN<!-- -->
<ul>
<li>the token for PROD_DATABRICKS_HOST</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fabric_id">FABRIC_ID<a href="#fabric_id" class="hash-link" aria-label="Direct link to FABRIC_ID" title="Direct link to FABRIC_ID">​</a></h3>
<p>Find the Fabric IDs for your fabrics by navigating to the Metadata page of that Fabric and observing the URL.</p>
<p><code>Metadata</code> &gt; <code>Fabrics</code> &gt; <code>&lt;your Fabric&gt;</code></p>
<p><img decoding="async" loading="lazy" alt="finding_fabric_id.png" src="/assets/images/finding_fabric_id-87410893ebcaca3eacb01a38c64cb5b8.png" width="668" height="532" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-pipeline">Testing pipeline<a href="#testing-pipeline" class="hash-link" aria-label="Direct link to Testing pipeline" title="Direct link to Testing pipeline">​</a></h2>
<p>This pipeline uses PBT to validate the pipelines and run all Prophecy unit tests.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-pipeline---pipeline-creation">Testing pipeline - Pipeline Creation<a href="#testing-pipeline---pipeline-creation" class="hash-link" aria-label="Direct link to Testing pipeline - Pipeline Creation" title="Direct link to Testing pipeline - Pipeline Creation">​</a></h3>
<ul>
<li>Create a Jenkins pipeline
<img decoding="async" loading="lazy" alt="jenkins-pipeline-type.png" src="/assets/images/jenkins-pipeline-type-4d7aeee7bb2244684372f0837a48065e.png" width="2330" height="344" class="img_ev3q"></li>
<li>Configure the GitHub project URL</li>
<li>Choose GitHub Pull Request Builder as the trigger type.</li>
<li>Provide credentials to GitHub<!-- -->
<ul>
<li>creating a fine-grained Personal Acces Token (PAT) in GitHub. The PAT should be
scoped to yourself or your Organization, have access to the repository containing the Prophecy project, and
appropriate permissions:
<img decoding="async" loading="lazy" alt="github-pat-permissions.png" src="/assets/images/github-pat-permissions-1159de9b446912b916366bc151617d44.png" width="1716" height="554" class="img_ev3q"></li>
</ul>
</li>
<li>Choose pipeline Script from SCM</li>
<li>Provide the path to our Jenkinsfile within the repo</li>
</ul>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Refer to this image for all settings. </summary><div><div class="collapsibleContent_i85q"><p><img decoding="async" loading="lazy" alt="hello-cicd-declarative-test_configure.png" src="/assets/images/hello-cicd-declarative-test_configure-43413747f1aeb0f70cf6e1cf48bd5423.png" width="1044" height="2932" class="img_ev3q"></p></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-pipeline---trigger">Testing pipeline - Trigger<a href="#testing-pipeline---trigger" class="hash-link" aria-label="Direct link to Testing pipeline - Trigger" title="Direct link to Testing pipeline - Trigger">​</a></h3>
<p>We use the <a href="https://plugins.jenkins.io/ghprb/" target="_blank" rel="noopener noreferrer">GitHub Pull Request Builder</a> to trigger any time there is a new pull request or a change
on a pull request (comment or new commit) to our special branches: <code>develop</code>, <code>qa</code>, <code>prod</code>.</p>
<p>By providing GitHub credentials to the GHPRB plugin it will be able to automatically
create webhooks in GitHub.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Refer to this image for all settings. </summary><div><div class="collapsibleContent_i85q"><p><img decoding="async" loading="lazy" alt="hello-cicd-declarative-test_configure-trigger.png" src="/assets/images/hello-cicd-declarative-test_configure-trigger-b06bc1a9f59b1e5464626785ebb61bd3.png" width="1116" height="3591" class="img_ev3q"></p></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-pipeline---pipeline-code">Testing pipeline - Pipeline Code<a href="#testing-pipeline---pipeline-code" class="hash-link" aria-label="Direct link to Testing pipeline - Pipeline Code" title="Direct link to Testing pipeline - Pipeline Code">​</a></h3>
<p>Create a Groovy Jenkinsfile in the project repository at the below location (relative to root)</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.jenkins/deploy-declarative.groovy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use the following code as a template, replacing the URLs as necessary:</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PROJECT_PATH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#e3116c">&quot;./hello_project&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        VENV_NAME </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#e3116c">&quot;.venv&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;checkout&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                git branch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${ghprbSourceBranch}&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> credentialsId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;jenkins-cicd-runner-demo&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;git@github.com:prophecy-samples/external-cicd-template.git&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh </span><span class="token interpolation-string string" style="color:#e3116c">&quot;apt-get install -y python3-venv&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;install pbt&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh </span><span class="token interpolation-string string" style="color:#e3116c">&quot;&quot;&quot;#!/bin/bash -xe</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                python3 --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                if [[ ! -d &quot;</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">VENV_NAME</span><span class="token interpolation-string string" style="color:#e3116c">&quot; ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                    python3 -m venv </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">VENV_NAME</span><span class="token interpolation-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                source ./</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">VENV_NAME</span><span class="token interpolation-string string" style="color:#e3116c">/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                python3 -m pip install -U pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                python3 -m pip install -U build pytest wheel pytest-html pyspark prophecy-build-tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;validate&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh </span><span class="token interpolation-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                . ./</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">VENV_NAME</span><span class="token interpolation-string string" style="color:#e3116c">/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                python3 -m pbt validate --path </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">PROJECT_PATH</span><span class="token interpolation-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;test&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh </span><span class="token interpolation-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                . ./</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">VENV_NAME</span><span class="token interpolation-string string" style="color:#e3116c">/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                python3 -m pbt test --path </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">PROJECT_PATH</span><span class="token interpolation-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-pipeline---explanation-of-stages">Testing pipeline - Explanation of Stages<a href="#testing-pipeline---explanation-of-stages" class="hash-link" aria-label="Direct link to Testing pipeline - Explanation of Stages" title="Direct link to Testing pipeline - Explanation of Stages">​</a></h3>
<p>The pipeline performs the following actions in order:</p>
<ol>
<li>(&#x27;checkout&#x27;) SCM checkout of the Prophecy project from Git<!-- -->
<ul>
<li>Since we are using the GHRPB plugin to trigger this pipeline, it will checkout the code
the source branch that triggered the PR with the special provided environment variable
<code>${ghprbSourceBranch}</code>.</li>
</ul>
</li>
<li>(&#x27;install pbt&#x27;) Install PBT and its dependencies to our Jenkins worker node</li>
<li>(&#x27;valiadate&#x27;) Use PBT to validate the pipelines do not have any syntactical errors.</li>
<li>(&#x27;test&#x27;) Use PBT to run unit tests defined in the Prophecy pipelines</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Each invocation of <code>sh</code> in the Jenkins pipeline runs in its own shell context. For this reason we
source the venv containing the <code>pbt</code> tool at the beginning of each <code>sh</code> command.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-pipeline">Deploy pipeline<a href="#deploy-pipeline" class="hash-link" aria-label="Direct link to Deploy pipeline" title="Direct link to Deploy pipeline">​</a></h2>
<p>This pipeline uses PBT to deploy the Prophecy pipelines to their appropriate fabrics.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-pipeline---pipeline-creation">Deploy pipeline - Pipeline Creation<a href="#deploy-pipeline---pipeline-creation" class="hash-link" aria-label="Direct link to Deploy pipeline - Pipeline Creation" title="Direct link to Deploy pipeline - Pipeline Creation">​</a></h3>
<ul>
<li>Create a Jenkins Pipeline
<img decoding="async" loading="lazy" alt="jenkins-pipeline-type.png" src="/assets/images/jenkins-pipeline-type-4d7aeee7bb2244684372f0837a48065e.png" width="2330" height="344" class="img_ev3q"></li>
<li>Choose &quot;GitHub hook for GITScm polling&quot; as the trigger.</li>
<li>Choose &quot;Pipeline from SCM&quot; with our GitHub repo as the repository</li>
<li>Choose the branches to trigger on (<code>develop</code>, <code>qa</code>, <code>prod</code>)</li>
<li>Point the &quot;Script path&quot; <a href="#deploy-pipeline---pipeline-code">to our Jenkinsfile</a> containing the deploy logic</li>
</ul>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Refer to this image for all settings. </summary><div><div class="collapsibleContent_i85q"><p><img decoding="async" loading="lazy" alt="hello-cicd-declarative-deploy_configure.png" src="/assets/images/hello-cicd-declarative-deploy_configure-2359b5c143b60c247f5696e5b012c097.png" width="1031" height="2748" class="img_ev3q"></p></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-pipeline---trigger">Deploy Pipeline - Trigger<a href="#deploy-pipeline---trigger" class="hash-link" aria-label="Direct link to Deploy Pipeline - Trigger" title="Direct link to Deploy Pipeline - Trigger">​</a></h3>
<p>Set up a simple webhook trigger for this job inside of GitHub.</p>
<ul>
<li>Navigate to <code>Settings &gt; Webhooks &gt; Add Webhook</code></li>
<li>Create a new webhook like this:
<img decoding="async" loading="lazy" alt="github-push-webhook-config.png" src="/assets/images/github-push-webhook-config-9a4804406cd4f55fa64138d3a7a53104.png" width="2398" height="1644" class="img_ev3q"></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-pipeline---pipeline-code">Deploy Pipeline - Pipeline Code<a href="#deploy-pipeline---pipeline-code" class="hash-link" aria-label="Direct link to Deploy Pipeline - Pipeline Code" title="Direct link to Deploy Pipeline - Pipeline Code">​</a></h3>
<p>Create a Groovy Jenkinsfile in the project repository at the below location (relative to root)</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.jenkins/test-declarative.groovy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use the following code as a template, replacing the fabric IDs and URLs as necessary:</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> DEFAULT_FABRIC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#e3116c">&quot;1174&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> fabricPerBranch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        prod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#e3116c">&quot;4004&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qa</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#e3116c">&quot;4005&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        develop</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DEFAULT_FABRIC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipeline </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DATABRICKS_HOST </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">credentials</span><span class="token punctuation" style="color:#393A34">(</span><span class="token interpolation-string string" style="color:#e3116c">&quot;${env.GIT_BRANCH == &quot;</span><span class="token plain">prod</span><span class="token interpolation-string string" style="color:#e3116c">&quot; ? &quot;</span><span class="token plain">DEMO_PROD_DATABRICKS_HOST</span><span class="token interpolation-string string" style="color:#e3116c">&quot; : &quot;</span><span class="token plain">DEMO_DATABRICKS_HOST</span><span class="token interpolation-string string" style="color:#e3116c">&quot;}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DATABRICKS_TOKEN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">credentials</span><span class="token punctuation" style="color:#393A34">(</span><span class="token interpolation-string string" style="color:#e3116c">&quot;${env.GIT_BRANCH == &quot;</span><span class="token plain">prod</span><span class="token interpolation-string string" style="color:#e3116c">&quot; ? &quot;</span><span class="token plain">DEMO_PROD_DATABRICKS_TOKEN</span><span class="token interpolation-string string" style="color:#e3116c">&quot; : &quot;</span><span class="token plain">DEMO_DATABRICKS_TOKEN</span><span class="token interpolation-string string" style="color:#e3116c">&quot;}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PROJECT_PATH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#e3116c">&quot;./hello_project&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        VENV_NAME </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#e3116c">&quot;.venv&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FABRIC_ID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fabricPerBranch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getOrDefault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token interpolation-string string" style="color:#e3116c">&quot;</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token interpolation-string interpolation expression">env</span><span class="token interpolation-string interpolation expression punctuation" style="color:#393A34">.</span><span class="token interpolation-string interpolation expression">GIT_BRANCH</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token interpolation-string string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DEFAULT_FABRIC</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prepare system&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh </span><span class="token interpolation-string string" style="color:#e3116c">&quot;apt-get install -y python3-venv&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;install pbt&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh </span><span class="token interpolation-string string" style="color:#e3116c">&quot;&quot;&quot;#!/bin/bash -xe</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                python3 --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                if [[ ! -d &quot;</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">VENV_NAME</span><span class="token interpolation-string string" style="color:#e3116c">&quot; ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                    python3 -m venv </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">VENV_NAME</span><span class="token interpolation-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                source ./</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">VENV_NAME</span><span class="token interpolation-string string" style="color:#e3116c">/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                python3 -m pip install -U pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                python3 -m pip install -U build pytest wheel pytest-html pyspark prophecy-build-tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">stage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;deploy&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh </span><span class="token interpolation-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                . ./</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">VENV_NAME</span><span class="token interpolation-string string" style="color:#e3116c">/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                python3 -m pbt deploy --fabric-ids </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">FABRIC_ID</span><span class="token interpolation-string string" style="color:#e3116c"> --path </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token interpolation-string interpolation expression">PROJECT_PATH</span><span class="token interpolation-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token interpolation-string string" style="color:#e3116c">                &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-pipeline---explanation-of-pipeline">Deploy Pipeline - Explanation of Pipeline<a href="#deploy-pipeline---explanation-of-pipeline" class="hash-link" aria-label="Direct link to Deploy Pipeline - Explanation of Pipeline" title="Direct link to Deploy Pipeline - Explanation of Pipeline">​</a></h3>
<ol>
<li>(&#x27;environment&#x27; block) - Choose which Prophecy fabric / Databricks Workspace to deploy jobs to.</li>
</ol>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>The DATABRICKS_HOST and DATABRICKS_TOKEN env variables must match the configuration of the fabric we are attempting to deploy.</p></div></div>
<ol start="2">
<li>(&#x27;prepare system&#x27;) - Ensure python3 is available on worker nodes. You can skip this if your Jenkins nodes already have <code>python3-venv</code> installed.</li>
<li>(&#x27;install pbt&#x27;) - Ensure PBT and its dependencies are installed</li>
<li>(&#x27;deploy&#x27;) - use PBT to deploy the Databricks jobs for our chosen fabric<!-- -->
<ul>
<li>Builds all the pipelines present in the project and generates a .jar/.whl artifact for each pipeline</li>
<li>Uploads the pipeline .jar/.whl artifacts for each of the deployed jobs (next step)</li>
<li>Creates or Updates the Databricks jobs based on <code>databricks-job.json</code> files for the Prophecy project (only those that use <code>$FABRIC_ID</code>)</li>
</ul>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/metadata">metadata</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/build">build</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/deploy">deploy</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/test">test</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/cli">cli</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/continuous-integration">continuous integration</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/continuous-deployment">continuous deployment</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/cicd">cicd</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/jenkins">jenkins</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ci-cd/prophecy-build-tool/prophecy-build-tool-github-actions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">PBT on GitHub Actions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Orchestration/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Orchestration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example-github-repo" class="table-of-contents__link toc-highlight">Example GitHub Repo</a></li><li><a href="#context-of-the-jenkins-cicd-example" class="table-of-contents__link toc-highlight">Context of the Jenkins CI/CD Example</a></li><li><a href="#preparation" class="table-of-contents__link toc-highlight">Preparation</a><ul><li><a href="#jenkins-plugins" class="table-of-contents__link toc-highlight">Jenkins plugins</a></li><li><a href="#jenkins-secrets" class="table-of-contents__link toc-highlight">Jenkins Secrets</a></li><li><a href="#fabric_id" class="table-of-contents__link toc-highlight">FABRIC_ID</a></li></ul></li><li><a href="#testing-pipeline" class="table-of-contents__link toc-highlight">Testing pipeline</a><ul><li><a href="#testing-pipeline---pipeline-creation" class="table-of-contents__link toc-highlight">Testing pipeline - Pipeline Creation</a></li><li><a href="#testing-pipeline---trigger" class="table-of-contents__link toc-highlight">Testing pipeline - Trigger</a></li><li><a href="#testing-pipeline---pipeline-code" class="table-of-contents__link toc-highlight">Testing pipeline - Pipeline Code</a></li><li><a href="#testing-pipeline---explanation-of-stages" class="table-of-contents__link toc-highlight">Testing pipeline - Explanation of Stages</a></li></ul></li><li><a href="#deploy-pipeline" class="table-of-contents__link toc-highlight">Deploy pipeline</a><ul><li><a href="#deploy-pipeline---pipeline-creation" class="table-of-contents__link toc-highlight">Deploy pipeline - Pipeline Creation</a></li><li><a href="#deploy-pipeline---trigger" class="table-of-contents__link toc-highlight">Deploy Pipeline - Trigger</a></li><li><a href="#deploy-pipeline---pipeline-code" class="table-of-contents__link toc-highlight">Deploy Pipeline - Pipeline Code</a></li><li><a href="#deploy-pipeline---explanation-of-pipeline" class="table-of-contents__link toc-highlight">Deploy Pipeline - Explanation of Pipeline</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Prophecy</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.prophecy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.prophecy.io/blogs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/prophecy-io-support/shared_invite/zt-1dwuvkakg-JcavnQuoukyZ3q5jkSkKCg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:docs@prophecy.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation feedback<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://app.prophecy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Login<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Prophecy Inc All Rights Reserved <a href="https://legal.prophecy.io/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>