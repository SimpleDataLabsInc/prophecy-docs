"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[49474],{17602:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"administration/authentication/databricks-oauth","title":"Databricks OAuth","description":"Prophecy Databricks OAuth integration","source":"@site/docs/administration/authentication/databricks-oauth.md","sourceDirName":"administration/authentication","slug":"/databricks-oauth-authentication","permalink":"/databricks-oauth-authentication","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"authentication","permalink":"/tags/authentication"},{"inline":true,"label":"databricks","permalink":"/tags/databricks"},{"inline":true,"label":"oauth","permalink":"/tags/oauth"}],"version":"current","frontMatter":{"title":"Databricks OAuth","id":"databricks-oauth","slug":"/databricks-oauth-authentication","description":"Prophecy Databricks OAuth integration","tags":["authentication","databricks","oauth"]},"sidebar":"adminSidebar","previous":{"title":"Authentication","permalink":"/administration/authentication/"},"next":{"title":"SAML and SCIM","permalink":"/administration/authentication/saml-scim"}}');var s=i(74848),r=i(28453);const a={title:"Databricks OAuth",id:"databricks-oauth",slug:"/databricks-oauth-authentication",description:"Prophecy Databricks OAuth integration",tags:["authentication","databricks","oauth"]},c=void 0,o={},d=[{value:"Requirements",id:"requirements",level:2},{value:"Register Prophecy as an app connection in Databricks",id:"app-connection",level:3},{value:"Use cases supported by Databricks",id:"use-cases-supported-by-databricks",level:2},{value:"Security",id:"security",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"Prophecy provides Databricks OAuth to align with industry-standard authentication flows. This gives you more granular access control and better security, making it a good alternative to Personal Access Tokens (PATs). This integration works with both Spark clusters and SQL warehouses."}),"\n",(0,s.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Prophecy 3.4.3.1 or later."}),"\n",(0,s.jsx)(t.li,{children:"An app connection between Databricks and Prophecy. This connection is set up by default in SaaS environments and no further action is needed."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["For Dedicated SaaS and self-hosted deployments, follow the steps below. Prior to performing this one-time registration process, ",(0,s.jsx)(t.strong,{children:"users will see the OAuth option in fabrics but will be unable to use it."})]}),"\n",(0,s.jsx)(t.h3,{id:"app-connection",children:"Register Prophecy as an app connection in Databricks"}),"\n",(0,s.jsxs)(t.p,{children:["First, a Databricks ",(0,s.jsx)(t.a,{href:"https://docs.databricks.com/en/admin/index.html#what-are-account-admins",children:"account admin"})," needs to complete the following steps ",(0,s.jsx)(t.strong,{children:"once"})," for your Prophecy deployment:"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["On Databricks, navigate to ",(0,s.jsx)(t.strong,{children:"Account Settings > App connections"})," in your account console."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://docs.databricks.com/en/integrations/enable-disable-oauth.html#enable-custom-oauth-applications-using-the-databricks-ui",children:"Create a new App connection"})," for Prophecy. Ensure that:","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Access scopes are set to ",(0,s.jsx)(t.strong,{children:"ALL APIs"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["The redirect URL contains ",(0,s.jsx)(t.code,{children:"<your_prophecy_url>/api/databricks/oauthredirect"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.li,{children:"This process generates Databricks OAuth Application fields on the Prophecy side."}),"\n",(0,s.jsxs)(t.li,{children:["Under Client ID, copy your ",(0,s.jsx)(t.strong,{children:"OAuth Client ID"})," for the application, and share it with your Prophecy Cluster Admin."]}),"\n",(0,s.jsxs)(t.li,{children:["Under Client secret, select ",(0,s.jsx)(t.strong,{children:"Generate a client secret"}),". Share it with your Prophecy Cluster Admin."]}),"\n",(0,s.jsxs)(t.li,{children:["Click ",(0,s.jsx)(t.strong,{children:"Save"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Then, the Prophecy cluster admin has to add the Databricks credentials to Prophecy:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Navigate to ",(0,s.jsx)(t.strong,{children:"Admin Settings > Security"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Under ",(0,s.jsx)(t.strong,{children:"Databricks OAuth Application (U2M)"}),", paste the ",(0,s.jsx)(t.strong,{children:"Client ID"})," and the ",(0,s.jsx)(t.strong,{children:"Client Secret"})," into the respective fields."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Security settings in Prophecy",src:i(67914).A+"",width:"2620",height:"1002"})}),"\n",(0,s.jsxs)(t.p,{children:["Finally, ",(0,s.jsx)(t.strong,{children:"the Prophecy Kubernetes cluster must be restarted"})," to enact these changes."]}),"\n",(0,s.jsx)(t.h2,{id:"use-cases-supported-by-databricks",children:"Use cases supported by Databricks"}),"\n",(0,s.jsxs)(t.p,{children:["In Prophecy, you can use Databricks OAuth in two ways, either using user identities or a ",(0,s.jsx)(t.a,{href:"https://docs.databricks.com/aws/en/admin/users-groups/service-principals",children:"service principal"}),"."]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Identity"}),(0,s.jsx)(t.th,{children:"Use Cases"}),(0,s.jsx)(t.th,{children:"Behavior"}),(0,s.jsx)(t.th,{children:"Notes"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"https://docs.databricks.com/en/dev-tools/auth/oauth-u2m.html",children:"User-based OAuth"})}),(0,s.jsx)(t.td,{children:"Individual user accounts"}),(0,s.jsx)(t.td,{children:"Pipeline development, job development"}),(0,s.jsx)(t.td,{children:"Executes actions with the user's Databricks permissions. Users sign in via the Databricks login screen."}),(0,s.jsx)(t.td,{children:"Requires periodic login based on Databricks' OAuth timeout settings. Default timeouts are used in SaaS, but are configurable in Dedicated SaaS/self-hosted deployments."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"https://docs.databricks.com/en/dev-tools/auth/oauth-m2m.html",children:"Service Principal OAuth"})}),(0,s.jsx)(t.td,{children:"Service principal"}),(0,s.jsx)(t.td,{children:"Project deployment, scheduled pipeline execution"}),(0,s.jsx)(t.td,{children:"Authenticates using service principal credentials. All scheduled jobs run as the service principal."}),(0,s.jsx)(t.td,{children:"Required for automation and CI/CD. You will see a warning if service principal credentials are missing."})]})]})]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"The minimum level of access that your service principal requires (including access to clusters, tables, etc.) will vary per use case."})}),"\n",(0,s.jsx)(t.p,{children:"To learn how to configure Databricks OAuth for different fabric types, see:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/administration/fabrics/prophecy-fabrics/connections/databricks",children:"Databricks connection in a Prophecy fabric"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/administration/fabrics/Spark-fabrics/databricks/#credentials",children:"Databricks connection in a Spark fabric"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/administration/fabrics/sql-fabrics/databricks",children:"Databricks connection in a SQL fabric"})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"security",children:"Security"}),"\n",(0,s.jsx)(t.p,{children:"Prophecy ensures robust security measures during the OAuth authentication process, following best practices documented by Databricks. For example:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"The authentication process follows a three-step OAuth flow to generate tokens, leveraging Proof Key for Code Exchange (PKCE) to enhance security. Prophecy uses a Prophecy-hosted callback URL to capture and process authorization codes, issuing and securely storing access tokens."}),"\n",(0,s.jsx)(t.li,{children:"Prophecy securely stores the refresh token, which is used to renew itself and obtain new access tokens, to ensure uninterrupted authenticated connectivity to Databricks. Tokens are encrypted before being stored in the database, following the same stringent encryption standards applied to other credentials managed by Prophecy."}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>c});var n=i(96540);const s={},r=n.createContext(s);function a(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(r.Provider,{value:t},e.children)}},67914:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/images/databricks-oauth-admin-a3b45c9c2a1bb61c199e42d7e6576ee0.png"}}]);