"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[387],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>h});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=p(a),u=o,h=c["".concat(l,".").concat(u)]||c[u]||d[u]||r;return a?n.createElement(h,i(i({ref:t},m),{},{components:a})):n.createElement(h,i({ref:t},m))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:o,i[1]=s;for(var p=2;p<r;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},85162:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(67294),o=a(86010);const r={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:a,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,o.Z)(r.tabItem,i),hidden:a},t)}},74866:(e,t,a)=>{a.d(t,{Z:()=>v});var n=a(87462),o=a(67294),r=a(86010),i=a(12466),s=a(16550),l=a(91980),p=a(67392),m=a(50012);function c(e){return function(e){return o.Children.map(e,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:o}}=e;return{value:t,label:a,attributes:n,default:o}}))}function d(e){const{values:t,children:a}=e;return(0,o.useMemo)((()=>{const e=t??c(a);return function(e){const t=(0,p.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function u(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:a}=e;const n=(0,s.k6)(),r=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,l._X)(r),(0,o.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})}),[r,n])]}function g(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,r=d(e),[i,s]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!u({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:r}))),[l,p]=h({queryString:a,groupId:n}),[c,g]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,r]=(0,m.Nk)(a);return[n,(0,o.useCallback)((e=>{a&&r.set(e)}),[a,r])]}({groupId:n}),k=(()=>{const e=l??c;return u({value:e,tabValues:r})?e:null})();(0,o.useLayoutEffect)((()=>{k&&s(k)}),[k]);return{selectedValue:i,selectValue:(0,o.useCallback)((e=>{if(!u({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);s(e),p(e),g(e)}),[p,g,r]),tabValues:r}}var k=a(72389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:t,block:a,selectedValue:s,selectValue:l,tabValues:p}=e;const m=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.o5)(),d=e=>{const t=e.currentTarget,a=m.indexOf(t),n=p[a].value;n!==s&&(c(t),l(n))},u=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=m.indexOf(e.currentTarget)+1;t=m[a]??m[0];break}case"ArrowLeft":{const a=m.indexOf(e.currentTarget)-1;t=m[a]??m[m.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":a},t)},p.map((e=>{let{value:t,label:a,attributes:i}=e;return o.createElement("li",(0,n.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>m.push(e),onKeyDown:u,onClick:d},i,{className:(0,r.Z)("tabs__item",f.tabItem,i?.className,{"tabs__item--active":s===t})}),a??t)})))}function b(e){let{lazy:t,children:a,selectedValue:n}=e;if(a=Array.isArray(a)?a:[a],t){const e=a.find((e=>e.props.value===n));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function w(e){const t=g(e);return o.createElement("div",{className:(0,r.Z)("tabs-container",f.tabList)},o.createElement(y,(0,n.Z)({},e,t)),o.createElement(b,(0,n.Z)({},e,t)))}function v(e){const t=(0,k.Z)();return o.createElement(w,(0,n.Z)({key:String(t)},e))}},87661:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>m,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>p,toc:()=>c});var n=a(87462),o=(a(67294),a(3905)),r=a(74866),i=a(85162);const s={title:"Gem Builder",id:"Gem-builder",description:"Build custom Gems to share across teams with the Package Hub",tags:[]},l=void 0,p={unversionedId:"package-hub/package-builder/Gem-builder",id:"package-hub/package-builder/Gem-builder",title:"Gem Builder",description:"Build custom Gems to share across teams with the Package Hub",source:"@site/docs/package-hub/package-builder/gem-builder.md",sourceDirName:"package-hub/package-builder",slug:"/package-hub/package-builder/Gem-builder",permalink:"/package-hub/package-builder/Gem-builder",draft:!1,tags:[],version:"current",frontMatter:{title:"Gem Builder",id:"Gem-builder",description:"Build custom Gems to share across teams with the Package Hub",tags:[]},sidebar:"defaultSidebar",previous:{title:"Shareable Datasets",permalink:"/package-hub/package-builder/shareable-datasets"},next:{title:"Architecture",permalink:"/architecture/"}},m={},c=[{value:"Quickstart",id:"quickstart",level:2},{value:"Quicksteps to create and share a custom Gem",id:"quicksteps-to-create-and-share-a-custom-gem",level:3},{value:"Add Gem",id:"add-gem",level:2},{value:"Gem modes",id:"gem-modes",level:3},{value:"Dataset Format",id:"dataset-format",level:4},{value:"Transformation",id:"transformation",level:4},{value:"Create Gem",id:"create-gem",level:3},{value:"Skeleton Code",id:"skeleton-code",level:3},{value:"Viewing errors",id:"viewing-errors",level:3},{value:"Edit Gem",id:"edit-gem",level:2},{value:"Update",id:"update",level:2},{value:"Gem structure",id:"gem-structure",level:2},{value:"Transform Gem Example",id:"transform-gem-example",level:3},{value:"Package and Import statements",id:"package-and-import-statements",level:4},{value:"Parent Class",id:"parent-class",level:4},{value:"Properties Class",id:"properties-class",level:4},{value:"Dialog",id:"dialog",level:4},{value:"Validation",id:"validation",level:4},{value:"State Changes",id:"state-changes",level:4},{value:"Serialize/Deserialize",id:"serializedeserialize",level:4},{value:"Component code",id:"component-code",level:4},{value:"Extend",id:"extend",level:2},{value:"Extend the Gem UI Component",id:"extend-the-gem-ui-component",level:3},{value:"Dialog Method: ColumnsLayout",id:"dialog-method-columnslayout",level:4},{value:"Extend the Component Code with functions",id:"extend-the-component-code-with-functions",level:3},{value:"Extend the read/write capabilities with Dataset Format Gems",id:"extend-the-readwrite-capabilities-with-dataset-format-gems",level:3},{value:"What\u2019s next?",id:"whats-next",level:3},{value:"FAQ",id:"faq",level:2}],d={toc:c},u="wrapper";function h(e){let{components:t,...s}=e;return(0,o.kt)(u,(0,n.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"While Prophecy offers dozens of Gems out-of-the-box, some data practitioners want to extend this idea and create their own Gems. Incorporate your custom code into a Prophecy Gem with Prophecy\u2019s ",(0,o.kt)("strong",{parentName:"p"},"Gem Builder.")," Then publish the Gem with the entire Project to the ",(0,o.kt)("strong",{parentName:"p"},"Package Hub")," or share with selected teams."),(0,o.kt)("h2",{id:"quickstart"},"Quickstart"),(0,o.kt)("p",null,"When you\u2019re ready to create a package, everything within the selected project will be part of the package. That includes Pipelines, subgraphs, jobs, custom Gems, etc. This document explores the most important part of the package: Custom Gems."),(0,o.kt)("h3",{id:"quicksteps-to-create-and-share-a-custom-gem"},"Quicksteps to create and share a custom Gem"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create a new Spark (Python / Scala) or SQL Project or open an existing project. While this document is focused on Python and Scala, SQL coders can also create Gems using Macros."),(0,o.kt)("li",{parentName:"ol"},"Add a new Gem.\na. Notice some skeleton (guide) code to get started.\nb. Click Preview to review the user interface (UI) for your custom Gem. Your code is autosaved and available to commit to the linked Git repository."),(0,o.kt)("li",{parentName:"ol"},"Edit the Gem: Paste/Write your code specification at the prompt. Use the ","[Gem Structure]"," to understand each code section."),(0,o.kt)("li",{parentName:"ol"},"Update the Gem:\na. When the Gem code and associated User Interface (UI) are ready, Release the Project. The new custom Gem is included in the versioned Package on Git with the rest of the elements of the Project. Now the Package can be named as a dependency in other Projects.\nb. Share the Package with specific teams or publish to the Package Hub for everyone to use.")),(0,o.kt)("p",null,"That\u2019s it! Creating a custom Gem in Prophecy is easy. Let\u2019s dig into the steps in detail below."),(0,o.kt)("h2",{id:"add-gem"},"Add Gem"),(0,o.kt)("h3",{id:"gem-modes"},"Gem modes"),(0,o.kt)("p",null,"There are two Gem modes:"),(0,o.kt)("h4",{id:"dataset-format"},"Dataset Format"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"This mode allows for the custom definition of Dataset Formats beyond the provided formats (xml, csv, avro, parquet, json, etc)."),(0,o.kt)("li",{parentName:"ol"},"When a Dataset Format Gem is created, the new format can be used when creating Datasets. Find a new card for your custom DatasetFormat Gem in the ",(0,o.kt)("strong",{parentName:"li"},"(1) Dataset Type and Format")," listing. See the image below.")),(0,o.kt)("h4",{id:"transformation"},"Transformation"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"These Gems apply transformations/joins/any other custom logic onto any DataFrame(s) that are passed into them."),(0,o.kt)("li",{parentName:"ol"},"When a new Transformation Gem is created, the user will be able to drag-and-drop the new Gem from the list in the ",(0,o.kt)("strong",{parentName:"li"},"(2) Project Browser")," or ",(0,o.kt)("strong",{parentName:"li"},"(3) Gem dropdown menu."))),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"1",src:a(1159).Z,width:"2880",height:"1084"})),(0,o.kt)("p",null,"Programmatically, a Gem is a component with the following parts:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("strong",{parentName:"li"},"Gem UI Component")," to get user information from the screen. (This code is rendered on the Prophecy UI)."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("strong",{parentName:"li"},"Gem Code Logic")," which is how the Gem acts within the context of a Pipeline.")),(0,o.kt)("h3",{id:"create-gem"},"Create Gem"),(0,o.kt)("p",null,"When you create a new project, notice there are ",(0,o.kt)("strong",{parentName:"p"},"(1) default dependencies")," included and there\u2019s a new entity inside each project called ",(0,o.kt)("strong",{parentName:"p"},"(2) \u201cGems.\u201d")," Click the + icon to create a new Gem. ",(0,o.kt)("strong",{parentName:"p"},"(3) Name")," your Gem, ",(0,o.kt)("strong",{parentName:"p"},"(4) select")," mode (either transformation or Dataset format), and select the ",(0,o.kt)("strong",{parentName:"p"},"(5) category.")," (Coming soon you\u2019ll be able to define your own category.) In this simple example, we name our Gem \u201cCustom Limit.\u201d"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"2",src:a(85647).Z,width:"2880",height:"1084"}),"\nTogether you and Prophecy will create code that will later be committed to your repository. Prophecy starts by providing skeleton code to get started."),(0,o.kt)("h3",{id:"skeleton-code"},"Skeleton Code"),(0,o.kt)("p",null,"Lets explore the skeleton code and see which aspects should always be included. There are several aspects to note in the basic skeleton:\n",(0,o.kt)("img",{alt:"3",src:a(91205).Z,width:"2880",height:"1726"}),"\nThe skeleton code includes the ",(0,o.kt)("strong",{parentName:"p"},"(1) package name")," and ",(0,o.kt)("strong",{parentName:"p"},"import statements"),", definition for the new Gem\u2019s ",(0,o.kt)("strong",{parentName:"p"},"(2) parent class")," and ",(0,o.kt)("strong",{parentName:"p"},"(3) properties class"),", methods to define the ",(0,o.kt)("strong",{parentName:"p"},"(4) Gem\u2019s User Interface"),", methods to ",(0,o.kt)("strong",{parentName:"p"},"(5) serialize and deserialize"),", and the ",(0,o.kt)("strong",{parentName:"p"},"(6) component code")," for the new Gem."),(0,o.kt)("p",null,"With this code skeleton, you\u2019ll already have a basic UI to get started. Get familiar with the basic UI:\n",(0,o.kt)("img",{alt:"4",src:a(26084).Z,width:"2880",height:"1084"}),"\nTo see the UI, click ",(0,o.kt)("strong",{parentName:"p"},"(1) Preview"),". The ",(0,o.kt)("strong",{parentName:"p"},"(2) UI")," appears basic and is ready for us to customize it. We\u2019ll do that next. ",(0,o.kt)("strong",{parentName:"p"},"(3) Preview Code")," is a handy button to view the ",(0,o.kt)("strong",{parentName:"p"},"(4) Component Code"),"."),(0,o.kt)("h3",{id:"viewing-errors"},"Viewing errors"),(0,o.kt)("p",null,"Errors are surfaced in the GemBuilder UserInterface (UI). If there\u2019s an error on any of the ","[required]"," methods, the UI will inform you this way:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"5",src:a(4964).Z,width:"2880",height:"1084"}),"\nIf there is a ",(0,o.kt)("strong",{parentName:"p"},"(1) typo / error")," in a required method, eg dialog1 instead of dialog, Prophecy will direct your attention to a particular line of code. Click the ",(0,o.kt)("strong",{parentName:"p"},"(2) underlined code"),", and notice a ",(0,o.kt)("strong",{parentName:"p"},"(3) detailed error message"),". Click ",(0,o.kt)("strong",{parentName:"p"},"(4) Preview")," to see how the Gem will look as rendered in the UI. If a value is incorrect, the Gem will not be able to be parsed, and a very clear error will appear ",(0,o.kt)("strong",{parentName:"p"},"(5) here")," as well. Click the ",(0,o.kt)("strong",{parentName:"p"},"(6) Errors")," button to see the ",(0,o.kt)("strong",{parentName:"p"},"(7) full error message"),"."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"\u201cThe Gem specification could not be parsed\u201d means that there\u2019s an error in one or more required methods, classes, or properties. These components could not be analyzed and/or converted into the Gem User Interface (UI).")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"6",src:a(49863).Z,width:"2880",height:"1084"}),"\nIf you find yourself in the ",(0,o.kt)("strong",{parentName:"p"},"(1) Preview")," screen unsure what has caused your error, click the link in the ",(0,o.kt)("strong",{parentName:"p"},"(2) error message")," to reach the ",(0,o.kt)("strong",{parentName:"p"},"(3) code view")," and find the ",(0,o.kt)("strong",{parentName:"p"},"(4) underlined problematic value"),"."),(0,o.kt)("h2",{id:"edit-gem"},"Edit Gem"),(0,o.kt)("p",null,"In our \u201cCustomGem,\u201d we don\u2019t see any UI components yet because we need to add them. Let\u2019s take inspiration from the ",(0,o.kt)("strong",{parentName:"p"},"Limit")," Gem code that\u2019s provided in the ",(0,o.kt)("strong",{parentName:"p"},"SparkBasicsScala")," package."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"7",src:a(23358).Z,width:"2880",height:"1084"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"(1) Open the SparkBasicsScala dependency"),". (If you\u2019re using a Python project, then open the SparkBasicsPython dependency). ",(0,o.kt)("strong",{parentName:"p"},"(2) Click Limit"),", an existing Gem we can use for inspiration. Explore the ",(0,o.kt)("strong",{parentName:"p"},"(3) Limit Gem code"),". We will use some or all the code for our new Custom Limit Gem. ",(0,o.kt)("strong",{parentName:"p"},"(4) Click Preview")," and ",(0,o.kt)("strong",{parentName:"p"},"(5) view the UI")," for the Limit Gem. This UI has an example ",(0,o.kt)("strong",{parentName:"p"},"(6) Input schema")," so we can see how the user would interact with the Gem\u2019s interface. The user will be able to view input/output schema and enter a ",(0,o.kt)("strong",{parentName:"p"},"(7) value")," in the Limit field."),(0,o.kt)("p",null,"The Limit Gem\u2019s code is explained in detail in the Gem Structure ","[sections]"," below. ","[Extend]"," the classes and make a change, for example change the default limit value from 10 to 50. Your new Gem is available to drag-n-drop into the Pipeline canvas as demonstrated in the short video below. Test it out in a Pipeline! Make any changes needed on the feature branch."),(0,o.kt)("div",{class:"wistia_responsive_padding",style:{padding:"56.25% 0 0 0",position:"relative"}},(0,o.kt)("div",{class:"wistia_responsive_wrapper",style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"}},(0,o.kt)("iframe",{src:"https://fast.wistia.net/embed/iframe/7jd6ns0m0b?seo=false?videoFoam=true",title:"Getting Started With SQL Video",allow:"autoplay; fullscreen",allowtransparency:"true",frameborder:"0",scrolling:"no",class:"wistia_embed",name:"wistia_embed",msallowfullscreen:!0,width:"100%",height:"100%"}))),(0,o.kt)("script",{src:"https://fast.wistia.net/assets/external/E-v1.js",async:!0}),(0,o.kt)("h2",{id:"update"},"Update"),(0,o.kt)("p",null,"Once you have tested your Gem in the canvas, and you are happy with both the ",(0,o.kt)("strong",{parentName:"p"},"Gem UI Component")," and ",(0,o.kt)("strong",{parentName:"p"},"Gem Code Logic"),", you will want to update the Gem by releasing a tagged version. Continue developing and releasing new versions as incremental improvements! When you\u2019re ready to re-use this code in other projects, share with specific teams or publish to the Package Hub. See the ",(0,o.kt)("a",{parentName:"p",href:"/package-hub/#build-a-package"},"Package Hub")," page for details."),(0,o.kt)("h2",{id:"gem-structure"},"Gem structure"),(0,o.kt)("p",null,"The best way to learn how to create new Gems is to learn by example from the existing Gems. Find below a detailed Transform Gem Example, the Limit Gem. Afterward, extend your Gem by using examples as inspiration."),(0,o.kt)("admonition",{type:"important"},(0,o.kt)("p",{parentName:"admonition"},"Every Gem must have package and import statements, parent class, properties class, required methods (dialog, validation, onChange, serialize/deserialize for Scala, apply), and component code.")),(0,o.kt)("h3",{id:"transform-gem-example"},"Transform Gem Example"),(0,o.kt)("p",null,"Here we break down the code for the Limit Gem section by section."),(0,o.kt)("h4",{id:"package-and-import-statements"},"Package and Import statements"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"For Scala, be sure to update package to reflect your Gem\u2019s Project name. In this case, my CustomLimit Gem is created in my Framework Project. So I will use the statement ",(0,o.kt)("inlineCode",{parentName:"p"},"package platform.framework.Gems"))),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"from prophecy.cb.server.base.ComponentBuilderBase import *\nfrom pyspark.sql import *\nfrom pyspark.sql.functions import *\n\nfrom prophecy.cb.server.base.datatypes import SInt\nfrom prophecy.cb.ui.uispec import *\nfrom prophecy.cb.server.base import WorkflowContext\n\n"))),(0,o.kt)(i.Z,{value:"Scala",label:"Scala",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Scala"},"\npackage platform.< project name >.Gems\nimport io.prophecy.Gems._\nimport io.prophecy.Gems.componentSpec._\nimport io.prophecy.Gems.dataTypes._\nimport io.prophecy.Gems.diagnostics._\nimport io.prophecy.Gems.uiSpec._\nimport org.apache.spark.sql.{DataFrame, SparkSession}\nimport play.api.libs.json.{Format, Json}\n\n")))),(0,o.kt)("h4",{id:"parent-class"},"Parent Class"),(0,o.kt)("p",null,"Every Gem class needs to extend a parent class from which it inherits the representation of the overall Gem. This includes the UI and the logic. For transform Gems, you need to extend ComponentSpec ."),(0,o.kt)("p",null,'Next provide the name and category of your Gem, "Limit" and "Transform" in this example.'),(0,o.kt)("p",null,"Another thing to note here is optimizeCode. This flag can be set to True or False value depending on whether we want the Prophecy Optimizer to run on this code to simplify it. In most cases, it's best to leave this value as True."),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},'class Limit(ComponentSpec):\n    name: str = "Limit"\n    category: str = "Transform"\n    GemDescription: str = "Limits the number of rows in the output"\n    docUrl: str = "https://docs.prophecy.io/low-code-spark/Gems/transform/limit/"\n\n    def optimizeCode(self) -> bool:\n        return True\n\n    @dataclass(frozen=True)\n\n'))),(0,o.kt)(i.Z,{value:"Scala",label:"Scala",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Scala"},'\nclass Limit extends ComponentSpec {\n\n  val name: String = "Limit"\n  val category: String = "Transform"\n  val GemDescription: String = "Limits the number of rows in the input data"\n  val docUrl: String = "https://docs.prophecy.io/low-code-spark/Gems/transform/limit/"\n\n  type PropertiesType = LimitProperties\n  override def optimizeCode: Boolean = true\n  ...\n')))),(0,o.kt)("p",null,"For our CustomLimit Gem, we can take the same code as the Limit Gem, just changing the class name and the val name."),(0,o.kt)("h4",{id:"properties-class"},"Properties Class"),(0,o.kt)("p",null,"There is one class (seen here as LimitProperties) that contains a list of the properties to be made available to the user for this particular Gem. Think of these as all the values a user fills out within the interface of this Gem, or any other UI state that you need to maintain (seen here as limit)."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The content of these Properties classes is persisted in JSON and stored in Git.")),(0,o.kt)("p",null,"These properties are available in validate, onChange and apply and can be set from dialog, functions."),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},'    class LimitProperties(ComponentProperties):\n        limit: SInt = SInt("10")\n\n'))),(0,o.kt)(i.Z,{value:"Scala",label:"Scala",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Scala"},'\n  case class LimitProperties(\n    @Property("Limit", "Number of rows to limit the incoming DataFrame to")\n    limit: SInt = SInt("10")\n  ) extends ComponentProperties\n\n')))),(0,o.kt)("p",null,"For our CustomLimit Gem, we can take the same case class as the Limit Gem, maybe changing the default limit value."),(0,o.kt)("p",null,"Now let\u2019s take a look at the methods for the UI Gem component."),(0,o.kt)("h4",{id:"dialog"},"Dialog"),(0,o.kt)("p",null,"The dialog function contains code specific to how the Gem UI should look to the user."),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},' def dialog(self) -> Dialog:\n        return Dialog("Limit").addElement(\n            ColumnsLayout(gap="1rem", height="100%")\n                .addColumn(PortSchemaTabs().importSchema(), "2fr")\n                .addColumn(\n                ExpressionBox("Limit")\n                    .bindPlaceholder("10")\n                    .bindProperty("limit")\n                    .withFrontEndLanguage(),\n                "5fr"\n            )\n        )\n\n\n'))),(0,o.kt)(i.Z,{value:"Scala",label:"Scala",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Scala"},' def dialog: Dialog = Dialog("Limit")\n    .addElement(\n      ColumnsLayout(gap = Some("1rem"), height = Some("100%"))\n        .addColumn(PortSchemaTabs().importSchema(), "2fr")\n        .addColumn(\n          ExpressionBox("Limit")\n            .bindProperty("limit")\n            .bindPlaceholder("10")\n            .withFrontEndLanguage,\n          "5fr"\n        )\n    )\n')))),(0,o.kt)("p",null,"The above Dialog function in the limit Gem is rendered on the UI like this:\n",(0,o.kt)("img",{alt:"UI",src:a(74774).Z,width:"1838",height:"1060"})),(0,o.kt)("p",null,"There are various UI components that can be defined for custom Gems such as scroll boxes, tabs, buttons, etc."),(0,o.kt)("p",null,"These UI components can be grouped together in various types of panels to create a custom user experience when using the Gem. After the Dialog object is defined, it's serialized as JSON, sent to the UI, and rendered there."),(0,o.kt)("p",null,"Depending on what kind of Gem is being created, either a Dialog or a DatasetDialog needs to be defined. See Transformation vs DatasetFormat Gems for details."),(0,o.kt)("p",null,"Take a look through the Gems inside SparkBasicsScala and SparkBasicsPython Projects to for more example dialog methods."),(0,o.kt)("h4",{id:"validation"},"Validation"),(0,o.kt)("p",null,"The validate method performs validation checks so that in the case where there's any issue with any inputs provided for the user an Error can be displayed. In our example case the Limit condition must be an integer within a defined range. Similarly, you can add any validation on your properties."),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},' def validate(self, context: WorkflowContext, component: Component[LimitProperties]) -> List[Diagnostic]:\n        diagnostics = []\n        limitDiagMsg = "Limit has to be an integer between [0, (2**31)-1]"\n        if component.properties.limit.diagnosticMessages is not None and len(component.properties.limit.diagnosticMessages) > 0:\n            for message in component.properties.limit.diagnosticMessages:\n                diagnostics.append(Diagnostic("properties.limit", message, SeverityLevelEnum.Error))\n        else:\n            resolved = component.properties.limit.value\n            if resolved <= 0:\n                diagnostics.append(Diagnostic("properties.limit", limitDiagMsg, SeverityLevelEnum.Error))\n            else:\n                pass\n        return diagnostics\n'))),(0,o.kt)(i.Z,{value:"Scala",label:"Scala",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Scala"},' def validate(component: Component)(implicit context: WorkflowContext): List[Diagnostic] = {\n    import Scala.collection.mutable.ListBuffer\n\n    val diagnostics = ListBuffer[Diagnostic]()\n\n    val (diag, limit) = (component.properties.limit.diagnostics, component.properties.limit.value)\n    diagnostics ++= diag\n\n    val limitDiagMsg = "Limit has to be an integer between [0, (2**31)-1]"\n    if (limit.isDefined) {\n      if (limit.get < 0)\n        diagnostics += Diagnostic("properties.limit", limitDiagMsg, SeverityLevel.Error)\n    }\n    diagnostics.toList\n  }\n\n')))),(0,o.kt)("h4",{id:"state-changes"},"State Changes"),(0,o.kt)("p",null,"The onChange method is given for the UI State transformations. You are given both the previous and the new incoming state and can merge or modify the state as needed. The properties of the Gem are also accessible to this function, so functions like selecting columns, etc. are possible to add from here."),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"    def onChange(self, context: WorkflowContext, oldState: Component[LimitProperties], newState: Component[LimitProperties]) -> Component[\n        LimitProperties]:\n        return newState\n"))),(0,o.kt)(i.Z,{value:"Scala",label:"Scala",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Scala"},"  def onChange(oldState: Component, newState: Component)(implicit context: WorkflowContext): Component = newState\n")))),(0,o.kt)("h4",{id:"serializedeserialize"},"Serialize/Deserialize"),(0,o.kt)("p",null,"Serialize and deserialize methods in Scala are now open source and exposed to the user, so you could extend your own serializer classes if desired, using Play JSON ",(0,o.kt)("a",{parentName:"p",href:"https://www.playframework.com/documentation/2.8.x/ScalaJson"},"library")," or any other format."),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"< not applicable for Python >\n"))),(0,o.kt)(i.Z,{value:"Scala",label:"Scala",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Scala"},"\n override def deserializeProperty(props: String): PropertiesType = Json.parse(props).as[PropertiesType]\n\n  override def serializeProperty(props: PropertiesType): String = Json.stringify(Json.toJson(props))\n\n")))),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"For Scala, this snippet binds the UI Properties to the case class:"),(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"(props: testProperties): String = Json.toJson(props).toString()"))),(0,o.kt)("h4",{id:"component-code"},"Component code"),(0,o.kt)("p",null,"The last class used here is LimitCode which is inherited from ComponentCode class. This class contains the actual Spark code that needs to run on your Spark cluster. The Spark code for the Gem logic is defined in the apply function. Input/Output of apply method can only be DataFrame or list of DataFrames or empty. For example, we are calling the .limit() method in this example in the apply function."),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"\n    class LimitCode(ComponentCode):\n        def __init__(self, newProps):\n            self.props: Limit.LimitProperties = newProps\n\n        def apply(self, spark: SparkSession, in0: DataFrame) -> DataFrame:\n            return in0.limit(self.props.limit.value)\n\n"))),(0,o.kt)(i.Z,{value:"Scala",label:"Scala",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Scala"},"class LimitCode(props: PropertiesType) extends ComponentCode {\n\n    def apply(spark: SparkSession, in: DataFrame): DataFrame = {\n      val out = in.limit(props.limit)\n      out\n    }\n\n  }\n")))),(0,o.kt)("p",null,"You can go ahead and preview the component in the Gem Builder now to see how it looks. Note some Gem examples have functions defined within the apply method."),(0,o.kt)("p",null,"That\u2019s all the code for our example Transformation, the Limit Gem. We walked through the package and import statements, parent class, and properties class. We explored the required methods dialog, validation, onChange, (de)serializeProperty. Finally we saw the Limit Gem\u2019s component code. Now we have a basic understanding of the components needed for any Transformation Gem."),(0,o.kt)("h2",{id:"extend"},"Extend"),(0,o.kt)("p",null,"Now for the fun part! We understand a Transform example, and now we want to explore extending to our custom Gem needs. There are several ways to extend your custom Gem."),(0,o.kt)("p",null,"Looking to craft or adjust a UI element for your custom Gem? Get inspiration from the existing Gems. Find a Gem that has a UI element you want to use - like ColumnsLayout - and use that Gem\u2019s code."),(0,o.kt)("p",null,"Looking to supply your own function for your custom Gem? Add your function in the ComponentCode\u2019s apply method."),(0,o.kt)("p",null,"Looking to read or write to a data format beyond the (filetypes, warehouses, and catalog) provided out of the box? GemBuilder is not just for Transformations. Design a new DatasetFormat with GemBuilder using some modifications from the Transformation example."),(0,o.kt)("h3",{id:"extend-the-gem-ui-component"},"Extend the Gem UI Component"),(0,o.kt)("h4",{id:"dialog-method-columnslayout"},"Dialog Method: ColumnsLayout"),(0,o.kt)("p",null,"Let\u2019s see how to use the ColumnsLayout UI element in detail:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"8",src:a(86994).Z,width:"2880",height:"1084"}),"\nOpen the ",(0,o.kt)("strong",{parentName:"p"},"(1) SparkBasics")," package dependency for Python or Scala. Explore and scroll to find a Gem, eg ",(0,o.kt)("strong",{parentName:"p"},"(2) OrderBy")," with the desired visual component, in this case ColumnsLayout. Find the ",(0,o.kt)("strong",{parentName:"p"},"(3) relevant code")," for the visual element and click ",(0,o.kt)("strong",{parentName:"p"},"(4) Preview")," to see how this visual element is rendered. Try it out! Click on the ",(0,o.kt)("strong",{parentName:"p"},"(5)customer_id and email")," columns, and note these columns now ",(0,o.kt)("strong",{parentName:"p"},"(6) appear")," in the Order Columns list."),(0,o.kt)("p",null,"If you like the column layout, then add the ColumnsLayout element to your custom Gem. Each time you edit the code, you can click \u201cPreview\u201d to test the change in the UI."),(0,o.kt)("h3",{id:"extend-the-component-code-with-functions"},"Extend the Component Code with functions"),(0,o.kt)("p",null,"The ComponentCode contains the actual Spark code that needs to run on your Spark cluster. Functions are supported inside the apply method; just define and call the function."),(0,o.kt)("p",null,"For example, the existing Filter ComponentCode can be ",(0,o.kt)("strong",{parentName:"p"},"(1) edited")," by adding the withColumn function:\n",(0,o.kt)("img",{alt:"9",src:a(11475).Z,width:"2880",height:"1084"}),"\nClicking ",(0,o.kt)("strong",{parentName:"p"},"(2) Preview")," will allow you to view the Gem\u2019s ",(0,o.kt)("strong",{parentName:"p"},"(3) UI"),". Clicking ",(0,o.kt)("strong",{parentName:"p"},"(4) Preview Code")," will allow you to view the Gem\u2019s ",(0,o.kt)("strong",{parentName:"p"},"(5) code")," together with the ",(0,o.kt)("strong",{parentName:"p"},"(3) UI"),", facilitating iteration. See the code samples below in Scala."),(0,o.kt)("p",null,"filter ComponentCode:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"  class FilterCode(props: PropertiesType)(implicit context: WorkflowContext) extends ComponentCode {\n\n    def apply(spark: SparkSession, in: DataFrame): DataFrame = {\n      val out = in.filter(props.condition.column)\n      out\n    }\n\n  }\n")),(0,o.kt)("p",null,"filter ComponentCode with the added withColumn function:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'  class FilterCode(props: PropertiesType)(implicit context: WorkflowContext) extends ComponentCode {\n\n    def apply(spark: SparkSession, in: DataFrame): DataFrame = {\n      import org.apache.spark.sql.functions._\n\n      def func(df: DataFrame): DataFrame = {\n        df.withColumn("test_col", lit(123))\n          .where("1 == 1")\n      }\n\n      val out = in.filter(props.condition.column)\n      func(out)\n    }\n\n  }\n')),(0,o.kt)("h3",{id:"extend-the-readwrite-capabilities-with-dataset-format-gems"},"Extend the read/write capabilities with Dataset Format Gems"),(0,o.kt)("p",null,"You may also wish to create a source or target Dataset format beyond the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.prophecy.io/low-code-spark/Gems/source-target/"},"provided formats"),". With GemBuilder, it\u2019s possible to create custom Dataset formats! You\u2019ll need to know how the Custom ",(0,o.kt)("a",{parentName:"p",href:"https://docs.prophecy.io/low-code-spark/Gems/source-target/"},"DatasetFormat")," Gems differ from Transformation Gems."),(0,o.kt)("p",null,"The DatasetFormat Gem:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"class extends DatasetSpec"),(0,o.kt)("li",{parentName:"ol"},"has two Dialog functions: sourceDialog and targetDialog . They both return a DatasetDialog object, whereas for any Transform Gem, the dialog function returns a Dialog object."),(0,o.kt)("li",{parentName:"ol"},"The ComponentCode class has two apply functions: sourceApply and targetApply for Source and Target modes respectively.")),(0,o.kt)("p",null,"There is no distinction between Transformation and DatasetFormat Gem onChange and validate functions. Check the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.prophecy.io/low-code-spark/Gems/source-target/"},"Gem list")," for code examples of DatasetFormat Gems."),(0,o.kt)("h3",{id:"whats-next"},"What\u2019s next?"),(0,o.kt)("p",null,"We learned the essential code for all Transform Gems using the Limit Gem as an example, and we saw a few ways to extend from the example to our custom Gem needs. Stay tuned for more ways to use Prophecy\u2019s code as building blocks to create new Gem user interfaces, and build even better packages from these custom Gems."),(0,o.kt)("h2",{id:"faq"},"FAQ"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"How does Gembuilder work for projects aside from Python and Scala?")," Package Hub supports re-usable components in SQL, for example, to create a Macro to use custom Jinja logic. A user can create a Custom Gem to be used within the same project using Macros. As of Prophecy Version 3.2, support for reusable components in SQL is in \u201cbeta\u201d release. These are the limitations:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"A SQL project cannot be marked as package. so it wont show on package hub."),(0,o.kt)("li",{parentName:"ol"},"User cannot reuse a model, Gem etc from one project to another for SQL projects.")),(0,o.kt)("p",null,"Stay tuned for a detailed documentation page on SQL Macros in Prophecy Packages."))}h.isMDXComponent=!0},1159:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/1-gm-50d4c0cfb76b7164549711accd32325d.png"},85647:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/2-gm-b9ecf5f4988844dfa29197eb7d8b4247.png"},91205:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/3-gm-a900e3dc3245c2b66ebfad18f0cd073f.png"},26084:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/4-gm-6806643a1acb97f5a975d37b6b616d7d.png"},4964:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/5-gm-eda8b6494a1b11b6abe7d1ae82b1b492.png"},49863:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/6-gm-2e489e9f6144ad106765b1ee497193f0.png"},23358:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/7-gm-3b1bf3234baba456cfebe4531465351d.png"},86994:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/8-gm-da282223983543be9e4f5e20c00d32a9.png"},11475:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/9-gm-8f4862231b0b1999e29c84f0471a6b8e.png"},74774:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/UI-c82484a974682d29d35b5e3abd975cf5.png"}}]);