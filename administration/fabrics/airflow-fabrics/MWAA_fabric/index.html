<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-administration/fabrics/airflow-fabrics/MWAA_fabric" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">MWAA | Prophecy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.prophecy.io/administration/fabrics/airflow-fabrics/MWAA_fabric"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MWAA | Prophecy"><meta data-rh="true" name="description" content="How to create a MWAA Airflow fabric"><meta data-rh="true" property="og:description" content="How to create a MWAA Airflow fabric"><link data-rh="true" rel="icon" href="/img/favicon2.png"><link data-rh="true" rel="canonical" href="https://docs.prophecy.io/administration/fabrics/airflow-fabrics/MWAA_fabric"><link data-rh="true" rel="alternate" href="https://docs.prophecy.io/administration/fabrics/airflow-fabrics/MWAA_fabric" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.prophecy.io/administration/fabrics/airflow-fabrics/MWAA_fabric" hreflang="x-default"><link rel="search" type="application/opensearchdescription+xml" title="Prophecy" href="/opensearch.xml">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/assets/css/styles.16451571.css">
<script src="/assets/js/runtime~main.1f4a7428.js" defer="defer"></script>
<script src="/assets/js/main.29d909ef.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Prophecy Logo.png" alt="Prophecy Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/Prophecy Logo White.png" alt="Prophecy Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/administration">Administration</a><a href="https://transpiler.docs.prophecy.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Transpiler</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/getting-help">Help</a><a href="mailto:docs@prophecy.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Feedback</a><a href="http://app.prophecy.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Login</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div id="inkeep-shadowradix-:R1spa5:" style="display:contents"></div><span></span></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/administration/">Administration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-divider"></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item sidebar-title">Team Admins</li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/administration/teams-users/teams-users">Teams and users</a><button aria-label="Expand sidebar category &#x27;Teams and users&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/administration/fabrics">Fabric setup</a><button aria-label="Collapse sidebar category &#x27;Fabric setup&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/administration/fabrics/prophecy-fabrics/">Prophecy fabrics</a><button aria-label="Expand sidebar category &#x27;Prophecy fabrics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/administration/fabrics/Spark-fabrics/Fabrics">Spark fabrics</a><button aria-label="Expand sidebar category &#x27;Spark fabrics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/administration/fabrics/sql-fabrics/Fabrics">SQL fabrics</a><button aria-label="Expand sidebar category &#x27;SQL fabrics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/administration/fabrics/airflow-fabrics/">Airflow fabrics</a><button aria-label="Collapse sidebar category &#x27;Airflow fabrics&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/administration/fabrics/airflow-fabrics/connections/">Airflow connections</a><button aria-label="Expand sidebar category &#x27;Airflow connections&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/administration/fabrics/airflow-fabrics/prophecy_managed_airflow_fabric">Prophecy Managed Airflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/administration/fabrics/airflow-fabrics/composer_fabric">Composer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/administration/fabrics/airflow-fabrics/MWAA_fabric">MWAA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/administration/fabrics/airflow-fabrics/open-source-airflow">Open Source</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/administration/secrets/">Secrets</a><button aria-label="Expand sidebar category &#x27;Secrets&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-divider"></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item sidebar-title">Prophecy Cluster Admins</li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/administration/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/administration/prophecy-deployment">Prophecy deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/administration/security">Security</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/administration/authentication/">Authentication</a><button aria-label="Expand sidebar category &#x27;Authentication&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/administration/saas/audit-logging">SaaS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/administration/self-hosted/">Self-hosted</a><button aria-label="Expand sidebar category &#x27;Self-hosted&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/getting-help">Getting help</a><button aria-label="Expand sidebar category &#x27;Getting help&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/administration/fabrics"><span itemprop="name">Fabric setup</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/administration/fabrics/airflow-fabrics/"><span itemprop="name">Airflow fabrics</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MWAA</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>MWAA</h1></header><p>You can use Prophecy to connect to your <a href="https://aws.amazon.com/managed-workflows-for-apache-airflow/" target="_blank" rel="noopener noreferrer">Amazon Managed Workflows for Apache Airflow (Amazon MWAA)</a> , to create, run, and monitor your Airflow DAGs.
For this, you would need to create a MWAA Airflow fabric.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-create-an-mwaa-airflow-fabric">How to create an MWAA Airflow fabric<a href="#how-to-create-an-mwaa-airflow-fabric" class="hash-link" aria-label="Direct link to How to create an MWAA Airflow fabric" title="Direct link to How to create an MWAA Airflow fabric">​</a></h2>
<p>Setting up a fabric is very straightforward. Click the <strong>(1) Create Entity</strong> button, and choose the <strong>(2) Create Fabric</strong> option. The fabric creation is composed of two steps: Basic Info and Providers setup.
On the Basic Info screen, enter a <strong>(3) Fabric Name</strong>, <strong>(4) Fabric Description</strong>, and choose the <strong>(5) Team</strong> that’s going to own the fabric.</p>
<p>Once ready, click <strong>(6) Continue</strong>.</p>
<p><img decoding="async" loading="lazy" alt="CreateFabric" src="/assets/images/Fabric_Create-d23d384a07e74abee7b04879025b6cf6.png" width="2880" height="1084" class="img_ev3q"></p>
<p>Since we’re setting up a fabric connected to MWAA Airflow, choose <strong>Airflow</strong> as the <strong>(1) Provider Type</strong> and <strong>MWAA</strong> as the <strong>(2) Provider</strong>.</p>
<p>Once you select MWAA, you will start seeing fields for credentials.
MWAA fabric offers two types of authentication.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mwaa-access-key-auth">MWAA Access key auth<a href="#mwaa-access-key-auth" class="hash-link" aria-label="Direct link to MWAA Access key auth" title="Direct link to MWAA Access key auth">​</a></h3>
<p>By default, you would see option to provide your Access key and Secret key for authentication. Check <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html" target="_blank" rel="noopener noreferrer">here</a> on how to set up and get your access and secret keys for authentication.
Provide your <strong>(1) Access Key</strong> and <strong>(2) Secret Key</strong> and then select the <strong>(3) region</strong> where your MWAA Airflow instance is running. Click on <strong>(4) Fetch environments</strong> to fetch all Airflow instances running in this region.</p>
<p><img decoding="async" loading="lazy" alt="MWAA_auth1" src="/assets/images/MWAA_Auth1-1346c0a942f7d780f6988f1ec05f7b0f.png" width="2880" height="1726" class="img_ev3q"></p>
<p>You can now select the Airflow environment for which you want to create the fabric in Prophecy. As you select the <strong>(1) Airflow Environment</strong>, the <strong>(2) Environment name</strong>, <strong>(3) Airflow URL</strong> and <strong>(4) DAG Location</strong> would be fetched for you.
These details are only shown for verification purposes and cannot be edited. Once verified, click <strong>(5) Continue</strong>.</p>
<p><img decoding="async" loading="lazy" alt="MWAA_auth_2" src="/assets/images/MWAA_Auth_2-104a90d039aac6fbf835e2da6e3901bd.png" width="2880" height="1726" class="img_ev3q"></p>
<p>This completes the fabric Creation and you can start setting up <a href="#setting-up-connections">Connections</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mwaa-iam-role-auth">MWAA IAM Role auth<a href="#mwaa-iam-role-auth" class="hash-link" aria-label="Direct link to MWAA IAM Role auth" title="Direct link to MWAA IAM Role auth">​</a></h3>
<p>If you do not wish to provide Access keys and secret keys authentication to Prophecy, you can use <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html" target="_blank" rel="noopener noreferrer">Assume Roles</a> as an alternate authentication mechanism.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Please reach out to Prophecy support team to enable assume role Auth and disable Access keys authentication in your teams.</p></div></div>
<p>To create an AssumeRole for Prophecy, we are going to use <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" target="_blank" rel="noopener noreferrer">IAM role access across Account</a>.</p>
<p>Go to the Identity and Access Management (IAM) home page in your AWS account, and go to <strong>(1)Policies</strong>. Click on <strong>(2) Create policy</strong> .</p>
<p><img decoding="async" loading="lazy" alt="aws_iam_policies" src="/assets/images/aws_iamrole_policies-0f06d2e0aa64aa178e97059846f25963.png" width="2880" height="1084" class="img_ev3q"></p>
<p>We need ListEnvironments permission for Airflow, PutObject, GetObject and DeleteObject to the S3 bucket used by your Airflow for uploading DAGs and pipeline Artifacts and CreateCLiToken, GetEnvironment on the Airflow Instance.
For simplicity, you can switch to <strong>(3) JSON</strong> and use below JSON policy and replace values for Airflow Environment and S3 bucket.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Statement&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Sid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;VisualEditor0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;airflow:ListEnvironments&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Resource&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Sid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;VisualEditor1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;s3:PutObject&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;s3:GetObject&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;airflow:CreateCliToken&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;s3:DeleteObject&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;airflow:GetEnvironment&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Resource&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;arn:aws:airflow:&lt;location&gt;:&lt;account id&gt;:environment/&lt;mwaa-environment-name&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;arn:aws:s3:::&lt;s3-bucketname&gt;/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once the permissions are selected (or provided via json), click on <strong>(4) Next</strong>.</p>
<p><img decoding="async" loading="lazy" alt="aws_policies" src="/assets/images/aws_iamrole_policies2-60b35b894385a47161bf789bcd9f773f.png" width="2880" height="1084" class="img_ev3q">
Give a **(1) Policy name. Optionally you can add a <strong>(2) description</strong> too. Once done, click on **(3) Create Policy** to save this.</p>
<p>Now go to <strong>(1) Roles</strong> from the left sidebar, and click on <strong>(2)Create Role</strong>.</p>
<p><img decoding="async" loading="lazy" alt="aws_role" src="/assets/images/aws_create_role-deb67ae5dd2485b56de960a282c45765.png" width="2880" height="1084" class="img_ev3q">
In Trusted entity type, select <strong>(3) AWS Account</strong> and select <strong>(4)Another AWS account</strong> in An AWS account section.<br>
<!-- -->Provide Prophecy&#x27;s <strong>(5) account ID</strong> as <code>133450206866</code>. And click <strong>(6) Next</strong>.</p>
<p><img decoding="async" loading="lazy" alt="aws_role_2" src="/assets/images/aws_create_role_2-b0081cdb92267b0727d1135973afc126.png" width="2880" height="1084" class="img_ev3q">
Select the Policy which you created just above and click on <strong>(1) Next</strong>.</p>
<p>Provide a <strong>(1)role name</strong> and optionally provide a <strong>(2)description</strong>.
<strong>(3)Edit</strong> the trusted Select trusted entities Json, to only provide access to <code>prophecy-mwaa</code> users created for this auth and not to all Prophecy Users as shown below.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Statement&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Principal&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;AWS&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;arn:aws:iam::133450206866:user/prophecy-mwaa&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sts:AssumeRole&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once done click on <strong>(4)create role</strong>. The role is created.</p>
<p>Now you can go to the created Role and copy the ARN of this role to be provided in Prophecy fabric.</p>
<p>Once the assume role authentication is enabled, you would see below fields for authentication in MWAA fabric.</p>
<p><img decoding="async" loading="lazy" alt="MWAA_auth_3" src="/assets/images/MWAA_Auth_3-bd533ba19d0d75c9e4c78eea2f921314.png" width="2880" height="1726" class="img_ev3q"></p>
<p>Here you can provide the AssumeRole created for Prophecy and provide the region where your Airflow instance is running. Once done, click on <strong>(3) Fetch environment</strong> to list the Airflow Instances which are accessible to provided AssumeRole.</p>
<p>You can now select the Airflow environment for which you want to create the fabric in Prophecy. As you select the <strong>(1) Airflow Environment</strong>, the <strong>(2) Environment name</strong>, <strong>(3) Airflow URL</strong> and <strong>(4) DAG Location</strong> would be fetched for you.
These details are only shown for verification purposes and cannot be edited. Once verified, click <strong>(5) Continue</strong>.</p>
<p><img decoding="async" loading="lazy" alt="MWAA_auth_2" src="/assets/images/MWAA_Auth_2-104a90d039aac6fbf835e2da6e3901bd.png" width="2880" height="1726" class="img_ev3q"></p>
<p>This completes the fabric creation and you can start setting up Connections.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-connections">Setting up Connections<a href="#setting-up-connections" class="hash-link" aria-label="Direct link to Setting up Connections" title="Direct link to Setting up Connections">​</a></h2>
<p>You need Airflow to talk to various other systems in your Data Platform to be able to do certain tasks like sending Email, triggering Spark pipelines, and SQL models.
For these, we create <a href="https://airflow.apache.org/docs/apache-airflow/stable/authoring-and-scheduling/connections.html" target="_blank" rel="noopener noreferrer">connections</a> in Airflow.</p>
<p>You can map connections already created in your MWAA, in the Connections Tab of the fabric.
Prophecy will use these connections to fetch the connection-id to generate the correct Airflow Code when you use these in your Airflow gems.</p>
<p>For adding a connection, Click on <strong>(1) Add Connection</strong> button. This Opens up the Connection form as shown.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-snowflake-connection">Setting up Snowflake connection<a href="#setting-up-snowflake-connection" class="hash-link" aria-label="Direct link to Setting up Snowflake connection" title="Direct link to Setting up Snowflake connection">​</a></h3>
<p><img decoding="async" loading="lazy" alt="snowflake" src="/assets/images/mwaa_snowflake_connection-6edda6ec6ff862683cdee3fee5dab2e3.png" width="2880" height="1084" class="img_ev3q">
To be able to schedule your Snowflake SQL models via Airflow, you need to have a Snowflake Connection over DBT from Airflow to your Snowflake Airflow. You need to create the connection in Airflow and provide the mapping to Prophecy in this form.</p>
<p>Select <strong>(2) Connection Type</strong> as Snowflake(DBT), and select the <strong>(3) Fabric</strong> you have in Prophecy for your desired Snowflake environment. Provide the <strong>(4) Profile Directory</strong> and <strong>(5) Profile Name</strong> used while setting up the connection in Airflow.</p>
<p>Make sure you select the fabric for the same Snowflake environment you have already created the connection for in your Airflow.
Once done, hit <strong>(4) Save</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-airflow-job">Create an Airflow Job<a href="#create-an-airflow-job" class="hash-link" aria-label="Direct link to Create an Airflow Job" title="Direct link to Create an Airflow Job">​</a></h2>
<p>Once the MWAA Airflow fabric is setup with the relevant connections, Airflow job scheduling is done with an easy-to-use interface. Follow this guide to <a href="/Orchestration/airflow/airflow-tutorial-spark">Create an Airflow job</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/scheduling">scheduling</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/airflow">airflow</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/jobs">jobs</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/mwaa">MWAA</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/fabric">fabric</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/administration/fabrics/airflow-fabrics/composer_fabric"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Composer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/administration/fabrics/airflow-fabrics/open-source-airflow"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Open Source</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-create-an-mwaa-airflow-fabric" class="table-of-contents__link toc-highlight">How to create an MWAA Airflow fabric</a><ul><li><a href="#mwaa-access-key-auth" class="table-of-contents__link toc-highlight">MWAA Access key auth</a></li><li><a href="#mwaa-iam-role-auth" class="table-of-contents__link toc-highlight">MWAA IAM Role auth</a></li></ul></li><li><a href="#setting-up-connections" class="table-of-contents__link toc-highlight">Setting up Connections</a><ul><li><a href="#setting-up-snowflake-connection" class="table-of-contents__link toc-highlight">Setting up Snowflake connection</a></li></ul></li><li><a href="#create-an-airflow-job" class="table-of-contents__link toc-highlight">Create an Airflow Job</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Prophecy</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.prophecy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.prophecy.io/blogs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/prophecy-io-support/shared_invite/zt-1dwuvkakg-JcavnQuoukyZ3q5jkSkKCg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:docs@prophecy.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation feedback<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://app.prophecy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Login<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Prophecy Inc All Rights Reserved <a href="https://legal.prophecy.io/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>