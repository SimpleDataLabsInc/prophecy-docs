"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[49474],{15680:(e,t,a)=>{a.d(t,{xA:()=>u,yg:()=>y});var n=a(96540);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(a),h=i,y=p["".concat(c,".").concat(h)]||p[h]||d[h]||r;return a?n.createElement(y,o(o({ref:t},u),{},{components:a})):n.createElement(y,o({ref:t},u))}));function y(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},20896:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var n=a(58168),i=(a(96540),a(15680));const r={title:"Databricks OAuth",id:"databricks_oauth",description:"Prophecy Databricks OAuth integration",sidebar_position:6,tags:["authentication","databricks","oauth"]},o=void 0,s={unversionedId:"administration/authentication/databricks_oauth",id:"administration/authentication/databricks_oauth",title:"Databricks OAuth",description:"Prophecy Databricks OAuth integration",source:"@site/docs/administration/authentication/databricks-oauth.md",sourceDirName:"administration/authentication",slug:"/administration/authentication/databricks_oauth",permalink:"/administration/authentication/databricks_oauth",draft:!1,tags:[{label:"authentication",permalink:"/tags/authentication"},{label:"databricks",permalink:"/tags/databricks"},{label:"oauth",permalink:"/tags/oauth"}],version:"current",sidebarPosition:6,frontMatter:{title:"Databricks OAuth",id:"databricks_oauth",description:"Prophecy Databricks OAuth integration",sidebar_position:6,tags:["authentication","databricks","oauth"]},sidebar:"adminSidebar",previous:{title:"SAML and SCIM",permalink:"/administration/authentication/saml-scim"},next:{title:"Syncing audit logs from SaaS",permalink:"/administration/saas/audit-logging"}},c={},l=[{value:"Use cases supported by Databricks",id:"use-cases-supported-by-databricks",level:2},{value:"Register Prophecy as an App Connection in Databricks",id:"register-prophecy-as-an-app-connection-in-databricks",level:3},{value:"Configure new Fabrics using OAuth",id:"configure-new-fabrics-using-oauth",level:2},{value:"Pipeline development and Job configuration",id:"pipeline-development-and-job-configuration",level:2},{value:"Automated Jobs",id:"automated-jobs",level:2},{value:"Project release and deployment",id:"project-release-and-deployment",level:2},{value:"Security",id:"security",level:2}],u={toc:l},p="wrapper";function d(e){let{components:t,...r}=e;return(0,i.yg)(p,(0,n.A)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("p",null,"Prophecy provides Databricks OAuth to align with industry-standard authentication flows. This gives you more granular access control, making it a good alternative to Personal Access Tokens (PATs)."),(0,i.yg)("h2",{id:"use-cases-supported-by-databricks"},"Use cases supported by Databricks"),(0,i.yg)("p",null,"In Prophecy, you can use Databricks OAuth in two ways:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://docs.databricks.com/en/dev-tools/auth/oauth-u2m.html"},"User-to-Machine (U2M)"),". This method is used for ",(0,i.yg)("strong",{parentName:"li"},"Pipeline development")," and ",(0,i.yg)("strong",{parentName:"li"},"Job configuration"),". Any user can authenticate individually via Databricks. In this case, users access data based on their individual identity and the permissions already defined within the Databricks Unity Catalog. No additional credentials are required for this flow."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"https://docs.databricks.com/en/dev-tools/auth/oauth-m2m.html"},"Machine-to-Machine (M2M)"),". This method is used for ",(0,i.yg)("strong",{parentName:"li"},"Automation")," and ",(0,i.yg)("strong",{parentName:"li"},"Project deployment"),". Authentication is performed using a Service Principal in Databricks, which enables unattended operations (such as automated deployment). The permissions for this flow are determined by the Service Principal\u2019s configuration within the Databricks Unity Catalog.")),(0,i.yg)("p",null,"This integration works with both Spark clusters and SQL warehouses."),(0,i.yg)("details",null,(0,i.yg)("summary",null,"Required if you are on a Dedicated SaaS or self-hosted deployment"),(0,i.yg)("h3",{id:"register-prophecy-as-an-app-connection-in-databricks"},"Register Prophecy as an App Connection in Databricks"),(0,i.yg)("p",null,"First, a Databricks ",(0,i.yg)("a",{parentName:"p",href:"https://docs.databricks.com/en/admin/index.html#what-are-account-admins"},"account admin")," needs to complete the following steps ",(0,i.yg)("strong",{parentName:"p"},"once")," for your Prophecy deployment:"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"On Databricks, navigate to ",(0,i.yg)("strong",{parentName:"li"},"Account Settings > App connections")," in your account console."),(0,i.yg)("li",{parentName:"ol"},"Create a new App connection for Prophecy. This process generates Databricks OAuth Application fields on the Prophecy side."),(0,i.yg)("li",{parentName:"ol"},"Under Client ID, copy your ",(0,i.yg)("strong",{parentName:"li"},"OAuth Client ID")," for the application, and share it with your Prophecy Cluster Admin."),(0,i.yg)("li",{parentName:"ol"},"Under Client secret, select ",(0,i.yg)("strong",{parentName:"li"},"Generate a client secret"),". Share it with your Prophecy Cluster Admin."),(0,i.yg)("li",{parentName:"ol"},"Click ",(0,i.yg)("strong",{parentName:"li"},"Save"),".")),(0,i.yg)("p",null,"Then, the Prophecy Cluster Admin has to add the Databricks credentials to Prophecy:"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"Navigate to ",(0,i.yg)("strong",{parentName:"li"},"Admin Settings > Security"),"."),(0,i.yg)("li",{parentName:"ol"},"Under ",(0,i.yg)("strong",{parentName:"li"},"Databrick OAuth Application (U2M)"),", paste the ",(0,i.yg)("strong",{parentName:"li"},"Client ID")," and the ",(0,i.yg)("strong",{parentName:"li"},"Client Secret")," into the respective fields."))),(0,i.yg)("h2",{id:"configure-new-fabrics-using-oauth"},"Configure new Fabrics using OAuth"),(0,i.yg)("p",null,"To configure new Spark and SQL Fabrics within Prophecy using OAuth:"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"When creating a new Databricks Fabric, select ",(0,i.yg)("strong",{parentName:"li"},"OAuth")," under ",(0,i.yg)("strong",{parentName:"li"},"Credentials"),"."),(0,i.yg)("li",{parentName:"ol"},"Enter the ",(0,i.yg)("strong",{parentName:"li"},"Service Principal Client ID")," and ",(0,i.yg)("strong",{parentName:"li"},"Service Principal Client Secret")," into the respective fields to take advantage of M2M authentication.")),(0,i.yg)("p",null,"Visit the Databricks documentation to learn more about creating a ",(0,i.yg)("a",{parentName:"p",href:"https://docs.databricks.com/en/dev-tools/auth/oauth-m2m.html"},"Service Principal"),"."),(0,i.yg)("h2",{id:"pipeline-development-and-job-configuration"},"Pipeline development and Job configuration"),(0,i.yg)("p",null,"As mentioned previously, members of your team developing Pipelines and Jobs can leverage their own personal identity via OAuth to gain access to all Databricks resources from within Prophecy. That means that whatever permissions they have within Databricks (including permissions governed by Unity Catalog) will be enforced in Prophecy as well."),(0,i.yg)("p",null,"When you need to connect to Databricks, you will see a login window appear in Prophecy. This includes when you:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Select a Fabric in the Pipeline IDE"),(0,i.yg)("li",{parentName:"ul"},"Select a Fabric in the Jobs IDE"),(0,i.yg)("li",{parentName:"ul"},"Access the settings page in the Jobs IDE")),(0,i.yg)("img",{src:a(30167).A,alt:"Select a Fabric",width:"70%"}),(0,i.yg)("p",null,"When you click ",(0,i.yg)("strong",{parentName:"p"},"Continue"),", a separate browser tab opens, and you can log in to Databricks."),(0,i.yg)("admonition",{type:"note"},(0,i.yg)("p",{parentName:"admonition"},"You only need to perform this authentication periodically, depending on the OAuth timeout settings within Databricks. SaaS deployments automatically use the default time period. If you have a Dedicated SaaS or self-hosted deployment, your Databricks Account Administrator can adjust the timeout setting.")),(0,i.yg)("h2",{id:"automated-jobs"},"Automated Jobs"),(0,i.yg)("p",null,"When you run a job manually, you have the option to run the job as a user or Service Principal. In contrast, ",(0,i.yg)("strong",{parentName:"p"},"scheduled jobs will always run as the Service Principal")," specified in the Fabric, regardless of the job settings."),(0,i.yg)("p",null,(0,i.yg)("img",{alt:"Job configuration",src:a(7624).A,width:"2620",height:"1712"})),(0,i.yg)("p",null,"In the Airflow and Databricks Job IDE, a warning will display if the Fabric does not contain Service Principal OAuth Credentials."),(0,i.yg)("h2",{id:"project-release-and-deployment"},"Project release and deployment"),(0,i.yg)("p",null,"Your Prophecy Team Admin is the only member of your team able to perform deployment of the Pipelines and jobs created by the team. Prophecy uses a Databricks Service Principal via Databricks OAuth to perform this task on behalf of the Team Admin. The Team Admin is the only user who can use this Service Principal and only for the purpose of deploying team projects."),(0,i.yg)("h2",{id:"security"},"Security"),(0,i.yg)("p",null,"Prophecy ensures robust security measures during the OAuth authentication process."),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Authentication flow.")," The authentication process follows a three-step OAuth flow to generate tokens, leveraging Proof Key for Code Exchange (PKCE) to enhance security. Prophecy uses a Prophecy-hosted callback URL to capture and process authorization codes, issuing and securely storing access tokens."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Token storage.")," Prophecy securely stores the refresh token, which is used to renew itself and obtain new access tokens, ensuring uninterrupted authenticated connectivity to Databricks. Tokens are encrypted before being stored in the database, following the same stringent encryption standards applied to other credentials managed by Prophecy.")))}d.isMDXComponent=!0},30167:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/data-bricks-oauth-select-fab-5423b71c804d03ee38501cb23ac78e89.png"},7624:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/data-bricks-oauth-job-configuration-1ba1b109f258d0508458e44af5a68b36.png"}}]);