<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Orchestration/airflow/airflow-tutorial-spark" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Build an Airflow job | Prophecy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.prophecy.io/Orchestration/airflow/airflow-tutorial-spark"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Build an Airflow job | Prophecy"><meta data-rh="true" name="description" content="A tutorial on orchestrating Spark and SQL jobs with Airflow"><meta data-rh="true" property="og:description" content="A tutorial on orchestrating Spark and SQL jobs with Airflow"><link data-rh="true" rel="icon" href="/img/favicon2.png"><link data-rh="true" rel="canonical" href="https://docs.prophecy.io/Orchestration/airflow/airflow-tutorial-spark"><link data-rh="true" rel="alternate" href="https://docs.prophecy.io/Orchestration/airflow/airflow-tutorial-spark" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.prophecy.io/Orchestration/airflow/airflow-tutorial-spark" hreflang="x-default"><link rel="search" type="application/opensearchdescription+xml" title="Prophecy" href="/opensearch.xml">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/assets/css/styles.16451571.css">
<script src="/assets/js/runtime~main.1f4a7428.js" defer="defer"></script>
<script src="/assets/js/main.29d909ef.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Prophecy Logo.png" alt="Prophecy Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/Prophecy Logo White.png" alt="Prophecy Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/administration">Administration</a><a href="https://transpiler.docs.prophecy.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Transpiler</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/getting-help">Help</a><a href="mailto:docs@prophecy.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Feedback</a><a href="http://app.prophecy.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Login</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div id="inkeep-shadowradix-:R1spa5:" style="display:contents"></div><span></span></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Prophecy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/getting-started/">Getting started</a><button aria-label="Expand sidebar category &#x27;Getting started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-copilot">Data Copilot</a><button aria-label="Expand sidebar category &#x27;Data Copilot&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/release_notes/">Release notes</a><button aria-label="Expand sidebar category &#x27;Release notes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-divider"></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item sidebar-title">Analysts <span class="badge">Preview</span></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/analysts/pipeline-development">Pipeline development</a><button aria-label="Expand sidebar category &#x27;Pipeline development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/analysts/versioning">Versioning</a><button aria-label="Expand sidebar category &#x27;Versioning&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/analysts/scheduling">Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/analysts/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/analysts/extensibility">Extensibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/analysts/business-applications">Apps</a><button aria-label="Expand sidebar category &#x27;Apps&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-divider"></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_M9Kj menu__list-item sidebar-title">Engineers</li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Spark/">Pipeline development</a><button aria-label="Expand sidebar category &#x27;Pipeline development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-modeling/">Model development</a><button aria-label="Expand sidebar category &#x27;Model development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/lineage/">Lineage</a><button aria-label="Expand sidebar category &#x27;Lineage&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/ci-cd/reliable-ci-cd">CI/CD</a><button aria-label="Expand sidebar category &#x27;CI/CD&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/Orchestration/">Orchestration</a><button aria-label="Collapse sidebar category &#x27;Orchestration&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/Orchestration/pipeline-monitoring/">Pipeline monitoring</a><button aria-label="Expand sidebar category &#x27;Pipeline monitoring&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/Orchestration/airflow/">Airflow</a><button aria-label="Collapse sidebar category &#x27;Airflow&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Orchestration/airflow/airflow-tutorial-spark">Build an Airflow job</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Orchestration/databricks-jobs">Databricks Jobs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Orchestration/multi-jobs-trigger">Multi Jobs Trigger</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/extensibility/">Extensibility</a><button aria-label="Expand sidebar category &#x27;Extensibility&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/Orchestration/"><span itemprop="name">Orchestration</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/Orchestration/airflow/"><span itemprop="name">Airflow</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Build an Airflow job</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Build an Airflow job</h1></header><p>Let&#x27;s build a job with Airflow (or an <a href="https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/dags.html" target="_blank" rel="noopener noreferrer">Airflow DAG</a>) to schedule and run your Spark and SQL pipelines. In this tutorial, you will:</p>
<ul>
<li>Create a Prophecy-managed Airflow fabric and connections to AWS, Email, and Databricks.</li>
<li>Configure an Airflow job to run when a new file is uploaded to an S3 bucket.</li>
<li>Configure the same job to send an email notification prior to pipeline execution.</li>
<li>Run, debug, and enable the job.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h2>
<p>This tutorial requires:</p>
<ul>
<li>A Databricks account</li>
<li>A Prophecy project with a Spark pipeline</li>
<li>An AWS account with an S3 bucket</li>
<li>An email account and access to SMTP settings</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-airflow-fabric">Create Airflow fabric<a href="#create-airflow-fabric" class="hash-link" aria-label="Direct link to Create Airflow fabric" title="Direct link to Create Airflow fabric">​</a></h2>
<p>To run an Airflow job, you need to define an environment where you will run the job. Therefore, you need to create an Airflow fabric.</p>
<ol>
<li>Click the <strong>Create Entity</strong> button.</li>
<li>Choose <strong>Create Fabric</strong> option.</li>
<li>On the Basic Info page:<!-- -->
<ul>
<li>Enter a <strong>Fabric Name</strong>.</li>
<li>Enter a <strong>Fabric Description</strong>.</li>
<li>Choose the <strong>Team</strong> that will own the fabric.</li>
</ul>
</li>
<li>Click <strong>Continue</strong>.</li>
<li>Configure the Provider information.<!-- -->
<ul>
<li>Choose <strong>Prophecy Managed</strong>.</li>
</ul>
</li>
<li>Click <strong>Continue</strong>.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-an-aws-connection">Add an AWS connection<a href="#add-an-aws-connection" class="hash-link" aria-label="Direct link to Add an AWS connection" title="Direct link to Add an AWS connection">​</a></h3>
<p>In order to trigger your Airflow job using an S3 File Sensor, you need to add an AQS connection in your Airflow fabric. In the Connections tab of the fabric setup:</p>
<ol>
<li>Click on the <strong>+ Add Connection</strong> button.</li>
<li>Select AWS in <strong>Connection Type</strong>.</li>
<li>Provide a <strong>Connection Name</strong> to identify your connection.</li>
<li>Add a <strong>Description</strong> of your choice.</li>
<li>Provide the <strong>AWS Access Key ID</strong> and <strong>AWS Secret Access Key</strong>. Visit the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html" target="_blank" rel="noopener noreferrer">AWS site</a> to learn how to access these keys.</li>
<li>Click <strong>Save</strong> to establish the connection.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Add_AWS_connection" src="/assets/images/3.4_AWS_Connection-4c3d3bfbc9c76e839dcbb6d4e1ef3584.png" width="2880" height="1726" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-an-email-connection">Add an email connection<a href="#add-an-email-connection" class="hash-link" aria-label="Direct link to Add an email connection" title="Direct link to Add an email connection">​</a></h3>
<p>Next, we&#x27;ll add an email connection that will be used to send emails on your behalf.</p>
<ol>
<li>Click on the <strong>+ Add Connection</strong> button.</li>
<li>Select Email in <strong>Connection Type</strong>.</li>
<li>Provide a <strong>Connection Name</strong> to identify your connection.</li>
<li>Add a <strong>Description</strong> of your choice.</li>
<li>Provide the <strong>(4) Host</strong> as your SMTP host example <code>smtp.gmail.com</code>.</li>
<li>Provide the login credentials for this server in <strong>(5)Login</strong> and <strong>(6)Password</strong>.</li>
<li>Add your SMTP port in the <strong>Port</strong> field.</li>
<li>Click <strong>Save</strong> to establish the connection.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Add_Email_connection.png" src="/assets/images/3.5_Email_connection-6f392517477fe16388989d4f089be6ed.png" width="2880" height="1726" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-databricks-spark-connection">Add a Databricks Spark connection<a href="#add-a-databricks-spark-connection" class="hash-link" aria-label="Direct link to Add a Databricks Spark connection" title="Direct link to Add a Databricks Spark connection">​</a></h3>
<p>To run your Databricks pipelines, you need to make a connection to your Databricks environment.</p>
<ol>
<li>Click on the <strong>+ Add Connection</strong> button.</li>
<li>Select Databricks (Spark) in <strong>Connection Type</strong>.</li>
<li>Under <strong>Fabric</strong>, select a Databricks Spark fabric. This must be created beforehand.</li>
<li>Optionally, provide a description in the <strong>Description</strong> box.</li>
<li>Click <strong>Save</strong> to establish the connection.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Add_DB_Spark_connection.png" src="/assets/images/3.6_DB_Spark_connection-51d1e9b4ff69f1e17085ec10d3654309.png" width="2880" height="1726" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-airflow-job">Create an Airflow job<a href="#create-an-airflow-job" class="hash-link" aria-label="Direct link to Create an Airflow job" title="Direct link to Create an Airflow job">​</a></h2>
<p>A job contains gems that perform various tasks (running pipelines/models/scripts, etc.) that you can schedule to run at a certain frequency. Every job represents an Airflow DAG. Let&#x27;s create a job.</p>
<ol>
<li>Click the <strong>Create Entity</strong> button.</li>
<li>Choose <strong>Job</strong> option.</li>
<li>Select the <strong>project</strong> in which you want to create the job. This project should contain at least one Spark pipeline.</li>
<li>Pick your development <strong>branch</strong>. Here you can pick an existing branch for development, or create a new one.</li>
<li>Provide a <strong>Name</strong>.</li>
<li>Pick <strong>Airflow</strong> as the scheduler.</li>
<li>Select the <strong>fabric</strong> that you just created.</li>
<li>Fill in a <strong>Schedule</strong> that defines the job frequency. You can modify this at any time.</li>
<li>Add a <strong>Description</strong> about the job you are creating.</li>
<li>Click <strong>Create New</strong>.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Create_Job" src="/assets/images/3.9_Create_Job-9fb3cbc0e3246cb19970d24284235919.png" width="2880" height="1084" class="img_ev3q"></p>
<p>This will take you to the <strong>job editor</strong> where you can start building the job.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-s3-file-sensor-gem">Add a S3 file Sensor gem<a href="#add-a-s3-file-sensor-gem" class="hash-link" aria-label="Direct link to Add a S3 file Sensor gem" title="Direct link to Add a S3 file Sensor gem">​</a></h3>
<p>In the job editor canvas:</p>
<ol>
<li>Click on <strong>Sensors</strong>.</li>
<li>Drag the <strong>S3FileSensor</strong> gem from the dropdown to the canvas.</li>
<li>Click and open the newly added gem to view the gem configurations.
<img decoding="async" loading="lazy" alt="Add_S3_gem" src="/assets/images/3.10_Add_s3_gem-2a946a09ee73912bc8abaa7b6f0a5160.png" width="2880" height="1084" class="img_ev3q"></li>
<li>Specify the S3 bucket/path that we will track to trigger the job.</li>
<li>In <strong>S3 Path(s)</strong>, specify the complete path of file in your bucket. Airflow will check if this file exists in the specified bucket periodically and trigger the job when it arrives.</li>
<li>Select the created Connection for AWS in <strong>Connection name</strong>.</li>
<li>Click <strong>Save</strong>.
<img decoding="async" loading="lazy" alt="Add_S3_gem_details" src="/assets/images/3.11_Add_s3_gem_details-54d44ee280c2cf7fceae32152dbedd46.png" width="2880" height="1726" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-an-email-gem">Add an email gem<a href="#add-an-email-gem" class="hash-link" aria-label="Direct link to Add an email gem" title="Direct link to Add an email gem">​</a></h3>
<ol>
<li>Click on <strong>Trigger/Notify</strong>.</li>
<li>Drag the <strong>Email</strong> gem from the dropdown to the canvas.</li>
<li>Connect the sensor gem output to the email gem input.</li>
<li>Click and open the newly added gem to view the gem configurations.
<img decoding="async" loading="lazy" alt="Add_email_gem" src="/assets/images/3.12_Add_email_gem-f2bba81229a0f484fdc25e31628bd56c.png" width="2880" height="1084" class="img_ev3q"></li>
<li>In <strong>To</strong>, add your Email id where you want to receive the notification Email when the job is triggered.</li>
<li>Select the <strong>Connection name</strong>, you created for Email.</li>
<li>You can provide a <strong>Subject</strong> for the Email</li>
<li>Add <strong>Email content</strong> that will populate the body of the email. For example, you can add an Airflow parameter available to access the execution time in a job.</li>
<li>Optionally, add CC and BCC email addresses.</li>
<li>Click <strong>Save</strong>.
<img decoding="async" loading="lazy" alt="Add_email_gem_details" src="/assets/images/3.13_Add_email_gem_details-da3c19e263c58acfb80a805ecd66952f.png" width="2880" height="1726" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-spark-pipeline-gem">Add a Spark pipeline gem<a href="#add-a-spark-pipeline-gem" class="hash-link" aria-label="Direct link to Add a Spark pipeline gem" title="Direct link to Add a Spark pipeline gem">​</a></h3>
<ol>
<li>Click on <strong>Spark/SQL</strong>.</li>
<li>Drag the <strong>DatabricksPipeline</strong> gem from the dropdown to the canvas.</li>
<li>Connect the email gem output to the pipeline gem input.</li>
<li>Click and open the newly added gem to view the gem configurations.
<img decoding="async" loading="lazy" alt="Add_Pipeline_Gem" src="/assets/images/3.14_Add_pipeline_gem-45d2e7e3d46a095c899b6af03a1d4814.png" width="2880" height="1084" class="img_ev3q"></li>
<li>Select the <strong>Pipeline to schedule</strong> you want to run.</li>
<li>Select the configuration to use during the scheduled pipeline run.</li>
<li>Pick <strong>Fabric and Cluster size to run this pipeline</strong> for running this pipeline in Databricks.</li>
<li>Click <strong>Save</strong>.
<img decoding="async" loading="lazy" alt="Add_pipeline_gem_details" src="/assets/images/3.15_Add_pipeline_gem_details-eeb2d4df18f9331c0a63cfdc96143c49.png" width="2880" height="1726" class="img_ev3q"></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-and-debug">Run and debug<a href="#run-and-debug" class="hash-link" aria-label="Direct link to Run and debug" title="Direct link to Run and debug">​</a></h2>
<p>Now that your job is ready, you can go ahead and run it.</p>
<ol>
<li>Click on the <strong>Run</strong> button to trigger an on-demand run. This creates a temporary DAG and uploads to Airflow.</li>
<li>When you click on run, you will see a Job Details Toaster.
<img decoding="async" loading="lazy" alt="Run_job" src="/assets/images/3.18_Run_Job-c74a733a23a3662c9b2c4b204e5d6e77.png" width="1440" height="542" class="img_ev3q"></li>
<li>Click on <strong>Details</strong> to open the detailed logs of the run.</li>
<li>Review all the steps involved in the run and also detailed logs for each step.</li>
<li>Click on <strong>+</strong> button to open the logs for a particular step.
<img decoding="async" loading="lazy" alt="Run_job_logs" src="/assets/images/3.19_Run_Job_logs-0323f46acaadbf4f38db46f45a8de52f.png" width="2880" height="1726" class="img_ev3q"></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="release-and-deploy">Release and deploy<a href="#release-and-deploy" class="hash-link" aria-label="Direct link to Release and deploy" title="Direct link to Release and deploy">​</a></h2>
<p>Once you have developed and tested the job, it’s time to commit and push the code to the project Git repository and release the job to Airflow.</p>
<p><img decoding="async" loading="lazy" alt="Open Git workflow" src="/assets/images/3.20_start_commit-7a8c082c2fa41a0cafdafe163f6165fc.png" width="2880" height="1726" class="img_ev3q"></p>
<ol>
<li>Start by toggling our job to be <strong>Enabled</strong>. Once you release the project, Airflow will recognize that this job is enabled.</li>
<li>Open the Git workflow by clicking the <strong>Release</strong> button in the project header or clicking the <strong>Commit button</strong> in the project footer.</li>
<li><strong>Commit</strong> your changes. This saves the current state of your project to your branch.</li>
<li><strong>Pull</strong> any upstream or remote changes. This ensures that your branch is up-to-date with collaborators&#x27; changes.</li>
<li><strong>Merge</strong> your changes into the main project branch. The main branch should contain the &quot;official&quot; version of your project. Use a <strong>Pull Request</strong> to merge your changes if the main branch is protected.</li>
<li><strong>Release</strong> your changes. When you release your project, you create a new <strong>version</strong> of it. At this point, your job will be built and deployed on Airflow.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Release_screen" src="/assets/images/3.24_release_screen-b32cb4fe551f57d51245adbc73e8a84d.png" width="2880" height="1726" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="monitor">Monitor<a href="#monitor" class="hash-link" aria-label="Direct link to Monitor" title="Direct link to Monitor">​</a></h2>
<p>During the release process, Prophecy automatically packages, tests, and deploys your jobs to Airflow. Once the process is finished, you can see the deployed and running job within your Airflow environment.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What’s next<a href="#whats-next" class="hash-link" aria-label="Direct link to What’s next" title="Direct link to What’s next">​</a></h2>
<p>Great work! You&#x27;ve created an Airflow job in Prophecy, ran it successfully, released, scheduled, and monitored the job.</p>
<p>If you ever encounter any difficulties, don&#x27;t hesitate to reach out to us (<a href="mailto:contact.us@Prophecy.io" target="_blank" rel="noopener noreferrer">contact.us@Prophecy.io</a>) or join our <a href="https://prophecy-io-support.slack.com/join/shared_invite/zt-moq3xzoj-~5MSJ6WPnZfz7bwsqWi8tQ#/shared-invite/email" target="_blank" rel="noopener noreferrer">Slack community</a> for assistance. We&#x27;re here to help!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/airflow">airflow</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/tutorial">tutorial</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Orchestration/airflow/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Airflow</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Orchestration/databricks-jobs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Databricks Jobs</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#create-airflow-fabric" class="table-of-contents__link toc-highlight">Create Airflow fabric</a><ul><li><a href="#add-an-aws-connection" class="table-of-contents__link toc-highlight">Add an AWS connection</a></li><li><a href="#add-an-email-connection" class="table-of-contents__link toc-highlight">Add an email connection</a></li><li><a href="#add-a-databricks-spark-connection" class="table-of-contents__link toc-highlight">Add a Databricks Spark connection</a></li></ul></li><li><a href="#create-an-airflow-job" class="table-of-contents__link toc-highlight">Create an Airflow job</a><ul><li><a href="#add-a-s3-file-sensor-gem" class="table-of-contents__link toc-highlight">Add a S3 file Sensor gem</a></li><li><a href="#add-an-email-gem" class="table-of-contents__link toc-highlight">Add an email gem</a></li><li><a href="#add-a-spark-pipeline-gem" class="table-of-contents__link toc-highlight">Add a Spark pipeline gem</a></li></ul></li><li><a href="#run-and-debug" class="table-of-contents__link toc-highlight">Run and debug</a></li><li><a href="#release-and-deploy" class="table-of-contents__link toc-highlight">Release and deploy</a></li><li><a href="#monitor" class="table-of-contents__link toc-highlight">Monitor</a></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What’s next</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Prophecy</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.prophecy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.prophecy.io/blogs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/prophecy-io-support/shared_invite/zt-1dwuvkakg-JcavnQuoukyZ3q5jkSkKCg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:docs@prophecy.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation feedback<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://app.prophecy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Login<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Prophecy Inc All Rights Reserved <a href="https://legal.prophecy.io/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>