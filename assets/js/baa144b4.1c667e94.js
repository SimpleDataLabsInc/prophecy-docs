"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[8898],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>g});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},l=Object.keys(e);for(a=0;a<l.length;a++)r=l[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)r=l[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=a.createContext({}),p=function(e){var t=a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,l=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(r),d=n,g=c["".concat(s,".").concat(d)]||c[d]||m[d]||l;return r?a.createElement(g,i(i({ref:t},u),{},{components:r})):a.createElement(g,i({ref:t},u))}));function g(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=r.length,i=new Array(l);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:n,i[1]=o;for(var p=2;p<l;p++)i[p]=r[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},56269:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var a=r(87462),n=(r(67294),r(3905));const l={title:"Private SAAS",id:"private SAAS",description:"Private SAAS deployments. Bring Your Own Hardware",sidebar_position:2,tags:["deployment","private SAAS","cdp","hdp","mapr"]},i=void 0,o={unversionedId:"architecture/deployment/private-saas/private SAAS",id:"architecture/deployment/private-saas/private SAAS",title:"Private SAAS",description:"Private SAAS deployments. Bring Your Own Hardware",source:"@site/docs/architecture/deployment/private-saas/private-saas.md",sourceDirName:"architecture/deployment/private-saas",slug:"/architecture/deployment/private-saas/",permalink:"/architecture/deployment/private-saas/",draft:!1,tags:[{label:"deployment",permalink:"/tags/deployment"},{label:"private SAAS",permalink:"/tags/private-saas"},{label:"cdp",permalink:"/tags/cdp"},{label:"hdp",permalink:"/tags/hdp"},{label:"mapr",permalink:"/tags/mapr"}],version:"current",sidebarPosition:2,frontMatter:{title:"Private SAAS",id:"private SAAS",description:"Private SAAS deployments. Bring Your Own Hardware",sidebar_position:2,tags:["deployment","private SAAS","cdp","hdp","mapr"]},sidebar:"defaultSidebar",previous:{title:"Installation Guide",permalink:"/architecture/deployment/installation-guide"},next:{title:"Audit Events Configuration",permalink:"/architecture/deployment/private-saas/audit-events"}},s={},p=[{value:"Requirements",id:"requirements",level:2},{value:"Cluster",id:"cluster",level:3},{value:"Storage",id:"storage",level:3},{value:"Role",id:"role",level:3},{value:"Networking",id:"networking",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Spark",id:"spark",level:3},{value:"Airflow",id:"airflow",level:3},{value:"Logging / Metrics",id:"logging--metrics",level:3},{value:"Scaling",id:"scaling",level:2}],u={toc:p},c="wrapper";function m(e){let{components:t,...l}=e;return(0,n.kt)(c,(0,a.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Prophecy can be deployed private SAAS for customers who require maximum security or want to run on their own private SAAS\nSpark versions (e.g. CDP, HDP, MapR). As for the cloud deployments, also for private SAAS, Prophecy is deployed on a\nKubernetes cluster. With that setup, Prophecy seamlessly integrates with the rest of your infrastructure."),(0,n.kt)("p",null,"Prophecy is installed through a Prophecy Kubernetes operator, which automatically takes care of the common ops tasks,\nlike maintenance of the service, health checks, updates, version rollback etc."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Customer VPC deployment",src:r(26309).Z,width:"1560",height:"774"})),(0,n.kt)("h2",{id:"requirements"},"Requirements"),(0,n.kt)("p",null,"To install Prophecy private SAAS the following infrastructure requirements must be satisfied:"),(0,n.kt)("h3",{id:"cluster"},"Cluster"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Kubernetes Version (minimum):")," 1.21"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Images:")," Accessible from a secure container registry available at ",(0,n.kt)("inlineCode",{parentName:"li"},"gcr.io"),". This location can be configured to a customer's internal container registry.")),(0,n.kt)("p",null,"Minimum service requirements:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Namespace"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"),(0,n.kt)("th",{parentName:"tr",align:null},"# Cores"),(0,n.kt)("th",{parentName:"tr",align:null},"# RAM"),(0,n.kt)("th",{parentName:"tr",align:null},"# Block Storage"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Control Plane"),(0,n.kt)("td",{parentName:"tr",align:null},"Main services (front-end, code editor, metadata, lineage, etc)"),(0,n.kt)("td",{parentName:"tr",align:null},"34 Cores"),(0,n.kt)("td",{parentName:"tr",align:null},"68GB"),(0,n.kt)("td",{parentName:"tr",align:null},"150GB")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Data Plane"),(0,n.kt)("td",{parentName:"tr",align:null},"Services serving as a bridge between Spark and Prophecy UI"),(0,n.kt)("td",{parentName:"tr",align:null},"6 Cores"),(0,n.kt)("td",{parentName:"tr",align:null},"10GB"),(0,n.kt)("td",{parentName:"tr",align:null},"10GB")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Platform"),(0,n.kt)("td",{parentName:"tr",align:null},"Backup(Twice-a-day, configurable) , Monitoring, logging services (optional)"),(0,n.kt)("td",{parentName:"tr",align:null},"4 Cores"),(0,n.kt)("td",{parentName:"tr",align:null},"8GB"),(0,n.kt)("td",{parentName:"tr",align:null},"200GB")))),(0,n.kt)("p",null,"*","Platform Services can also run on File-based storage"),(0,n.kt)("h3",{id:"storage"},"Storage"),(0,n.kt)("p",null,"Prophecy requires:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Block storage")," needs to be available in the Kubernetes cluster"),(0,n.kt)("li",{parentName:"ul"},"Kubernetes cluster configured in either ",(0,n.kt)("strong",{parentName:"li"},"multi-AZ")," or ",(0,n.kt)("strong",{parentName:"li"},"single-AZ")," mode. For multi-AZ mode, the block storage has\nto have the volume binding mode set to ",(0,n.kt)("inlineCode",{parentName:"li"},"waitforfirstconsumer")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Dynamic provisioning")," of block and file storage"),(0,n.kt)("li",{parentName:"ul"},"Prophecy supports any storage class out of the box.")),(0,n.kt)("h3",{id:"role"},"Role"),(0,n.kt)("p",null,"Prophecy requires:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"ClusterRole")," permissions are optional for CRD installation"),(0,n.kt)("li",{parentName:"ul"},"If not available, the customer can create the required CRDs by deploying a single helm chart (shared on request)")),(0,n.kt)("h3",{id:"networking"},"Networking"),(0,n.kt)("p",null,"Prophecy requires:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Ingress")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Prophecy supports a Prophecy-managed or customer-managed nginx ingress controller. Either Kubernetes ",(0,n.kt)("inlineCode",{parentName:"li"},"nginx")," or official\n",(0,n.kt)("inlineCode",{parentName:"li"},"nginx")," controllers of any version are supported. We recommend the latest stable version."),(0,n.kt)("li",{parentName:"ul"},"Non-",(0,n.kt)("inlineCode",{parentName:"li"},"nginx")," controller configuration is possible, however, not recommended."),(0,n.kt)("li",{parentName:"ul"},"Prophecy supports Istio-based ingress gateways as well."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Certificates")," - Wildcard certificates for path-based routing. Certificates are to be managed by the ",(0,n.kt)("inlineCode",{parentName:"p"},"cert-manager"),",\nwhich can be Prophecy or customer-managed. Certificates are automatically generated for every ingress resource\ncreated.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"External-DNS")," - To successfully resolve the service host names. Prophecy supports a Prophecy-managed or\ncustomer-managed ",(0,n.kt)("inlineCode",{parentName:"p"},"external-dns")," or equivalent."))),(0,n.kt)("h3",{id:"authentication"},"Authentication"),(0,n.kt)("p",null,"Prophecy supports all of the most popular ",(0,n.kt)("strong",{parentName:"p"},"authentication providers")," as per the ",(0,n.kt)("a",{parentName:"p",href:"/architecture/authentication/"},"Authentication")," documentation."),(0,n.kt)("h3",{id:"spark"},"Spark"),(0,n.kt)("p",null,"For interactive development, Prophecy requires:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Databricks API 1.2")," - for Databricks-based Spark deployments or"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Livy 0.7.x")," - for any other Spark-deployment support (e.g. CDP, HDP, MapR, Spark on Kubernetes)")),(0,n.kt)("p",null,"For jobs deployment, Prophecy requires"),(0,n.kt)("h3",{id:"airflow"},"Airflow"),(0,n.kt)("p",null,"For interactive and jobs deployment to Airflow, Prophecy requires a customer-managed ",(0,n.kt)("strong",{parentName:"p"},"Airflow deployment version 2.x.x")," (latest recommended). ",(0,n.kt)("strong",{parentName:"p"},"Astronomer"),"'s managed Airflow offering is supported."),(0,n.kt)("h3",{id:"logging--metrics"},"Logging / Metrics"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Prophecy comes with a built-in ",(0,n.kt)("strong",{parentName:"li"},"lightweight infrastructure for monitoring")," (based on Loki & Grafana)\nand ",(0,n.kt)("strong",{parentName:"li"},"logging")," (based on Prometheus, Grafana and alert-manager, etc.)."),(0,n.kt)("li",{parentName:"ul"},"A Customer can optionally connect to it to ",(0,n.kt)("strong",{parentName:"li"},"redirect the logs and metrics")," to their own logging services.")),(0,n.kt)("h2",{id:"scaling"},"Scaling"),(0,n.kt)("p",null,"The requirements outlined ",(0,n.kt)("a",{parentName:"p",href:"#cluster"},"above")," can support up to 25 concurrent developers (users actively developing\npipelines at the same time). To enable more concurrent users, Prophecy supports vertical and horizontal scaling."),(0,n.kt)("p",null,"Scaling is taken care of by the ",(0,n.kt)("strong",{parentName:"p"},"Autoscaler")," component in our platform. Therefore, e.g., if the number of\nusers increases by 10 times, the Prophecy deployment can be scaled appropriately."),(0,n.kt)("p",null,"The following are estimated recommended cluster sizes depending on the number of concurrent users:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Number of users"),(0,n.kt)("th",{parentName:"tr",align:null},"25"),(0,n.kt)("th",{parentName:"tr",align:null},"50"),(0,n.kt)("th",{parentName:"tr",align:null},"150"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"CPUs"),(0,n.kt)("td",{parentName:"tr",align:null},"44 vCPUs"),(0,n.kt)("td",{parentName:"tr",align:null},"80 vCPUs"),(0,n.kt)("td",{parentName:"tr",align:null},"230 vCPUs")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Memory"),(0,n.kt)("td",{parentName:"tr",align:null},"86 GB"),(0,n.kt)("td",{parentName:"tr",align:null},"160 GB"),(0,n.kt)("td",{parentName:"tr",align:null},"460 GB")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Disk space (with backups)"),(0,n.kt)("td",{parentName:"tr",align:null},"360 GB"),(0,n.kt)("td",{parentName:"tr",align:null},"720 GB"),(0,n.kt)("td",{parentName:"tr",align:null},"1440 GB")))),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Please, note that the recommended resource may vary based on the intensity of the usage of each developer. The numbers\npresented above are based on the average recorded usage of Prophecy customers.")))}m.isMDXComponent=!0},26309:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/arch_customervpc-9606898420e67c54bfda2880228e6f3a.png"}}]);