"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[83895],{28453:(e,s,d)=>{d.d(s,{R:()=>r,x:()=>i});var n=d(96540);const t={},l=n.createContext(t);function r(e){const s=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(l.Provider,{value:s},e.children)}},65486:(e,s,d)=>{d.r(s),d.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>x,frontMatter:()=>i,metadata:()=>n,toc:()=>h});const n=JSON.parse('{"id":"analysts/development/gems/prepare/deduplicate","title":"Deduplicate gem","description":"Remove duplicates from your data","source":"@site/docs/analysts/development/gems/prepare/deduplicate.md","sourceDirName":"analysts/development/gems/prepare","slug":"/analysts/deduplicate","permalink":"/analysts/deduplicate","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"gems","permalink":"/tags/gems"},{"inline":true,"label":"analyst","permalink":"/tags/analyst"},{"inline":true,"label":"prepare","permalink":"/tags/prepare"}],"version":"current","frontMatter":{"title":"Deduplicate gem","sidebar_label":"Deduplicate","id":"deduplicate","slug":"/analysts/deduplicate","description":"Remove duplicates from your data","tags":["gems","analyst","prepare"]},"sidebar":"platformSidebar","previous":{"title":"DataMasking","permalink":"/analysts/data-masking"},"next":{"title":"Filter","permalink":"/analysts/filter"}}');var t=d(74848),l=d(28453),r=d(77956);const i={title:"Deduplicate gem",sidebar_label:"Deduplicate",id:"deduplicate",slug:"/analysts/deduplicate",description:"Remove duplicates from your data",tags:["gems","analyst","prepare"]},c=void 0,a={},h=[{value:"Parameters",id:"parameters",level:2},{value:"Mode",id:"mode",level:2},{value:"Example",id:"example",level:2},{value:"Distinct Rows",id:"distinct-rows",level:3},{value:"Distinct Rows with Target Columns",id:"distinct-rows-with-target-columns",level:3},{value:"First and Last",id:"first-and-last",level:3},{value:"Unique Only",id:"unique-only",level:3}];function o(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.A,{execution_engine:"SQL Warehouse",sql_package_name:"",sql_package_version:""}),"\n",(0,t.jsx)(s.p,{children:"When working with data, it\u2019s common to run into duplicate information. Duplicates can come from multiple data sources, system errors, or repeated updates over time."}),"\n",(0,t.jsx)(s.p,{children:"Leverage the Deduplication gem to remove these duplicates, and pay close attention to the Deduplication mode that you use."}),"\n",(0,t.jsx)(s.admonition,{title:"Interactive Gem Example",type:"info",children:(0,t.jsxs)(s.p,{children:["The Deduplicate gem has a corresponding interactive gem example. See ",(0,t.jsx)(s.a,{href:"/analysts/gems#interactive-gem-examples",children:"Interactive gem examples"})," to learn how to run sample pipelines for this and other gems."]})}),"\n",(0,t.jsx)(s.h2,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Parameter"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Mode"}),(0,t.jsx)(s.td,{children:"Deduplication method"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Expression"}),(0,t.jsx)(s.td,{children:"Column(s) to check for duplicates"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Use Custom Order By"}),(0,t.jsxs)(s.td,{children:["Sort rows before deduplicating (First and Last mode ",(0,t.jsx)(s.strong,{children:"only"}),")."]})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"mode",children:"Mode"}),"\n",(0,t.jsxs)(s.p,{children:["Next to ",(0,t.jsx)(s.strong,{children:"Deduplicate On Columns"}),", choose how to keep certain rows."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Mode"}),(0,t.jsx)(s.th,{children:"Description"}),(0,t.jsx)(s.th,{children:"Output"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Distinct Rows"}),(0,t.jsx)(s.td,{children:"Keeps one version of each duplicated row, removing extra duplicates."}),(0,t.jsx)(s.td,{children:"All columns are passed through unless target columns are specified."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Unique Only"}),(0,t.jsx)(s.td,{children:"Keeps only the rows that appear exactly once and removes any duplicate rows"}),(0,t.jsx)(s.td,{children:"All columns are passed through."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"First"}),(0,t.jsx)(s.td,{children:"Keeps the first occurrence of the duplicate row."}),(0,t.jsx)(s.td,{children:"All columns are passed through."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Last"}),(0,t.jsx)(s.td,{children:"Keeps the last occurrence of the duplicate row."}),(0,t.jsx)(s.td,{children:"All columns are passed through."})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"example",children:"Example"}),"\n",(0,t.jsx)(s.p,{children:"Assume you have a table of contact information where some people appear more than once. This could be due to updates over time or repeated data entry. You want to identify and clean up these duplicates based on fields like email or phone number."}),"\n",(0,t.jsx)(s.p,{children:"Here is your original table:"}),"\n",(0,t.jsx)("div",{class:"table-example",children:(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"email"}),(0,t.jsx)(s.th,{children:"phone"}),(0,t.jsx)(s.th,{children:"first_name"}),(0,t.jsx)(s.th,{children:"last_name"}),(0,t.jsx)(s.th,{children:"date_added"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"alex.t@example.com"})}),(0,t.jsx)(s.td,{children:"123-456-7890"}),(0,t.jsx)(s.td,{children:"Alex"}),(0,t.jsx)(s.td,{children:"Taylor"}),(0,t.jsx)(s.td,{children:"2023-01-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"alex.t@example.com"})}),(0,t.jsx)(s.td,{children:"123-456-7890"}),(0,t.jsx)(s.td,{children:"Alex"}),(0,t.jsx)(s.td,{children:"Taylor"}),(0,t.jsx)(s.td,{children:"2023-07-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sam.p@example.com"})}),(0,t.jsx)(s.td,{children:"987-654-3210"}),(0,t.jsx)(s.td,{children:"Sam"}),(0,t.jsx)(s.td,{children:"Patel"}),(0,t.jsx)(s.td,{children:"2024-03-15"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"casey.l@example.com"})}),(0,t.jsx)(s.td,{children:"555-111-2222"}),(0,t.jsx)(s.td,{children:"Casey"}),(0,t.jsx)(s.td,{children:"Lee"}),(0,t.jsx)(s.td,{children:"2024-05-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"casey.l@example.com"})}),(0,t.jsx)(s.td,{children:"555-111-2222"}),(0,t.jsx)(s.td,{children:"Casey"}),(0,t.jsx)(s.td,{children:"Lee"}),(0,t.jsx)(s.td,{children:"2025-01-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"jordan.k@example.com"})}),(0,t.jsx)(s.td,{children:"333-444-5555"}),(0,t.jsx)(s.td,{children:"Jordan"}),(0,t.jsx)(s.td,{children:"Kelly"}),(0,t.jsx)(s.td,{children:"2023-09-10"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"morgan.s@example.com"})}),(0,t.jsx)(s.td,{children:"666-777-8888"}),(0,t.jsx)(s.td,{children:"Morgan"}),(0,t.jsx)(s.td,{children:"Smith"}),(0,t.jsx)(s.td,{children:"2025-01-01"})]})]})]})}),"\n",(0,t.jsx)(s.h3,{id:"distinct-rows",children:"Distinct Rows"}),"\n",(0,t.jsxs)(s.p,{children:["Let\u2019s look at what happens with our original table when using ",(0,t.jsx)(s.strong,{children:"Distinct Rows"})," without selecting any specific columns. If two rows match exactly\u2014every value in every column\u2014they are considered duplicates, and only one will be kept."]}),"\n",(0,t.jsx)("div",{class:"table-example",children:(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"email"}),(0,t.jsx)(s.th,{children:"phone"}),(0,t.jsx)(s.th,{children:"first_name"}),(0,t.jsx)(s.th,{children:"last_name"}),(0,t.jsx)(s.th,{children:"date_added"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"alex.t@example.com"})}),(0,t.jsx)(s.td,{children:"123-456-7890"}),(0,t.jsx)(s.td,{children:"Alex"}),(0,t.jsx)(s.td,{children:"Taylor"}),(0,t.jsx)(s.td,{children:"2023-01-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"alex.t@example.com"})}),(0,t.jsx)(s.td,{children:"123-456-7890"}),(0,t.jsx)(s.td,{children:"Alex"}),(0,t.jsx)(s.td,{children:"Taylor"}),(0,t.jsx)(s.td,{children:"2023-07-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sam.p@example.com"})}),(0,t.jsx)(s.td,{children:"987-654-3210"}),(0,t.jsx)(s.td,{children:"Sam"}),(0,t.jsx)(s.td,{children:"Patel"}),(0,t.jsx)(s.td,{children:"2024-03-15"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"casey.l@example.com"})}),(0,t.jsx)(s.td,{children:"555-111-2222"}),(0,t.jsx)(s.td,{children:"Casey"}),(0,t.jsx)(s.td,{children:"Lee"}),(0,t.jsx)(s.td,{children:"2024-05-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"casey.l@example.com"})}),(0,t.jsx)(s.td,{children:"555-111-2222"}),(0,t.jsx)(s.td,{children:"Casey"}),(0,t.jsx)(s.td,{children:"Lee"}),(0,t.jsx)(s.td,{children:"2025-01-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"jordan.k@example.com"})}),(0,t.jsx)(s.td,{children:"333-444-5555"}),(0,t.jsx)(s.td,{children:"Jordan"}),(0,t.jsx)(s.td,{children:"Kelly"}),(0,t.jsx)(s.td,{children:"2023-09-10"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"morgan.s@example.com"})}),(0,t.jsx)(s.td,{children:"666-777-8888"}),(0,t.jsx)(s.td,{children:"Morgan"}),(0,t.jsx)(s.td,{children:"Smith"}),(0,t.jsx)(s.td,{children:"2025-01-01"})]})]})]})}),"\n",(0,t.jsx)(s.p,{children:"The result is identical to the input because no two rows are exact matches across all columns."}),"\n",(0,t.jsx)(s.h3,{id:"distinct-rows-with-target-columns",children:"Distinct Rows with Target Columns"}),"\n",(0,t.jsxs)(s.p,{children:["Often, you want to identify duplicates based on just one or a few columns, like ",(0,t.jsx)(s.code,{children:"email"}),". You can do this by selecting the columns to deduplicate on. Here is the result when email is selected as the target column:"]}),"\n",(0,t.jsx)("div",{class:"table-example",children:(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsx)(s.tr,{children:(0,t.jsx)(s.th,{children:"email"})})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsx)(s.tr,{children:(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"alex.t@example.com"})})}),(0,t.jsx)(s.tr,{children:(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sam.p@example.com"})})}),(0,t.jsx)(s.tr,{children:(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"casey.l@example.com"})})}),(0,t.jsx)(s.tr,{children:(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"jordan.k@example.com"})})}),(0,t.jsx)(s.tr,{children:(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"morgan.s@example.com"})})})]})]})}),"\n",(0,t.jsxs)(s.p,{children:["Only the distinct values from the email column are returned. Other columns are not included, because Prophecy doesn\u2019t assume which corresponding values (like ",(0,t.jsx)(s.code,{children:"phone"})," or ",(0,t.jsx)(s.code,{children:"date_added"}),") to keep. If you want to keep related columns, use the First or Last deduplication methods."]}),"\n",(0,t.jsx)(s.h3,{id:"first-and-last",children:"First and Last"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.strong,{children:"First"})," and ",(0,t.jsx)(s.strong,{children:"Last"})," options help you keep just one row for each duplicate based on the order of the data. You\u2019ll typically combine this with sorting to control which version is retained."]}),"\n",(0,t.jsx)(s.p,{children:"For example, if you want to keep the most recent entry for each duplicate email address, you can:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Choose ",(0,t.jsx)(s.strong,{children:"First"})," and sort by ",(0,t.jsx)(s.code,{children:"date_added"})," descending"]}),"\n",(0,t.jsxs)(s.li,{children:["Choose ",(0,t.jsx)(s.strong,{children:"Last"})," and sort by ",(0,t.jsx)(s.code,{children:"date_added"})," ascending"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Here\u2019s the result when deduplicating by ",(0,t.jsx)(s.code,{children:"email"}),", keeping the most recent record for each:"]}),"\n",(0,t.jsx)("div",{class:"table-example",children:(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"email"}),(0,t.jsx)(s.th,{children:"phone"}),(0,t.jsx)(s.th,{children:"first_name"}),(0,t.jsx)(s.th,{children:"last_name"}),(0,t.jsx)(s.th,{children:"date_added"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"alex.t@example.com"})}),(0,t.jsx)(s.td,{children:"123-456-8888"}),(0,t.jsx)(s.td,{children:"Alex"}),(0,t.jsx)(s.td,{children:"Taylor"}),(0,t.jsx)(s.td,{children:"2023-07-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sam.p@example.com"})}),(0,t.jsx)(s.td,{children:"987-654-3210"}),(0,t.jsx)(s.td,{children:"Sam"}),(0,t.jsx)(s.td,{children:"Patel"}),(0,t.jsx)(s.td,{children:"2024-03-15"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"casey.l@example.com"})}),(0,t.jsx)(s.td,{children:"555-111-2222"}),(0,t.jsx)(s.td,{children:"Casey"}),(0,t.jsx)(s.td,{children:"Lee"}),(0,t.jsx)(s.td,{children:"2025-01-01"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"jordan.k@example.com"})}),(0,t.jsx)(s.td,{children:"333-444-5555"}),(0,t.jsx)(s.td,{children:"Jordan"}),(0,t.jsx)(s.td,{children:"Kelly"}),(0,t.jsx)(s.td,{children:"2023-09-10"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"morgan.s@example.com"})}),(0,t.jsx)(s.td,{children:"666-777-8888"}),(0,t.jsx)(s.td,{children:"Morgan"}),(0,t.jsx)(s.td,{children:"Smith"}),(0,t.jsx)(s.td,{children:"2025-01-01"})]})]})]})}),"\n",(0,t.jsx)(s.h3,{id:"unique-only",children:"Unique Only"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.strong,{children:"Unique Only"})," option removes all rows with duplicates. It keeps only the rows that appear exactly once, based on the selected columns."]}),"\n",(0,t.jsxs)(s.p,{children:["For example, if you choose to deduplicate based on ",(0,t.jsx)(s.code,{children:"email"}),", any row that contains an email address that appears more than once will be removed entirely. Here\u2019s the result when using ",(0,t.jsx)(s.strong,{children:"Unique Only"})," on the original table with ",(0,t.jsx)(s.code,{children:"email"})," as the target column:"]}),"\n",(0,t.jsx)("div",{class:"table-example",children:(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"email"}),(0,t.jsx)(s.th,{children:"phone"}),(0,t.jsx)(s.th,{children:"first_name"}),(0,t.jsx)(s.th,{children:"last_name"}),(0,t.jsx)(s.th,{children:"date_added"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sam.p@example.com"})}),(0,t.jsx)(s.td,{children:"987-654-3210"}),(0,t.jsx)(s.td,{children:"Sam"}),(0,t.jsx)(s.td,{children:"Patel"}),(0,t.jsx)(s.td,{children:"2024-03-15"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"jordan.k@example.com"})}),(0,t.jsx)(s.td,{children:"333-444-5555"}),(0,t.jsx)(s.td,{children:"Jordan"}),(0,t.jsx)(s.td,{children:"Kelly"}),(0,t.jsx)(s.td,{children:"2023-09-10"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"morgan.s@example.com"})}),(0,t.jsx)(s.td,{children:"666-777-8888"}),(0,t.jsx)(s.td,{children:"Morgan"}),(0,t.jsx)(s.td,{children:"Smith"}),(0,t.jsx)(s.td,{children:"2025-01-01"})]})]})]})})]})}function x(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},77956:(e,s,d)=>{d.d(s,{A:()=>t});d(96540);var n=d(74848);function t(e){return(0,n.jsxs)("div",{children:[e.execution_engine&&(0,n.jsx)("a",{href:"https://docs.prophecy.io/administration/fabrics/prophecy-fabrics/",children:(0,n.jsx)("span",{className:"badge badge-runtime",children:e.execution_engine})}),e.sql_package_name&&e.sql_package_version&&(0,n.jsx)("a",{href:"https://docs.prophecy.io/engineers/package-hub/",children:(0,n.jsxs)("span",{className:"badge badge-dependency",children:[e.sql_package_name," ",e.sql_package_version]})}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{})]})}}}]);