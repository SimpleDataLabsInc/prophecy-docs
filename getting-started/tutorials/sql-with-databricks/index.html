<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-getting-started/tutorials/sql-with-databricks" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">SQL with Databricks | Prophecy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.prophecy.io/getting-started/tutorials/sql-with-databricks"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SQL with Databricks | Prophecy"><meta data-rh="true" name="description" content="A tutorial on using SQL with the help of Data Transformation Copilot"><meta data-rh="true" property="og:description" content="A tutorial on using SQL with the help of Data Transformation Copilot"><link data-rh="true" rel="icon" href="/img/favicon2.png"><link data-rh="true" rel="canonical" href="https://docs.prophecy.io/getting-started/tutorials/sql-with-databricks"><link data-rh="true" rel="alternate" href="https://docs.prophecy.io/getting-started/tutorials/sql-with-databricks" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.prophecy.io/getting-started/tutorials/sql-with-databricks" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZWUS3CKBSL-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Prophecy" href="/opensearch.xml">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/assets/css/styles.0cbfe932.css">
<link rel="preload" href="/assets/js/runtime~main.59fa6c0e.js" as="script">
<link rel="preload" href="/assets/js/main.f93c800a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Prophecy Logo.png" alt="Prophecy Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/Prophecy Logo White.png" alt="Prophecy Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/administration">Administration</a><a href="https://transpiler.docs.prophecy.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Transpiler</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/getting-help">Help</a><a href="mailto:docs@prophecy.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Feedback</a><a href="http://app.prophecy.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Login</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Prophecy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-divider"></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/getting-started/">Getting started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/getting-started/quick-starts/">Quick starts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quick starts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/getting-started/tutorials/">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/tutorials/spark-with-databricks">Spark with Databricks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/tutorials/sql-with-snowflake">SQL with Snowflake</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/getting-started/tutorials/sql-with-databricks">SQL with Databricks</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/concepts/">Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/copilot/">Data Copilot</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data Copilot&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/release_notes/">Release notes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Release notes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-divider"></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Spark/">Pipeline development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pipeline development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/SQL/">Model development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Model development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/lineage/">Lineage</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lineage&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/ci-cd/reliable-ci-cd">CI/CD</a><button aria-label="Toggle the collapsible sidebar category &#x27;CI/CD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Orchestration/">Orchestration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Orchestration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/extensibility/">Extensibility</a><button aria-label="Toggle the collapsible sidebar category &#x27;Extensibility&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/getting-started/"><span itemprop="name">Getting started</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/getting-started/tutorials/"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">SQL with Databricks</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>SQL with Databricks</h1></header><p>In this tutorial, we will show you how to setup Prophecy&#x27;s Data Copilot for SQL using an existing Databricks warehouse.</p><p>We&#x27;ll take you step by step from account setup to developing your first model. By the end of this training, you&#x27;ll have an understanding of dbt models, be able to use Prophecy&#x27;s visual interface to define and test your business logic, and commit this code and deploy it to production. That&#x27;s a lot, but we make building complex queries easy with our drag and drop tooling. Let&#x27;s dig in!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h2><p>For this tutorial, you will need:</p><ul><li>A Prophecy account.</li><li>A Databricks account.</li><li>A GitHub account.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-prophecy-account">Set up Prophecy account<a href="#set-up-prophecy-account" class="hash-link" aria-label="Direct link to Set up Prophecy account" title="Direct link to Set up Prophecy account">​</a></h2><p>Creating your first account on Prophecy is very simple. Go to <a href="https://app.Prophecy.io/metadata/auth/signup" target="_blank" rel="noopener noreferrer">app.prophecy.io</a> to Sign-up for an initial 21-day trial. After you’ve tried the product for 21 days, simply reach out to us at <a href="mailto:Contact.us@Prophecy.io" target="_blank" rel="noopener noreferrer">Contact.us@Prophecy.io</a> and we will help pick the best offering for you.</p><p><a href="https://app.prophecy.io/metadata/auth/signup" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Account Creation" src="/assets/images/Snow1_signup-82e98b08f0f44b562d6326d7a9856895.png" width="2880" height="1726" class="img_ev3q"></a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="connect-to-databricks">Connect to Databricks<a href="#connect-to-databricks" class="hash-link" aria-label="Direct link to Connect to Databricks" title="Direct link to Connect to Databricks">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="get-databricks-cluster-or-warehouse-url">Get Databricks Cluster or Warehouse URL<a href="#get-databricks-cluster-or-warehouse-url" class="hash-link" aria-label="Direct link to Get Databricks Cluster or Warehouse URL" title="Direct link to Get Databricks Cluster or Warehouse URL">​</a></h3><p>When connecting to Databricks, you have the option to either connect to Databricks compute cluster or warehouse. In both cases, make sure to get the 2.6.25 JDBC url that starts with <code>jdbc:Databricks....</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-jdbc-end-point">Cluster JDBC End-point<a href="#cluster-jdbc-end-point" class="hash-link" aria-label="Direct link to Cluster JDBC End-point" title="Direct link to Cluster JDBC End-point">​</a></h4><p><img loading="lazy" alt="Databricks compute cluster end-point" src="/assets/images/2-1-databricks-compute-cluster-end-point-8466fd5ef28abd2c99a39dab72970cbf.png" width="2394" height="1458" class="img_ev3q"></p><p>To use a cluster as your execution environment for SQL queries, click on <strong>(1) Compute</strong> element in the menu, choose your preferred cluster, open cluster <strong>(2) Configuration</strong> &gt; <strong>(3) JDBC/ODBC,</strong> switch the JDBC URL to the latest version <strong>(4) 2.6.25 or later,</strong> and finally copy the <strong>(5) JDBC URL.</strong></p><p>When using the compute cluster JDBC end-points, the last parameter of the url contains the password provided as user’s personal access token. Make sure to delete that URL fragment before entering it.</p><p>Here’s a correct example <code>url: jdbc:Databricks://dbc-abc.cluod.Databricks.com:443/...;UID=token;</code></p><p>For optimal performance and best governance options, we recommend using <a href="https://docs.databricks.com/clusters/cluster-config-best-practices.html" target="_blank" rel="noopener noreferrer">Shared, Photon-enabled</a> clusters with <a href="https://docs.databricks.com/data-governance/unity-catalog/compute.html" target="_blank" rel="noopener noreferrer">Unity-catalog</a> enabled.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="warehouse-jdbc-end-point">Warehouse JDBC End-point<a href="#warehouse-jdbc-end-point" class="hash-link" aria-label="Direct link to Warehouse JDBC End-point" title="Direct link to Warehouse JDBC End-point">​</a></h4><p><img loading="lazy" alt="Databricks warehouse cluster end-point" src="/assets/images/2-2-databricks-warehouse-cluster-end-point-409a81ce89d38a52b0210dd78e6f57db.png" width="2880" height="1726" class="img_ev3q"></p><p>To use a warehouse as your execution environment for SQL queries, switch to the <strong>(1) SQL</strong> persona, choose <strong>(2) SQL Warehouses</strong> from the sidebar menu, pick your preferred warehouse, go to <strong>(3) Connection</strong> details, select the latest version of JDBC URL <strong>(4) 2.6.25 or later</strong> and save the the <strong>(5) JDBC URL.</strong></p><p>For optimal performance and best governance options, we recommend using <a href="https://docs.databricks.com/sql/admin/create-sql-warehouse.html#upgrade-a-pro-or-classic-sql-warehouse-to-a-serverless-sql-warehouse" target="_blank" rel="noopener noreferrer">Pro</a> Serverless warehouses with <a href="https://docs.databricks.com/data-governance/unity-catalog/compute.html" target="_blank" rel="noopener noreferrer">Unity Catalog</a> enabled.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-personal-access-token-pat">Create a Personal Access Token (PAT)<a href="#create-a-personal-access-token-pat" class="hash-link" aria-label="Direct link to Create a Personal Access Token (PAT)" title="Direct link to Create a Personal Access Token (PAT)">​</a></h3><p>To authorize as yourself when accessing your Databricks cluster or warehouse through a JDBC a special password is required. This is what Personal Access Token is created for. It’s a temporary password created specifically for programmatic access.</p><p><img loading="lazy" alt="get-personal-access-token" src="/assets/images/2-3-get-personal-access-token-b76396d79545a400642f666fa2917f2e.png" width="2880" height="1726" class="img_ev3q"></p><p>To get the personal access token, navigate to the <strong>(1) User Settings</strong> &gt; <strong>(2) Access tokens</strong> and click the <strong>(3) Generate</strong> new token button button. Give a clearly identifiable name to your access token, in case you ever have to delete and set your preferred lifetime. Please note, that after the lifetime passes and the token expires, it will no longer be valid and you will have to regenerate it again to keep using Prophecy.</p><p>Once, the token is generated copy and save it from <strong>(5) Token</strong> and you’re good to go. Save it and we’re going to use both the JDBC url generated in the previous step and the token to setup your Prophecy account!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-a-fabric-in-prophecy">Set up a fabric in Prophecy<a href="#set-up-a-fabric-in-prophecy" class="hash-link" aria-label="Direct link to Set up a fabric in Prophecy" title="Direct link to Set up a fabric in Prophecy">​</a></h3><p>A <a href="/concepts/fabrics/">fabric</a> in Prophecy is an execution environment. In this case, you already know you want to use Databricks for your computation, so we&#x27;ll make a Databricks fabric!</p><p><img loading="lazy" alt="Create Fabric" src="/assets/images/2-4-create-fabric-154286dde73159594da1e711e7a38838.png" width="2880" height="1020" class="img_ev3q"></p><p>Setting up a fabric is very straightforward now that we have copied the JDBC URL and Personal Access Token from the previous steps. Click the <strong>(1) Create Entity</strong> button, and choose <strong>(2) Create Fabric</strong> option. Note, until you setup a fabric, creation of other entities is going to be disabled. The fabric creation is composed of two steps: Basic Info and Providers setup. On the Basic Info screen, enter a <strong>(1) Fabric Name</strong>, <strong>(2) Fabric Description,</strong> and choose the <strong>(3) Team</strong> that’s going to own the fabric.</p><p>Once ready, click <strong>(4) Continue.</strong></p><p><img loading="lazy" alt="Fill Fabric Details" src="/assets/images/2-5-fill-fabric-details-0bf86dfd5c663d9c6f3430e45731a666.png" width="2880" height="1726" class="img_ev3q"></p><p>Since we’re setting up a fabric connected to Databrick’s JDBC SQL endpoint, we choose SQL as the <strong>(1) Provider Type</strong> and Databricks as the <strong>(2) Provider.</strong></p><p>Enter the <strong>(3) JDBC Url</strong> and <strong>(4) Personal Access Token</strong> gathered from the previous steps. Finally, select your <strong>(5) Catalog</strong> and <strong>(6) Schema</strong> of choice. This step is recommended, however, optional. When using Databricks Unity Catalog, the default Catalog is main and the default Schema is default. Make sure you connect to a catalog and schema for which your user has write access. The tables resulting from the model will be written here.</p><p>Click <strong>(7) Complete</strong> when finished. Prophecy checks the credentials and details for network and catalog accesses. If either fails, the fabric won’t be created and you will receive an Exception error. Optionally, enhance metadata viewing by creating a <a href="/administration/metadata-connections">Metadata Connection</a>, recommended for users with hundreds or thousands of tables housed in their data provider(s).</p><p>Note, fabrics are owned by Teams. Every Member present within the Team will be able to access the fabric, however, each individual has to provide their own Personal Access Token.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-new-project">Create a new project<a href="#create-a-new-project" class="hash-link" aria-label="Direct link to Create a new project" title="Direct link to Create a new project">​</a></h2><p>Prophecy’s project is a Git repository or a directory on Git that contains all of your transformation logic. Each Prophecy project contains a dbt Core™️ project. Learn more about projects <a href="/concepts/project/">here.</a></p><p>After fabric creation you can see one project initialized for you by default called HelloWorld_SQL. If you just want to play around with Prophecy, you can start there. However, for the purpose of this tutorial we’re going to build a brand new project from scratch.</p><p><img loading="lazy" alt="Create New project" src="/assets/images/3-1-create-new-project-898119d0e7351d1afe48d9a160a111fa.png" width="2880" height="1020" class="img_ev3q"></p><p>To create a new project press on the <strong>(1) Create Entity</strong> button on the sidebar and choose <strong>(2) Create</strong> on the project tile. The project creation screen will open. Here, on the first page: we configure basic project details; and on the second page: we configure the Git repository details. Fill in the project’s <strong>(3) Name,</strong> <strong>(4) Description</strong> (optional), and set the <strong>(5) project Type</strong> to SQL. After that, select the <strong>(6) Team</strong> which is going to own the newly selected project. By default, you can leave the selected team to be your personal one. Finally, we choose the same <strong>(7) Provider</strong> as we selected in the previous step - Databricks. Once all the details are filled out correctly, you can proceed to the next step by clicking <strong>(8) Continue.</strong></p><p><img loading="lazy" alt="Git Repository Connection" src="/assets/images/3-2-git-repository-connection-03e5ab0796407811f2cdc1f1de4db6c3.png" width="2880" height="1726" class="img_ev3q"></p><p>Once the basic project information is filled out, it’s time to configure the Git repository on which we’re going to store our project. Git brings the best software engineering practices to traditional data engineering. It allows it’s users to version their code, collaborate with teammates easier, and setup robust productionization pipelines.</p><p>In Prophecy, there are two Git setup options: you can either use <strong>(1) Prophecy Managed Git</strong> or <strong>(2) Connect Git</strong> to an existing external repository.</p><p>Once you’re connected to Git using either of the above approaches press <strong>(3) Continue</strong> to finalize project creation.</p><p>If you’re new to Git, we recommend starting by connecting to Prophecy Managed Git.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="connect-to-prophecy-managed-git">Connect to Prophecy Managed Git<a href="#connect-to-prophecy-managed-git" class="hash-link" aria-label="Direct link to Connect to Prophecy Managed Git" title="Direct link to Connect to Prophecy Managed Git">​</a></h3><p>When choosing Prophecy Managed Git as your default Git repository, there are no further steps required! Prophecy automatically takes care of repository creation, connection, and initialization. You can just click <strong>(3) Continue</strong> to finalize the project setup.</p><p>Using Prophecy Managed Git is very easy, but has some major downsides and therefore not recommended for production use-cases. Primarily, you will not be able to access the repository externally from Prophecy programmatically (which is a common enterprise requirement) or create <a href="/concepts/git/pr-templates">Pull Requests</a> (which is also recommended as a part of standard <a href="https://docs.github.com/en/get-started/quickstart/github-flow" target="_blank" rel="noopener noreferrer">Git flow</a>).</p><p>If you decide to choose this option, you can always migrate the project to an external Git Repository by cloning it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="connect-to-external-git-repository">Connect to external Git repository<a href="#connect-to-external-git-repository" class="hash-link" aria-label="Direct link to Connect to external Git repository" title="Direct link to Connect to external Git repository">​</a></h3><p><img loading="lazy" alt="Git Repository Connection" src="/assets/images/3-3-git-repository-connection-c198d2d27caf044c3b26645310191b5d.png" width="2880" height="1726" class="img_ev3q"></p><p>When connecting to external Git repositories, you have to first setup a Git connection with Prophecy. This can be done in two ways:</p><ol><li>For GitHub - with single click connection (through GitHub OAuth)</li><li>For other Git providers (e.g. Bitbucket, GitLab, etc) - by providing a Personal Access Token</li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>To see a dropdown of repositories accessible to the Git user, be sure to connect from Prophecy using the native GitHub Oauth method, ie <strong>Login with GitHub</strong>. The dropdown list of repositories is not accessible to Prophecy if the Git connection uses the Personal Access Token method of authentication.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="connect-to-github">Connect to GitHub<a href="#connect-to-github" class="hash-link" aria-label="Direct link to Connect to GitHub" title="Direct link to Connect to GitHub">​</a></h4><p><img loading="lazy" alt="Connect With GitHub" src="/assets/images/3-4-connect-with-github-7fa54f7edba727023f8b35b250736b85.png" width="2880" height="1276" class="img_ev3q"></p><p>If you have an existing GitHub account this process is very simple, thanks to Prophecy’s strong OAuth GitHub integration. If you don’t, you can create an account at <a href="http://github.com" target="_blank" rel="noopener noreferrer">GitHub.com</a>.</p><p>Each Git connection in Prophecy starts with an <strong>(1) Alias</strong> that’s going to be used to allow you to identify the right Git account. In most cases, this can be left as default. With that set click <strong>(2) Login</strong> with GitHub which will redirect you to a GitHub login page (if you’re not yet logged in). Enter your details and <strong>(3) Sign in</strong> or create a new account. From there, you’ll be asked to approve Prophecy as a valid application.</p><p>Note, that Prophecy will not store any information, beyond basic user details (like email) and repository content (only queried at your explicit permission for each repository).</p><p>If you’d like to connect Prophecy to one of your GitHub organizations, make sure those are approved in the Organization access section.</p><p>Once done, press on <strong>(4) Authorize</strong> SimpleDataLabsInc (legal organization name of Prophecy.io). The tab should be automatically closed and you’ll be redirected back to Prophecy, which will mark the connection as complete. If for some reason this hasn’t happened (which can happen if you switched between other tabs), simply try clicking on the <!-- -->*<!-- -->*<!-- -->(2) Login with GitHub again.</p><p>Finally, click <strong>(5) Connect</strong> to save the Git connection.</p><p><img loading="lazy" alt="Choose the repository" src="/assets/images/3-5-choose-the-repository-60e912836d99b0e1eb28c437d359e54c.png" width="2880" height="1726" class="img_ev3q"></p><p>Once your GitHub account is setup, select a repository where Prophecy will store all the code for this project. Choose a <strong>(1) Repository</strong> from the dropdown available. If you’d like to create a new repository from scratch follow <a href="https://docs.github.com/en/get-started/quickstart/create-a-repo" target="_blank" rel="noopener noreferrer">this guide.</a></p><p><strong>(2) Default Branch</strong> field should populate automatically based on the repository’s default main branch - you can change if necessary. Default branch is a central point where all the code changes are merged, serving as the primary, up-to-date source for a project.</p><p>Sometimes, you might want to load a project that’s within a specific subpath of a repository as opposed to the root. In that case, you can specify that path in the <strong>(3) Path</strong> field. Note, that the selected path should be either empty (in which case, Prophecy is going to treat it as a new project) or contain a valid dbt Core project (in which case, Prophecy is going to import it).</p><p>Finally, click <strong>(4) Continue</strong> and your main project page will open.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="connect-to-other-git-providers">Connect to other Git providers<a href="#connect-to-other-git-providers" class="hash-link" aria-label="Direct link to Connect to other Git providers" title="Direct link to Connect to other Git providers">​</a></h4><p><img loading="lazy" alt="Connect With Other Git" src="/assets/images/3-6-connect-with-other-git-8f981a7b277977b14337963ad139dd18.png" width="2880" height="1726" class="img_ev3q"></p><p>To establish Git connection with any other Git provider, simply choose the provider from the <strong>(1) Git Provider</strong> list or select Other. Setup steps for most providers are the same, as they follow standard secure Git protocol.</p><p>Firstly, define the <strong>(2) Alias</strong> that will allow you to easily identify your Git account. If you intend on connecting to only one Git account, you can simply leave as default.</p><p>Then, you have to provide your <strong>(3) Git Email,</strong> <strong>(4) Git Username,</strong> and <strong>(5) Git Personal Access Token.</strong> For most of the Git providers the username is the same as the email, however this is not always the case. Ensure to provide correct email, as the commits made by Prophecy are going to appear as if made by it.</p><p>Each provider is going to use a slightly different process to generate Personal Access Token, here are the guides for some of the most common providers: <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">GitHub</a>, <a href="https://support.atlassian.com/bitbucket-cloud/docs/create-a-repository-access-token/" target="_blank" rel="noopener noreferrer">BitBucket</a>, and <a href="https://learn.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&amp;tabs=Windows" target="_blank" rel="noopener noreferrer">Azure DevOps</a>.</p><p>Finally, click <strong>(6) Connect</strong> to save the Git connection.</p><p><img loading="lazy" alt="Choose the repository" src="/assets/images/3-7-choose-the-repository-19c0328a1de7a2964068e5d44a29eea3.png" width="2880" height="1726" class="img_ev3q"></p><p>Once your GitHub account is setup, populate the <strong>(1) Repository</strong> field with an HTTPS URL to a Git repository you’d like to pull.</p><p>Then, fill in the <strong>(2) Default Branch</strong> field based on the default main repository’s branch (this is usually main or master). Default branch is a central point where all the code changes are merged, serving as the primary, up-to-date source for a project.</p><p>Sometimes, you might want to load a project that’s within a specific subpath of a repository as opposed to the root. In that case, you can specify that path in the <strong>(3) Path</strong> field. Note, that the selected path should be either empty (in which case, Prophecy is going to treat it as a new project) or contain a valid dbt Core project (in which case, Prophecy is going to import it).</p><p>Finally, click <strong>(4) Continue</strong> and your main project page will open.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="start-development">Start development<a href="#start-development" class="hash-link" aria-label="Direct link to Start development" title="Direct link to Start development">​</a></h2><p>Congratulations! We’ve now successfully went through the one-time setup process of Prophecy with all the required dependencies. We can now use Databricks’ performant SQL execution engine and Git’s source code versioning.</p><p>It’s time to start building our first data transformation project!</p><p><img loading="lazy" alt="Create Dev Branch" src="/assets/images/4-1-create-dev-branch-045c268a95e67df0adbc9ed229fa0bf8.png" width="2880" height="2344" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="checkout-a-development-branch">Checkout a development branch<a href="#checkout-a-development-branch" class="hash-link" aria-label="Direct link to Checkout a development branch" title="Direct link to Checkout a development branch">​</a></h3><p>As a good teammate, we don’t want to write changes directly on the main branch of our Git repository. Every member should have their own branch on which they can freely build and play around with the project, without interrupting each other’s work. Prophecy enforces this best practice by ensuring that no changes can be made directly on the main branch.</p><p>Therefore, to start development we have to create our first development branch. Start by clicking on the <strong>(1) Checkout Branch</strong> and type in the desired name in the <strong>(2) Branch</strong> field. The best branch names should be representative of the changes that you’re making, so that your colleagues can quickly identify which changes are on which branch. The best branch names should be representative of the changes, and who made them, so that your colleagues can quickly identify which changes are on which branch. A good default name is <code>dev/&lt;first_name&gt;</code> . Once you decide on the name, click <strong>(3) Checkout.</strong></p><p>Note, that if the branch doesn’t exist, Prophecy creates a new branch automatically by essentially cloning what’s on the currently selected branch - therefore make sure to usually create new branch (checkout) from main. If the branch exists, the code for that branch is pulled from Git into Prophecy.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="connect-to-a-fabric">Connect to a fabric<a href="#connect-to-a-fabric" class="hash-link" aria-label="Direct link to Connect to a fabric" title="Direct link to Connect to a fabric">​</a></h3><p>Prophecy allows for interactive execution of your modeling work. This allows you to run any SQL model directly on the fabric we’ve connected to and preview the resulting data. Fabric connection also allows Prophecy to introspect the schemas on your data warehouse and ensure that your development queries are correct.</p><p>After branch setup, fabric selection should pop-up automatically; if not, you can easily set the fabric by clicking on the <strong>(4) Choose cluster</strong> dropdown.</p><p>Choose the fabric of choice by clicking on it in the <strong>(5) Fabrics</strong> list, then simply <strong>(6) Save</strong> the settings.</p><p>Prophecy will quickly load all the available catalogs, schemas, tables, and other metadata and shortly after to allow you to start running your transformations!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-data-sources">Define data sources<a href="#define-data-sources" class="hash-link" aria-label="Direct link to Define data sources" title="Direct link to Define data sources">​</a></h3><p>The first step, before building actual transformation logic, is definition of data sources. There are three primary ways to define data sources in a SQL project:</p><ol><li><strong>seeds</strong> - which allow for loading small CSV datasets into your warehouse (useful for small test datasets or lookup mappings, like list of countries)</li><li><strong>datasets</strong> - table points with schema and additional metadata</li><li><strong>other models</strong> - since each model defines a table, models can serve as inputs to another model (we’re going to cover models in the next section)</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-seeds">Create seeds<a href="#create-seeds" class="hash-link" aria-label="Direct link to Create seeds" title="Direct link to Create seeds">​</a></h4><p>Seeds allow you to define small CSV-based datasets that are going to be automatically uploaded to your warehouse as tables, whenever you execute your models. This is particularly useful for business data tables or for integration testing on data samples.</p><p><img loading="lazy" alt="Create a new seed" src="/assets/images/4-2-create-a-new-seed-cece5b02ca37238883d19ed6f3b3ec35.png" width="2880" height="1084" class="img_ev3q"></p><p>To create a seed click on the <strong>(1) + Add Seed</strong> button. A new pop-up window will appear where you can define metadata of the seed. There you can define the <strong>(2) Name</strong> of seed (which is going to be the same as the name of the table created) and the <strong>(3) Path</strong> for for it. When ready press <strong>(4) OK,</strong> to add.</p><p><img loading="lazy" alt="Define Seed Value" src="/assets/images/4-3-define-seed-value-2689a9d61b7433b8ee460aa394b4da63.png" width="2880" height="1084" class="img_ev3q"></p><p>The seed initializes by default empty. To define the value simple copy and paste the content of desired CSV (each column separate by a comma, each row separated by a new line, with a header as the first line) into the <strong>(1) Code editor.</strong> To verify whether the seed is parsed correctly, you can see it after switching again to the <strong>(2) Visual editor.</strong></p><p>For the purpose of this tutorial, create a nation seed, with the following content:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">n_nationkey,n_name,n_regionkey,n_comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0,ALGERIA,0,Vast Sahara; oil-rich.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1,ARGENTINA,1,Tango; beef; Patagonia.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2,BRAZIL,1,Amazon; Carnival; soccer.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3,CANADA,1,Maple; multicultural; vast wilderness.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4,EGYPT,4,Ancient pyramids; Nile River.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5,ETHIOPIA,0,Coffee origin; diverse culture.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="define-datasets">Define datasets<a href="#define-datasets" class="hash-link" aria-label="Direct link to Define datasets" title="Direct link to Define datasets">​</a></h4><p>Importing datasets is really easy. We can just drag-and-drop our existing tables directly into a model. We’re going to demonstrate that in the next step.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="develop-your-first-model">Develop your first model<a href="#develop-your-first-model" class="hash-link" aria-label="Direct link to Develop your first model" title="Direct link to Develop your first model">​</a></h3><p>A model is an entity that contains a set of data transformations and defines either a view or a table that will be created on the warehouse of choice. Each model is stored as a select statement in a SQL file within a project. Prophecy models are based on dbt Core <a href="https://docs.getdbt.com/docs/build/models" target="_blank" rel="noopener noreferrer">models</a>.</p><p><img loading="lazy" alt="Create the first model" src="/assets/images/4-4-create-the-first-model-4882f55984825cb1332db175dfc47d65.png" width="2880" height="1084" class="img_ev3q"></p><p>Here we create customers_nations model that’s going to enrich our customers and produce a report of which customers show up in which geographic areas most commonly.</p><p>To create a new model simply click on the <strong>(1) + Add Model</strong> in the sidebar, when hovering over models section, or <strong>(2) Create Model</strong> button. A model creation pop-up will show up, with very similar options, as when we defined the seed, available. Enter the <strong>(3) Model Name</strong> and <strong>(4) Model Path</strong> and that’s it. Finally save the model by pressing <strong>(5) OK.</strong></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="drag-and-drop-models-graph">Drag and drop model’s graph<a href="#drag-and-drop-models-graph" class="hash-link" aria-label="Direct link to Drag and drop model’s graph" title="Direct link to Drag and drop model’s graph">​</a></h4><div class="wistia_responsive_padding" style="padding:56.25% 0 0 0;position:relative"><div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%"><iframe src="https://fast.wistia.net/embed/iframe/wowmg8l0qq?videoFoam=true" title="Drag and Drop Model Graph Video" allow="autoplay; fullscreen" allowtransparency="true" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" width="100%" height="100%"></iframe></div></div><script src="https://fast.wistia.net/assets/external/E-v1.js" async=""></script><p>Building your model is very simple, thanks to the drag-and-drop interface. In the video above, we’re doing the following, in our newly defined <code>customer_nations</code> model:</p><ol><li>First we add the <code>nation</code> seed, that we’ve previously defined, by dragging and dropping it on the canvas.</li><li>Then we add a table from an <strong>Environment.</strong> We click on the <strong>Environment</strong> tab in the left sidebar and drag the customer table from the <code>samples.tpch</code> catalog and database to the canvas.</li><li>Note, that when two sources are dragged closely to each other a <strong>Join</strong> component is automatically created (as demonstrated on the video).</li><li>Then we drag and drop an <strong>Aggregate</strong> component from the Transform gems drawer and connect it to the upstream <strong>Join</strong> component.</li><li>Finally connect your <strong>Aggregate</strong> to the <strong>TargetModel</strong> that defines your view itself.</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="define-business-logic">Define business logic<a href="#define-business-logic" class="hash-link" aria-label="Direct link to Define business logic" title="Direct link to Define business logic">​</a></h4><p>Once we have dragged and dropped all the relevant gems (transformations) on our canvas, it’s time to fill in the business logic.</p><p><img loading="lazy" alt="Edit gem" src="/assets/images/4-5-edit-gem-41a7b378ebf112264fa616ff4cf53067.png" width="2880" height="1288" class="img_ev3q"></p><p>Clicking on any of the gems shows these options.</p><p><strong>(1) Name Edit</strong> - click to edit the name of the transformation for easy identification.</p><p><strong>(2) Gem Edit</strong> - to modify the gem logic click on the <strong>Open &gt;</strong> button.</p><p><strong>(3) More</strong> - to see more gem configuration options, like editing comments, changing phases or deleting the gem, click on the ... button. Note, that to delete the selected gem you can also press <strong>delete / backspace</strong> on your keyboard.</p><p><strong>(4) Run</strong> - runs the model up to the selected gem. We will learn more about this in the section 7.3 Interactively test.</p><p><strong>(5) See errors</strong> - To see errors related to your gem, hover over the red icon next to the gem. If there’s no red icon, that means your gem has no errors and is good to go!</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="join-definition">Join definition<a href="#join-definition" class="hash-link" aria-label="Direct link to Join definition" title="Direct link to Join definition">​</a></h4><p><img loading="lazy" alt="Join definition" src="/assets/images/4-6-join-definition-deee9de34519e73b1b090be43586a26d.png" width="2880" height="1084" class="img_ev3q"></p><p>Let’s start by building the <strong>Join</strong> transformation. Upon opening the gem, you can see a drawer pop-up which provides several helpful features. For transparency, you can always see the <strong>(1) Input schema</strong> on the left-hand side, <strong>(4) Errors</strong> in the footer, and have the ability to <strong>(5) Run</strong> the gem on the top right.</p><p>To fill-in our <strong>(3) Join condition</strong> within the <strong>(2) Conditions</strong> section, type <code>nation.n_nationkey = customers.c_nationkey</code>. The following condition, for every single customer, finds a nation based on the c_nationkey field.</p><p>When you’re writing your expressions, you’ll be able to see expression builder, which shows you available functions and columns to speed up your development. Whenever the autocomplete appears, press ↑, ↓ to navigate between the suggestions and press tab to accept the suggestion.</p><p>The <strong>(6) Expressions</strong> tab allows you to define a set of output columns that are going to be returned from the gem. We leave it here empty, which by default, passes through all the input columns, from both of the joined sources, without any modifications.</p><p>To rename our gem to describe its functionality, click on it’s <strong>(7) Name</strong> and modify it to e.g. <code>by_nation_key</code>. Note, that gem names are going to be used as query names, which means that they should be concise and composed of alphanumeric characters with no spaces.</p><p>Once done, press <strong>(8) Save.</strong></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="aggregate-definition">Aggregate definition<a href="#aggregate-definition" class="hash-link" aria-label="Direct link to Aggregate definition" title="Direct link to Aggregate definition">​</a></h4><p><img loading="lazy" alt="Aggregate definition" src="/assets/images/4-8-aggregate-definition-3d9d5bca1410d849e83950fa9e2e217b.png" width="2880" height="1084" class="img_ev3q"></p><p>Next, let’s define the transformation logic for our <strong>Aggregate</strong> gem, which will sum up the number of customers within each of the geographical locations and return a clean set of columns.</p><p>Within the <strong>(1) Aggregate</strong> tab define the following expressions on the <strong>(2) Expressions</strong> List. Most importantly, we create the <code>customers</code> column by counting customers using the <code>count(c_custkey)</code> expression. We also add two columns <code>name</code> and <code>nation_key</code>, that describe the selected location. Note, that to easily add columns you can simply click on them in the schema browser on the left side.</p><p>Once the aggregation expressions are specified, we can consider grouping by a particular column. Switch to the Group By tab, and type in n_nationkey .</p><p>Finally, we <strong>(3) Rename</strong> our gem to <code>count_customers</code> and <strong>(4) Save</strong> it.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="interactively-test">Interactively test<a href="#interactively-test" class="hash-link" aria-label="Direct link to Interactively test" title="Direct link to Interactively test">​</a></h4><p>Now that our model is fully defined, with all the logic specified, it’s time to test it.</p><p><img loading="lazy" alt="Interactively run" src="/assets/images/4-9-interactively-run-6d562269518a4d42ad8e7d46cb96cffa.png" width="2880" height="1084" class="img_ev3q"></p><p>Prophecy makes interactively testing the models incredibly easy! Simply click on the <strong>(1) Play</strong> button on any of the gems and the model with all of it’s upstream dependencies will be executed. Once the model runs, the <strong>(2) Result</strong> icon appears. Click the Result icon to view a <strong>(3) Sample</strong> set of records.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="orchestrate-and-deploy">Orchestrate and Deploy<a href="#orchestrate-and-deploy" class="hash-link" aria-label="Direct link to Orchestrate and Deploy" title="Direct link to Orchestrate and Deploy">​</a></h2><p>Now that we’ve developed and tested our models, it’s time to schedule and deploy them to production. This will allow our code to run on a recurrent interval, e.g. daily, depending on how often our upstream data arrives and our business commitments.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-your-job">Create your job<a href="#create-your-job" class="hash-link" aria-label="Direct link to Create your job" title="Direct link to Create your job">​</a></h3><p><img loading="lazy" alt="Create job" src="/assets/images/5-1-create-job-c8f5fe6378c76357484df1eff821af6c.png" width="2880" height="1084" class="img_ev3q"></p><p>We start by creating a job. Jobs are graphs that orchestrate various tasks that are executed by the scheduler.</p><p>To create a job, we start by clicking on the <strong>(1) Add Job</strong> button in the <strong>Jobs</strong> section of the project browser. <strong>Create Job</strong> drawer appears, where we define the details of our job.</p><p>Most of the fields, like <strong>Project</strong> or <strong>Branch</strong> are automatically populated for us. We start by populating the <strong>(2) Name</strong> field. Here, we’re going to run a whole project as part of this job so we give it the same name as the project: <code>getting_started</code>.</p><p>Most importantly, we have to choose the <strong>(3) Fabric</strong> (Databricks SQL warehouse) on which we’re wishing to execute our models and write our tables. You can leave the default here, as the same fabric that we were testing our models on.</p><p>Next, we choose the <strong>(4) Schedule Interval,</strong> which describes how often our schedule is going to run. The interval is defined by a <a href="https://en.wikipedia.org/wiki/Cron#Cron_expression" target="_blank" rel="noopener noreferrer">CRON expression.</a> Click on the 🕒 icon to open an easy interval picker.</p><p>After that, we can optionally provide a list of email address which are going to receive the success or failure alerts. Those can be written in the <strong>(5) Alerts</strong> on the full job section.</p><p>Finally, we create our job by clicking on <strong>(6) Create New.</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-dbt-task">Configure the DBT task<a href="#configure-the-dbt-task" class="hash-link" aria-label="Direct link to Configure the DBT task" title="Direct link to Configure the DBT task">​</a></h3><p><img loading="lazy" alt="Configure the DBT task" src="/assets/images/5-2-configure-dbt-task-6176f159e435c1f2efd17c4c917e29d9.png" width="2880" height="1084" class="img_ev3q"></p><p>Once your job is created, you are redirected to the job editing canvas. You will notice that it looks very similar to the model editor with some subtle differences.</p><p>The <strong>(1) Gem drawer</strong> has been restricted to only a few basic gems relevant to Databricks jobs. For SQL projects, it’s <strong>DBT</strong> and <strong>Script</strong> tasks only.</p><p>Let’s start by dragging and dropping the the <strong>(2) DBT Gem.</strong> Once it’s on the canvas, we open and configure it. Within the <strong>(3) Property</strong> tab, there’s three basic fields we fill:</p><ol><li><strong>DBT project to schedule</strong> - which we set to the current project;</li><li><strong>Databricks SQL Warehouse</strong> - defines on which warehouse our SQL code is going to execute, we set it to the recently created fabric;</li><li><strong>Git reference value</strong> - defines from which branch on Git, the code is pulled to execute, we set it to the currently used developed branch - same as what we set in the step 5.1 Checkout development branch (the name can be also seen in the footer).</li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>DBT projects will appear in this dropdown if (1) the project is released and (2) the project is hosted on Git outside Prophecy&#x27;s managed Git provider.</p></div></div><p>Once all the basic properties are set click <strong>(4) Save.</strong></p><p>We can quickly verify that our schedule runs correctly by executing it, by clicking on the <strong>(5) Play</strong> button. Upon the click, the execution starts and you can track it’s progress. When finished successfully, we know that the project is ready to be deployed.</p><p>Finally, we toggle our job to be <strong>(5) Enabled.</strong> This enables the job on the scheduler and will ensure that the job follows the previously set interval.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="commit-your-changes">Commit your changes<a href="#commit-your-changes" class="hash-link" aria-label="Direct link to Commit your changes" title="Direct link to Commit your changes">​</a></h3><p>Once we have the <strong>Job</strong> developed and tested it’s time to commit and push our code to our repository.</p><p>At the bottom of the screen, click on the <strong>Commit files</strong> button. This opens an easy to use Git management dialog. See 13min20sec in the video at the top of this page.</p><p>The process of deploying code is composed of 4 steps:</p><ol><li><strong>Commit:</strong> We start by creating a named version of our code and uploading it to our development branch on the secure Git repository. On the left-hand side you can see the <strong>Current branch</strong> and the associated history of commits and on the right side, there’s a list of <strong>Entities changed</strong> (models, jobs, etc) and their status. If everything looks good, type in the <strong>Commit message</strong> which should clearly describe, in few sentences, all the changes that we’ve introduced.</li><li><strong>Pull:</strong> Before your changes can be safely merged into the <strong>main</strong> branch, we have to make sure that we’re up to date with it. If your colleagues introduced any code on <strong>main</strong> we have to <strong>Pull</strong> it first. This step is most of the time going to happen automatically for us without any further actions required.</li><li><strong>Merge:</strong> Now that our development branch is up to date, we can merge it to master. Here we can either create a <strong>Pull Request</strong> or if you’re the owner of the repository force <strong>Merge</strong> the changes. For now, we <strong>Merge</strong> them directly. Once the code is merged, you can now see the latest commits present on your <strong>main</strong> branch.</li><li><strong>Release:</strong> Finally, now that our changes are all versioned on Git, we can release them to our scheduler. Simply specify a <strong>Release Version</strong> number, e.g. <code>1.0</code> , and the <strong>Release Note,</strong> which should clearly outline the latest changes. When ready, click <strong>Release.</strong></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-the-release">Monitor the release<a href="#monitor-the-release" class="hash-link" aria-label="Direct link to Monitor the release" title="Direct link to Monitor the release">​</a></h3><p><img loading="lazy" alt="Release the project" src="/assets/images/5-3-release-the-project-d827fbcae69fa93b83118d2fb44327db.png" width="2880" height="1084" class="img_ev3q"></p><p>During the release process Prophecy automatically packages, tests, and deploys your project’s artifacts - mostly SQL queries - to your Databricks Warehouse. You can monitor this process in the final <strong>(1) Release</strong> page.</p><p>Once the process is finished you can see the deployed and running job, within your Databricks workspace defined within the fabric that you released your job to. To see it, go to your workspace and open the <strong>(2) Workflows</strong> section. Then choose the right job - the name will be exactly the same as the name of the job you created in Prophecy. A <strong>(3) Job page</strong> opens, where you can inspect all the details of your newly created job.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What’s next?<a href="#whats-next" class="hash-link" aria-label="Direct link to What’s next?" title="Direct link to What’s next?">​</a></h2><p>Great work! You&#x27;ve successfully set up, developed, tested, and deployed your first SQL project in the Databricks workspace. Take a moment to appreciate your accomplishment.</p><p>To continue learning and expanding your skills with Prophecy, keep exploring our documentation and apply your newfound knowledge to address real-world business challenges!</p><p>If you ever encounter any difficulties, don&#x27;t hesitate to reach out to us (<a href="mailto:Contact.us@Prophecy.io" target="_blank" rel="noopener noreferrer">Contact.us@Prophecy.io</a>) or join our <a href="https://prophecy-io-support.slack.com/join/shared_invite/zt-moq3xzoj-~5MSJ6WPnZfz7bwsqWi8tQ#/shared-invite/email" target="_blank" rel="noopener noreferrer">Slack community</a> for assistance. We&#x27;re here to help!</p><hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/sql">sql</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/tutorial">tutorial</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/getting-started/tutorials/sql-with-snowflake"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SQL with Snowflake</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/concepts/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Concepts</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#set-up-prophecy-account" class="table-of-contents__link toc-highlight">Set up Prophecy account</a></li><li><a href="#connect-to-databricks" class="table-of-contents__link toc-highlight">Connect to Databricks</a><ul><li><a href="#get-databricks-cluster-or-warehouse-url" class="table-of-contents__link toc-highlight">Get Databricks Cluster or Warehouse URL</a></li><li><a href="#create-a-personal-access-token-pat" class="table-of-contents__link toc-highlight">Create a Personal Access Token (PAT)</a></li><li><a href="#set-up-a-fabric-in-prophecy" class="table-of-contents__link toc-highlight">Set up a fabric in Prophecy</a></li></ul></li><li><a href="#create-a-new-project" class="table-of-contents__link toc-highlight">Create a new project</a><ul><li><a href="#connect-to-prophecy-managed-git" class="table-of-contents__link toc-highlight">Connect to Prophecy Managed Git</a></li><li><a href="#connect-to-external-git-repository" class="table-of-contents__link toc-highlight">Connect to external Git repository</a></li></ul></li><li><a href="#start-development" class="table-of-contents__link toc-highlight">Start development</a><ul><li><a href="#checkout-a-development-branch" class="table-of-contents__link toc-highlight">Checkout a development branch</a></li><li><a href="#connect-to-a-fabric" class="table-of-contents__link toc-highlight">Connect to a fabric</a></li><li><a href="#define-data-sources" class="table-of-contents__link toc-highlight">Define data sources</a></li><li><a href="#develop-your-first-model" class="table-of-contents__link toc-highlight">Develop your first model</a></li></ul></li><li><a href="#orchestrate-and-deploy" class="table-of-contents__link toc-highlight">Orchestrate and Deploy</a><ul><li><a href="#create-your-job" class="table-of-contents__link toc-highlight">Create your job</a></li><li><a href="#configure-the-dbt-task" class="table-of-contents__link toc-highlight">Configure the DBT task</a></li><li><a href="#commit-your-changes" class="table-of-contents__link toc-highlight">Commit your changes</a></li><li><a href="#monitor-the-release" class="table-of-contents__link toc-highlight">Monitor the release</a></li></ul></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What’s next?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Prophecy</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.prophecy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.prophecy.io/blogs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/prophecy-io-support/shared_invite/zt-1dwuvkakg-JcavnQuoukyZ3q5jkSkKCg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:docs@prophecy.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation feedback<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://app.prophecy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Login<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Prophecy Inc All Rights Reserved <a href="https://legal.prophecy.io/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.59fa6c0e.js"></script>
<script src="/assets/js/main.f93c800a.js"></script>
</body>
</html>