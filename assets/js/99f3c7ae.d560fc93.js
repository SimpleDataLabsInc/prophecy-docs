"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[11444],{5514:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/match-types-b0a69179c976a31d6051758e2c3d176c.jpg"},28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>l});var n=s(96540);const i={},r=n.createContext(i);function a(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(r.Provider,{value:t},e.children)}},59428:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>x,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"analysts/development/gems/spatial/spatial-match","title":"SpatialMatch gem","description":"Find relationships between geographic features","source":"@site/docs/analysts/development/gems/spatial/spatial-match.md","sourceDirName":"analysts/development/gems/spatial","slug":"/analysts/spatial-match","permalink":"/analysts/spatial-match","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"gems","permalink":"/tags/gems"},{"inline":true,"label":"analyst","permalink":"/tags/analyst"},{"inline":true,"label":"spatial","permalink":"/tags/spatial"}],"version":"current","frontMatter":{"title":"SpatialMatch gem","sidebar_label":"SpatialMatch","id":"spatial-match","slug":"/analysts/spatial-match","description":"Find relationships between geographic features","tags":["gems","analyst","spatial"]},"sidebar":"platformSidebar","previous":{"title":"Simplify","permalink":"/analysts/simplify"},"next":{"title":"Parse gems","permalink":"/analysts/parse-gems"}}');var i=s(74848),r=s(28453),a=s(77956);const l={title:"SpatialMatch gem",sidebar_label:"SpatialMatch",id:"spatial-match",slug:"/analysts/spatial-match",description:"Find relationships between geographic features",tags:["gems","analyst","spatial"]},o=void 0,c={},d=[{value:"Input and Output",id:"input-and-output",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Match types",id:"match-types",level:3},{value:"Match types diagram",id:"match-types-diagram",level:4},{value:"Example: Find stores within delivery zones",id:"example-find-stores-within-delivery-zones",level:2},{value:"Result",id:"result",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.A,{execution_engine:"SQL Warehouse",sql_package_name:"ProphecyDatabricksSqlSpatial",sql_package_version:"0.0.3+"}),"\n",(0,i.jsx)(t.p,{children:"Use the SpatialMatch gem to find relationships between geometries from two different datasets. Common use cases include:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Finding which stores are located within specific delivery zones"}),"\n",(0,i.jsx)(t.li,{children:"Identifying roads that intersect with flood zones"}),"\n",(0,i.jsx)(t.li,{children:"Matching customer locations to their nearest service areas"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The gem uses spatial joins to compare geometries and returns only the pairs that have the spatial relationship you specify, such as shapes overlapping or shapes touching. It works with points, lines, and polygons in Well-Known Text (",(0,i.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry",children:"WKT"}),") format."]}),"\n",(0,i.jsxs)(t.admonition,{type:"tip",children:[(0,i.jsx)(t.p,{children:"Use the following gems to create correctly formatted geometries in a dataset:"}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/analysts/create-point",children:"CreatePoint"})," gem for points"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/analysts/polybuild",children:"PolyBuild"})," gem for lines and polygons"]}),"\n"]})]}),"\n",(0,i.jsx)(t.h2,{id:"input-and-output",children:"Input and Output"}),"\n",(0,i.jsx)(t.p,{children:"The SpatialMatch gem accepts the following inputs and output."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Port"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"in0"})}),(0,i.jsx)(t.td,{children:'Dataset containing geometries (points, lines, or polygons) in WKT format. This is the "left" dataset in the spatial join operation.'})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"in1"})}),(0,i.jsx)(t.td,{children:'Dataset containing geometries (points, lines, or polygons) in WKT format. This is the "right" dataset in the spatial join operation.'})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.strong,{children:"out"})}),(0,i.jsxs)(t.td,{children:["Output dataset containing ",(0,i.jsx)(t.strong,{children:"matched pairs"})," of geometries along with all additional columns from both input datasets. Each row represents a source geometry and target geometry that satisfy the selected spatial relationship. Unmatched geometries are excluded from the output. ",(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"The output includes the following columns: ",(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:"The source geometry column"}),(0,i.jsxs)("li",{children:["All other ",(0,i.jsx)(t.code,{children:"in0"})," columns"]}),(0,i.jsxs)("li",{children:["The target geometry column prefixed with ",(0,i.jsx)(t.code,{children:"target_"})]}),(0,i.jsxs)("li",{children:["All other ",(0,i.jsx)(t.code,{children:"in1"})," columns prefixed with ",(0,i.jsx)(t.code,{children:"target_"})]})]})]})]})]})]}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsx)(t.p,{children:"You can use the same source for both in0 and in1 if you want to match geometries from the same dataset (self-join)."})}),"\n",(0,i.jsx)(t.h2,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsx)(t.p,{children:"Configure the SpatialMatch gem using the following parameters."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Parameter"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Source Column"}),(0,i.jsxs)(t.td,{children:["Select the column from ",(0,i.jsx)(t.code,{children:"in0"})," that contains one set of geometric data."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Target Column"}),(0,i.jsxs)(t.td,{children:["Select the column from ",(0,i.jsx)(t.code,{children:"in1"})," that contains another set of geometric data."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Select Match Type"}),(0,i.jsxs)(t.td,{children:["Choose the spatial relationship that determines when a source geometry matches a target geometry. ",(0,i.jsx)("br",{}),"Learn more in ",(0,i.jsx)(t.a,{href:"#match-types",children:"Match types"}),"."]})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"match-types",children:"Match types"}),"\n",(0,i.jsx)(t.p,{children:"Review the following to understand the criteria to satisfy different match types. The SpatialMatch gem returns a row for each match condition that is met."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Match type"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Source Intersects Target"}),(0,i.jsx)(t.td,{children:"Condition is met if the source and target geometries share any portion of space. This is the most general spatial relationship. Any overlap, touching, or containment satisfies intersection."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Source Contains Target"}),(0,i.jsx)(t.td,{children:"Condition is met if the source geometry completely contains the target geometry. The target geometry must be entirely within the source geometry's interior and boundary."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Source Within Target"}),(0,i.jsxs)(t.td,{children:["Condition is met if the source geometry is completely contained within the target geometry. This is the inverse of the ",(0,i.jsx)(t.strong,{children:"Contains"})," relationship."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Source Touches Target"}),(0,i.jsx)(t.td,{children:"Condition is met if the source and target geometries have at least one point in common, but their interiors do not intersect."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Source Touches or Intersects Target"}),(0,i.jsx)(t.td,{children:"Condition is met if the source and target geometries either touch (share boundary points) or intersect (share any portion of space). This combines the touch and intersect relationships."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Source Envelope Overlaps Target Envelope"}),(0,i.jsx)(t.td,{children:"Condition is met if the minimum bounding rectangles (envelopes) of the source and target geometries overlap. This is a less precise check than a standard intersection."})]})]})]}),"\n",(0,i.jsx)(t.h4,{id:"match-types-diagram",children:"Match types diagram"}),"\n",(0,i.jsx)(t.p,{children:"The following diagram includes visualizations for each match type."}),"\n",(0,i.jsx)("img",{src:s(5514).A,alt:"Match types diagram",className:"no-border-radius"}),"\n",(0,i.jsx)(t.h2,{id:"example-find-stores-within-delivery-zones",children:"Example: Find stores within delivery zones"}),"\n",(0,i.jsx)(t.p,{children:"Assume you have two datasets:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"store_locations"})," contains store locations as points."]}),"\n",(0,i.jsx)("div",{class:"table-example",children:(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"store_id"}),(0,i.jsx)(t.th,{children:"store_name"}),(0,i.jsx)(t.th,{children:"store_location"}),(0,i.jsx)(t.th,{children:"store_type"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"Downtown Electronics"}),(0,i.jsx)(t.td,{children:"POINT(-74.0059 40.7128)"}),(0,i.jsx)(t.td,{children:"electronics"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"Midtown Cafe"}),(0,i.jsx)(t.td,{children:"POINT(-73.9857 40.7489)"}),(0,i.jsx)(t.td,{children:"restaurant"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{children:"Brooklyn Bookstore"}),(0,i.jsx)(t.td,{children:"POINT(-73.9442 40.6782)"}),(0,i.jsx)(t.td,{children:"bookstore"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"4"}),(0,i.jsx)(t.td,{children:"Queens Pharmacy"}),(0,i.jsx)(t.td,{children:"POINT(-73.7949 40.7282)"}),(0,i.jsx)(t.td,{children:"pharmacy"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"5"}),(0,i.jsx)(t.td,{children:"Upper East Side Boutique"}),(0,i.jsx)(t.td,{children:"POINT(-73.9626 40.7831)"}),(0,i.jsx)(t.td,{children:"clothing"})]})]})]})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"delivery_zones"})," contains delivery zones as polygons."]}),"\n",(0,i.jsx)("div",{class:"table-example",children:(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"zone_id"}),(0,i.jsx)(t.th,{children:"zone_name"}),(0,i.jsx)(t.th,{children:"zone_polygon"}),(0,i.jsx)(t.th,{children:"delivery_fee"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"MANHATTAN_SOUTH"}),(0,i.jsx)(t.td,{children:"Lower Manhattan"}),(0,i.jsx)(t.td,{children:"POLYGON((-74.0200 40.7000, -74.0200 40.7300, -73.9800 40.7300, -73.9800 40.7000, -74.0200 40.7000))"}),(0,i.jsx)(t.td,{children:"5.99"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"MANHATTAN_NORTH"}),(0,i.jsx)(t.td,{children:"Upper Manhattan"}),(0,i.jsx)(t.td,{children:"POLYGON((-73.9800 40.7700, -73.9800 40.8000, -73.9400 40.8000, -73.9400 40.7700, -73.9800 40.7700))"}),(0,i.jsx)(t.td,{children:"7.99"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"BROOKLYN_WEST"}),(0,i.jsx)(t.td,{children:"Western Brooklyn"}),(0,i.jsx)(t.td,{children:"POLYGON((-74.0000 40.6500, -74.0000 40.7000, -73.9200 40.7000, -73.9200 40.6500, -74.0000 40.6500))"}),(0,i.jsx)(t.td,{children:"6.99"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"QUEENS_CENTRAL"}),(0,i.jsx)(t.td,{children:"Central Queens"}),(0,i.jsx)(t.td,{children:"POLYGON((-73.8500 40.7000, -73.8500 40.7500, -73.7500 40.7500, -73.7500 40.7000, -73.8500 40.7000))"}),(0,i.jsx)(t.td,{children:"8.99"})]})]})]})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"To find which delivery zones correspond to each store:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Add a SpatialMatch gem to your pipeline canvas."}),"\n",(0,i.jsxs)(t.li,{children:["Attach ",(0,i.jsx)(t.code,{children:"store_locations"})," to the ",(0,i.jsx)(t.strong,{children:"in0"})," port of the gem."]}),"\n",(0,i.jsxs)(t.li,{children:["Attach ",(0,i.jsx)(t.code,{children:"delivery_zones"})," to the ",(0,i.jsx)(t.strong,{children:"in1"})," port of the gem."]}),"\n",(0,i.jsx)(t.li,{children:"Open the gem configuration interface."}),"\n",(0,i.jsxs)(t.li,{children:["For the ",(0,i.jsx)(t.strong,{children:"Source"})," field, select the ",(0,i.jsx)(t.code,{children:"store_location"})," column from the ",(0,i.jsx)(t.code,{children:"store_locations"})," table."]}),"\n",(0,i.jsxs)(t.li,{children:["For the ",(0,i.jsx)(t.strong,{children:"Target"})," field, select the ",(0,i.jsx)(t.code,{children:"zone_polygon"})," column from the ",(0,i.jsx)(t.code,{children:"delivery_zones"})," table."]}),"\n",(0,i.jsxs)(t.li,{children:["Under ",(0,i.jsx)(t.strong,{children:"Select Match Type"}),", select ",(0,i.jsx)(t.strong,{children:"Source Within Target"}),"."]}),"\n",(0,i.jsx)(t.li,{children:"Save and run the gem."}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"result",children:"Result"}),"\n",(0,i.jsx)(t.p,{children:"The SpatialMatch gem will return only the pairs of geometries that satisfy the selected match type. As a result:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Downtown Electronics matches the ",(0,i.jsx)(t.code,{children:"MANHATTAN_SOUTH"})," zone."]}),"\n",(0,i.jsxs)(t.li,{children:["Queens Pharmacy matches the ",(0,i.jsx)(t.code,{children:"QUEENS_CENTRAL"})," zone."]}),"\n",(0,i.jsxs)(t.li,{children:["Upper East Side Boutique matches the ",(0,i.jsx)(t.code,{children:"MANHATTAN_NORTH"})," zone."]}),"\n",(0,i.jsx)(t.li,{children:"Midtown Cafe does not match any zone. This means that it is not in any delivery zone."}),"\n"]})]})}function x(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},77956:(e,t,s)=>{s.d(t,{A:()=>i});s(96540);var n=s(74848);function i(e){return(0,n.jsxs)("div",{children:[e.execution_engine&&(0,n.jsx)("a",{href:"https://docs.prophecy.io/administration/fabrics/prophecy-fabrics/",children:(0,n.jsx)("span",{className:"badge badge-runtime",children:e.execution_engine})}),e.sql_package_name&&e.sql_package_version&&(0,n.jsx)("a",{href:"https://docs.prophecy.io/engineers/package-hub/",children:(0,n.jsxs)("span",{className:"badge badge-dependency",children:[e.sql_package_name," ",e.sql_package_version]})}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{})]})}}}]);