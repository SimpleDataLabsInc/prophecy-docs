"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[98327],{15680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>d});var r=n(96540);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n,r,l={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},y="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,l=e.mdxType,a=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),y=u(n),p=l,d=y["".concat(s,".").concat(p)]||y[p]||g[p]||a;return n?r.createElement(d,o(o({ref:t},c),{},{components:n})):r.createElement(d,o({ref:t},c))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var a=n.length,o=new Array(a);o[0]=p;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[y]="string"==typeof e?e:l,o[1]=i;for(var u=2;u<a;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},19365:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(96540),l=n(20053);const a={tabItem:"tabItem_Ymn6"};function o(e){let{children:t,hidden:n,className:o}=e;return r.createElement("div",{role:"tabpanel",className:(0,l.A)(a.tabItem,o),hidden:n},t)}},11470:(e,t,n)=>{n.d(t,{A:()=>E});var r=n(58168),l=n(96540),a=n(20053),o=n(23104),i=n(56347),s=n(57485),u=n(31682),c=n(89466);function y(e){return function(e){return l.Children.map(e,(e=>{if(!e||(0,l.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:l}}=e;return{value:t,label:n,attributes:r,default:l}}))}function g(e){const{values:t,children:n}=e;return(0,l.useMemo)((()=>{const e=t??y(n);return function(e){const t=(0,u.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function d(e){let{queryString:t=!1,groupId:n}=e;const r=(0,i.W6)(),a=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s.aZ)(a),(0,l.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(r.location.search);t.set(a,e),r.replace({...r.location,search:t.toString()})}),[a,r])]}function m(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,a=g(e),[o,i]=(0,l.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:a}))),[s,u]=d({queryString:n,groupId:r}),[y,m]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,a]=(0,c.Dv)(n);return[r,(0,l.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:r}),h=(()=>{const e=s??y;return p({value:e,tabValues:a})?e:null})();(0,l.useLayoutEffect)((()=>{h&&i(h)}),[h]);return{selectedValue:o,selectValue:(0,l.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),m(e)}),[u,m,a]),tabValues:a}}var h=n(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:t,block:n,selectedValue:i,selectValue:s,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:y}=(0,o.a_)(),g=e=>{const t=e.currentTarget,n=c.indexOf(t),r=u[n].value;r!==i&&(y(t),s(r))},p=e=>{let t=null;switch(e.key){case"Enter":g(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:o}=e;return l.createElement("li",(0,r.A)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>c.push(e),onKeyDown:p,onClick:g},o,{className:(0,a.A)("tabs__item",f.tabItem,o?.className,{"tabs__item--active":i===t})}),n??t)})))}function v(e){let{lazy:t,children:n,selectedValue:r}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===r));return e?(0,l.cloneElement)(e,{className:"margin-top--md"}):null}return l.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,l.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function k(e){const t=m(e);return l.createElement("div",{className:(0,a.A)("tabs-container",f.tabList)},l.createElement(b,(0,r.A)({},e,t)),l.createElement(v,(0,r.A)({},e,t)))}function E(e){const t=(0,h.A)();return l.createElement(k,(0,r.A)({key:String(t)},e))}},51416:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>u,toc:()=>y});var r=n(58168),l=(n(96540),n(15680)),a=n(11470),o=n(19365);const i={title:"Amazon EMR",id:"emr",description:"This page outlines how to use Amazon EMR via Livy as your Spark execution engine in Prophecy.",sidebar_position:6,tags:["deployment","installation","emr","livy","fabric","serverless"]},s=void 0,u={unversionedId:"administration/Spark-fabrics/emr",id:"administration/Spark-fabrics/emr",title:"Amazon EMR",description:"This page outlines how to use Amazon EMR via Livy as your Spark execution engine in Prophecy.",source:"@site/docs/administration/Spark-fabrics/emr.mdx",sourceDirName:"administration/Spark-fabrics",slug:"/administration/Spark-fabrics/emr",permalink:"/administration/Spark-fabrics/emr",draft:!1,tags:[{label:"deployment",permalink:"/tags/deployment"},{label:"installation",permalink:"/tags/installation"},{label:"emr",permalink:"/tags/emr"},{label:"livy",permalink:"/tags/livy"},{label:"fabric",permalink:"/tags/fabric"},{label:"serverless",permalink:"/tags/serverless"}],version:"current",sidebarPosition:6,frontMatter:{title:"Amazon EMR",id:"emr",description:"This page outlines how to use Amazon EMR via Livy as your Spark execution engine in Prophecy.",sidebar_position:6,tags:["deployment","installation","emr","livy","fabric","serverless"]},sidebar:"adminSidebar",previous:{title:"Livy",permalink:"/administration/Spark-fabrics/livy"},next:{title:"Azure Synapse Analytics",permalink:"/administration/Spark-fabrics/azure-synapse-fabric-guide"}},c={},y=[{value:"Create Amazon EMR cluster with Apache Livy",id:"create-amazon-emr-cluster-with-apache-livy",level:2},{value:"Configure network settings",id:"configure-network-settings",level:2},{value:"Create a fabric",id:"create-a-fabric",level:2}],g={toc:y},p="wrapper";function d(e){let{components:t,...i}=e;return(0,l.yg)(p,(0,r.A)({},g,i,{components:t,mdxType:"MDXLayout"}),(0,l.yg)("p",null,"This page outlines how to use Amazon EMR via Livy as your Spark execution engine in Prophecy."),(0,l.yg)("p",null,"These instructions work for both ",(0,l.yg)("strong",{parentName:"p"},"Amazon EMR")," and ",(0,l.yg)("strong",{parentName:"p"},"Amazon EMR Serverless"),"."),(0,l.yg)("h2",{id:"create-amazon-emr-cluster-with-apache-livy"},"Create Amazon EMR cluster with Apache Livy"),(0,l.yg)("p",null,"In your Amazon EMR service, create a cluster. When doing so:"),(0,l.yg)("ol",null,(0,l.yg)("li",{parentName:"ol"},"Under ",(0,l.yg)("strong",{parentName:"li"},"Application bundle")," select ",(0,l.yg)("strong",{parentName:"li"},"Custom"),"."),(0,l.yg)("li",{parentName:"ol"},"When selecting applications, make sure ",(0,l.yg)("strong",{parentName:"li"},"Livy")," and ",(0,l.yg)("strong",{parentName:"li"},"Spark")," are included in the install.")),(0,l.yg)("img",{src:n(9335).A,alt:"EMR create cluster",width:"75%"}),(0,l.yg)("h2",{id:"configure-network-settings"},"Configure network settings"),(0,l.yg)("p",null,"To make sure that EMR can communicate with Prophecy, you need to configure specific network settings. Specifically, you need to modify the security groups of your EMR cluster."),(0,l.yg)("ol",null,(0,l.yg)("li",{parentName:"ol"},"Modify the ",(0,l.yg)("strong",{parentName:"li"},"Primary Node")," security group to allow incoming connections to port ",(0,l.yg)("inlineCode",{parentName:"li"},"8998")," from the Prophecy IP. You can do so by adding an inbound rule to the Master security group that permits incoming traffic on port ",(0,l.yg)("inlineCode",{parentName:"li"},"8998")," from the Prophecy IP address."),(0,l.yg)("li",{parentName:"ol"},"Modify the ",(0,l.yg)("strong",{parentName:"li"},"Core Node")," security group to allow outgoing connections to the Prophecy public IP ",(0,l.yg)("inlineCode",{parentName:"li"},"3.133.35.237")," over HTTPS. Do this by adding an outbound rule to the Core security group that allows outgoing traffic over HTTPS protocol to the Prophecy public IP.")),(0,l.yg)("h2",{id:"create-a-fabric"},"Create a fabric"),(0,l.yg)("p",null,"To connect EMR and Prophecy, you must create a fabric. You can either create an EMR fabric (suggested), or a ",(0,l.yg)("a",{parentName:"p",href:"/administration/Spark-fabrics/livy"},"Livy fabric"),"."),(0,l.yg)(a.A,{mdxType:"Tabs"},(0,l.yg)(o.A,{value:"emr",label:"EMR",default:!0,mdxType:"TabItem"},(0,l.yg)("p",null,"To create an EMR fabric:"),(0,l.yg)("ol",null,(0,l.yg)("li",null,"Open Prophecy and click ",(0,l.yg)("strong",null,"Create Entity")," from the left navigation menu. Then, click on the fabric tile."),(0,l.yg)("li",null,"Name your fabric and click ",(0,l.yg)("strong",null,"Continue"),"."),(0,l.yg)("li",null,"Keep the Provider Type as ",(0,l.yg)("strong",null,"Spark"),", and choose"," ",(0,l.yg)("strong",null,"EMR")," as the Provider."),(0,l.yg)("br",null),(0,l.yg)("img",{src:n(91206).A,alt:"EMR Provider",width:"75%"}),(0,l.yg)("li",null,"Enter your AWS credentials under ",(0,l.yg)("strong",null,"Access Key")," and"," ",(0,l.yg)("strong",null,"Secret Key"),". Then, enter the region that your EMR cluster is running in."),(0,l.yg)("li",null,"Click on ",(0,l.yg)("strong",null,"Fetch environments"),"."),(0,l.yg)("li",null,"Under ",(0,l.yg)("strong",null,"Spark Environment"),", select the EMR cluster that you would like to connect to."),(0,l.yg)("li",null,"Enter the S3 path that points to the location where you would like your logs to persist."),(0,l.yg)("br",null),(0,l.yg)("img",{src:n(17589).A,alt:"EMR dependencies",width:"75%"}),(0,l.yg)("li",null,"Add the job size to your environment by clicking on"," ",(0,l.yg)("strong",null,"Add job Size"),". Configure your job size and click on"," ",(0,l.yg)("strong",null,"Add"),"."),(0,l.yg)("li",null,"Select File System under ",(0,l.yg)("strong",null,"Scala Resolution mode")," and input ",(0,l.yg)("code",null,"s3://prophecy-public-bucket/prophecy-libs")),(0,l.yg)("li",null,"Select File System under ",(0,l.yg)("strong",null,"Python Resolution mode")," and input ",(0,l.yg)("code",null,"s3://prophecy-public-bucket/python-prophecy-libs"))),(0,l.yg)("p",null,"Click ",(0,l.yg)("strong",null,"Complete")," to save your new EMR fabric.")),(0,l.yg)(o.A,{value:"emr-serverless",label:"EMR Serverless",mdxType:"TabItem"},(0,l.yg)("p",null,"To create an EMR fabric for your serverless cluster:"),(0,l.yg)("ol",null,(0,l.yg)("li",null,"Open Prophecy and click ",(0,l.yg)("strong",null,"Create Entity")," from the left navigation menu. Then, click on the fabric tile."),(0,l.yg)("li",null,"Name your fabric and click ",(0,l.yg)("strong",null,"Continue"),"."),(0,l.yg)("li",null,"Keep the Provider Type as ",(0,l.yg)("strong",null,"Spark"),", and choose"," ",(0,l.yg)("strong",null,"EMR")," as the Provider."),(0,l.yg)("br",null),(0,l.yg)("img",{src:n(91206).A,alt:"EMR Provider",width:"75%"}),(0,l.yg)("li",null,"Enter your AWS credentials under ",(0,l.yg)("strong",null,"Access Key")," and"," ",(0,l.yg)("strong",null,"Secret Key"),". Then, enter the region that your EMR cluster is running in."),(0,l.yg)("li",null,"Click on ",(0,l.yg)("strong",null,"Fetch environments"),"."),(0,l.yg)("li",null,"Under ",(0,l.yg)("strong",null,"Spark Environment"),", select the EMR serverless cluster that you would like to connect to. From the list of active clusters, you can identify your EMR Serverless cluster by finding"," ",(0,l.yg)("code",null,"emr-serverless-services")," within the Livy URL. This will automatically populate some of the following fields."),(0,l.yg)("br",null),(0,l.yg)("img",{src:n(38571).A,alt:"EMR Serverless select",width:"80%"}),(0,l.yg)("li",null,"For the ",(0,l.yg)("strong",null,"Authentication type"),", select"," ",(0,l.yg)("code",null,"AWS Sig V4"),". This is the only option that will work for EMR Serverless."),(0,l.yg)("li",null,"Select your ",(0,l.yg)("strong",null,"Runtime Role"),". The role must have enough permissions to use the selected Serverless App."),(0,l.yg)("li",null,"Enter the S3 path that points to the location where you would like your logs and pipeline artifacts to persist."),(0,l.yg)("li",null,"Add the job size to your environment by clicking on"," ",(0,l.yg)("strong",null,"Add Job Size"),". Configure your job size and click on"," ",(0,l.yg)("strong",null,"Add"),"."),(0,l.yg)("li",null,"Note that the Spark and Scala versions are fixed."),(0,l.yg)("li",null,"Select File System under Scala Resolution mode and input"," ",(0,l.yg)("code",null,"s3://prophecy-public-bucket/prophecy-libs")),(0,l.yg)("li",null,"Select File System under Python Resolution mode and input"," ",(0,l.yg)("code",null,"s3://prophecy-public-bucket/python-prophecy-libs"))),(0,l.yg)("p",null,"Click ",(0,l.yg)("strong",null,"Complete")," to save your new EMR fabric.")),(0,l.yg)(o.A,{value:"livy",label:"Livy",mdxType:"TabItem"},(0,l.yg)("p",null,(0,l.yg)("strong",null,"Note: Livy does not work with Python version 3.8 and above."),(0,l.yg)("br",null),(0,l.yg)("br",null),"To create a Livy fabric:"),(0,l.yg)("ol",null,(0,l.yg)("li",null,"Open Prophecy and click ",(0,l.yg)("strong",null,"Create Entity")," from the left navigation menu. Then, click on the fabric tile."),(0,l.yg)("li",null,"Name your fabric and click ",(0,l.yg)("strong",null,"Continue"),"."),(0,l.yg)("li",null,"Keep the Provider Type as ",(0,l.yg)("strong",null,"Spark"),", and choose"," ",(0,l.yg)("strong",null,"Livy")," as the Provider."),(0,l.yg)("br",null),(0,l.yg)("img",{src:n(56174).A,alt:"Livy provider",width:"75%"}),(0,l.yg)("li",null,"Paste your Livy URL. You can find your Livy URL under the"," ",(0,l.yg)("strong",null,"Applications")," tab on your EMR cluster page."),(0,l.yg)("li",null,"Choose your Authentication type."),(0,l.yg)("li",null,"Click ",(0,l.yg)("strong",null,"Test Connection"),".")),(0,l.yg)("p",null,"Once your connection is tested, you'll have to configure a few more settings:"),(0,l.yg)("ol",{start:"7"},(0,l.yg)("li",null,"Fill out the Spark and Scala version based on the values found in your EMR console. Refer to"," ",(0,l.yg)("a",{href:"https://spark.apache.org/docs"},"Spark documentation")," to find the Scala version in relation to your Spark version."),(0,l.yg)("li",null,"For the Prophecy Library configurations, choose the File System Resolution mode and provide the S3 folder names for dependencies."),(0,l.yg)("br",null),(0,l.yg)("img",{src:n(88044).A,alt:"EMR create cluster",width:"75%"})),(0,l.yg)("p",null,"Click ",(0,l.yg)("strong",null,"Complete")," to save your new Livy fabric."))),(0,l.yg)("p",null,"At this point, you can test your fabric. Open a project, connect to a cluster, and try to run a pipeline!"))}d.isMDXComponent=!0},91206:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/emr-f-abric-f799ef07acc31566f38c945f82e788e7.png"},38571:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/emr-serverless-dev-select-6519ad3a861079c485acfa293c0b2cf8.png"},17589:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/emr-setup-41af69fdd1a9c4d149377d61b365bd2d.png"},88044:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/library-789a18e5a1d88023a77f94cfaf14cdb9.png"},9335:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/livy-6d54a4b67a7e5d1203f0106b8c327d44.png"},56174:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/provider-d17eb0c20095beecf6242f6b19e88c46.png"}}]);