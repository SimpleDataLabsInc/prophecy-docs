"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[8845],{15680:(e,t,a)=>{a.d(t,{xA:()=>p,yg:()=>y});var r=a(96540);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var c=r.createContext({}),l=function(e){var t=r.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(a),d=n,y=u["".concat(c,".").concat(d)]||u[d]||h[d]||i;return a?r.createElement(y,o(o({ref:t},p),{},{components:a})):r.createElement(y,o({ref:t},p))}));function y(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[u]="string"==typeof e?e:n,o[1]=s;for(var l=2;l<i;l++)o[l]=a[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},65120:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var r=a(58168),n=(a(96540),a(15680));const i={title:"Databricks OAuth",id:"databricks_oauth",description:"Prophecy Databricks OAuth integration",sidebar_position:6,tags:["authentication","databricks","oauth"]},o=void 0,s={unversionedId:"architecture/self-hosted/authentication/databricks_oauth",id:"architecture/self-hosted/authentication/databricks_oauth",title:"Databricks OAuth",description:"Prophecy Databricks OAuth integration",source:"@site/docs/architecture/self-hosted/authentication/databricks-oauth.md",sourceDirName:"architecture/self-hosted/authentication",slug:"/architecture/self-hosted/authentication/databricks_oauth",permalink:"/architecture/self-hosted/authentication/databricks_oauth",draft:!1,tags:[{label:"authentication",permalink:"/tags/authentication"},{label:"databricks",permalink:"/tags/databricks"},{label:"oauth",permalink:"/tags/oauth"}],version:"current",sidebarPosition:6,frontMatter:{title:"Databricks OAuth",id:"databricks_oauth",description:"Prophecy Databricks OAuth integration",sidebar_position:6,tags:["authentication","databricks","oauth"]},sidebar:"mySidebar",previous:{title:"SAML Using Okta",permalink:"/architecture/self-hosted/authentication/saml-okta"},next:{title:"Configurations",permalink:"/architecture/self-hosted/configurations/"}},c={},l=[{value:"OAuth use cases supported by Databricks",id:"oauth-use-cases-supported-by-databricks",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"Token storage",id:"token-storage",level:3},{value:"Pipeline and Job configuration",id:"pipeline-and-job-configuration",level:3},{value:"Project Release and Deployment",id:"project-release-and-deployment",level:3},{value:"OAuth Setup",id:"oauth-setup",level:2},{value:"Databricks Account Admin tasks",id:"databricks-account-admin-tasks",level:3},{value:"Prophecy Team Admin tasks",id:"prophecy-team-admin-tasks",level:3}],p={toc:l},u="wrapper";function h(e){let{components:t,...i}=e;return(0,n.yg)(u,(0,r.A)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,n.yg)("p",null,"Prophecy has integrated with Databricks OAuth in order to provide you with increased security via industry-standard authentication flows. This support allows for more granular access control, making it a good alternative to Personal Access Tokens (PATs)."),(0,n.yg)("h2",{id:"oauth-use-cases-supported-by-databricks"},"OAuth use cases supported by Databricks"),(0,n.yg)("p",null,"Databricks supports the following OAuth use cases:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Supports Databricks acting as the Identity Provider (IdP) or 3rd party IdPs (Okta, Entra ID, Azure AD, Ping, etc.) integrated with both Databricks and Prophecy.",(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},"Any user within your organization can use Databricks OAuth during Pipeline development and Job configuration using their own personal identity. Individual user authentication via Databricks through an IdP can be determined by your organization."))),(0,n.yg)("li",{parentName:"ul"},"Works with Spark (clusters) as well as SQL (warehouses)."),(0,n.yg)("li",{parentName:"ul"},"Works with one or more Prophecy Fabrics.",(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},"Allow users to quickly establish multiple Prophecy Fabrics, each linked to a separate Databricks schema, leveraging the same OAuth connection/tokens.")))),(0,n.yg)("h2",{id:"how-it-works"},"How it works"),(0,n.yg)("p",null,"The OAuth user authentication flow includes a three-step OAuth flow to generate tokens, using Proof Key for Code Exchange (PKCE) for enhanced security."),(0,n.yg)("p",null,"The authentication flow then uses Prophecy-hosted callback URL to capture and process authorization codes, issuing and storing access tokens."),(0,n.yg)("h3",{id:"token-storage"},"Token storage"),(0,n.yg)("p",null,"Prophecy stores the refresh token, which is used to renew the refresh token itself, and also gets a new access token to maintain authenticated connectivity to Databricks."),(0,n.yg)("p",null,"The tokens are stored securely, with access limited to authorized Prophecy processes. This includes encrypting tokens before storing them in our database, in the same way that we encrypt other credentials that Prophecy stores."),(0,n.yg)("h3",{id:"pipeline-and-job-configuration"},"Pipeline and Job configuration"),(0,n.yg)("p",null,"As mentioned previously, members of your team developing Pipelines and Jobs can leverage their own personal identity via OAuth to gain access to all Databricks resources from within Prophecy. That means that whatever permissions they have within Databricks (including permissions governed by Unity Catalog) will be enforced in Prophecy as well."),(0,n.yg)("p",null,"You will see a login overlay at the following points in Prophecy where Databricks API interactions are required:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Pipeline IDE - Select Fabric"),(0,n.yg)("li",{parentName:"ul"},"Jobs IDE - Select Fabric"),(0,n.yg)("li",{parentName:"ul"},"Jobs IDE - Setting page, in order to fetch list of users and Service Principals")),(0,n.yg)("img",{src:a(97443).A,alt:"Select a Fabric",width:"70%"}),(0,n.yg)("p",null,"To proceed through the login overlays, complete the following steps:"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"Click ",(0,n.yg)("strong",{parentName:"p"},"Continue"),". A separate browser tab opens, and Databricks redirects you to the IdP registered in Databricks.")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"Log in with the IdP (or directly with Databricks if there is no IdP). The tab closes and you can proceed with activities such as Pipeline test execution."))),(0,n.yg)("admonition",{type:"note"},(0,n.yg)("p",{parentName:"admonition"},"You only need to perform this authentication periodically, depending on the OAuth timeout settings within Databricks. Your Databricks Account Administrator can adjust the timeout setting.")),(0,n.yg)("h3",{id:"project-release-and-deployment"},"Project Release and Deployment"),(0,n.yg)("p",null,"Your Prophecy Team Admin is the only member of your team able to perform deployment of the Pipelines and jobs created by the team. Prophecy uses a Databricks Service Principal via Databricks OAuth, to perform this task on behalf of the Team Admin. The Team Admin is the only user who can use this Service Principal, and only for the purpose of deploying team projects."),(0,n.yg)("h2",{id:"oauth-setup"},"OAuth Setup"),(0,n.yg)("p",null,"The Databricks OAuth setup must be completed by both your Databricks Account Admin and your Prophecy Team Admin."),(0,n.yg)("h3",{id:"databricks-account-admin-tasks"},"Databricks Account Admin tasks"),(0,n.yg)("p",null,"Your Databricks Account Admin must complete a one-time procedure on the Databricks side to register Prophecy as an OAuth App available in your account. A registration is required for each private SaaS (on-prem) customer Databricks account."),(0,n.yg)("p",null,"As the Databricks Account Admin, complete the following steps:"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"On Databricks, navigate to ",(0,n.yg)("strong",{parentName:"p"},"Account Settings > App connections"),".")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"Create a new App connection for Prophecy. This process generates Databricks OAuth Application fields in the Prophecy side for your Prophecy Team Admin to complete.")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"Under Client ID, copy your ",(0,n.yg)("strong",{parentName:"p"},"OAuth Client ID")," for the application, and share it with your Prophecy Team Admin.")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"Under Client secret, select ",(0,n.yg)("strong",{parentName:"p"},"Generate a client secret"),". Share it with your Prophecy Team Admin.")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"Click ",(0,n.yg)("strong",{parentName:"p"},"Save"),"."))),(0,n.yg)("h3",{id:"prophecy-team-admin-tasks"},"Prophecy Team Admin tasks"),(0,n.yg)("p",null,"Your Prophecy Team Admin must paste the credentials obtained by your Databricks Account Admin into the Prophecy Admin Setting. Also, they must configure new Spark and SQL Fabrics within Prophecy with OAuth details."),(0,n.yg)("p",null,"As the Prophecy Team Admin, complete the following steps:"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"Navigate to ",(0,n.yg)("strong",{parentName:"p"},"Admin Settings"),".")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"Under ",(0,n.yg)("strong",{parentName:"p"},"Databrick OAuth Application (U2M)"),", paste the ",(0,n.yg)("strong",{parentName:"p"},"Client ID")," and the ",(0,n.yg)("strong",{parentName:"p"},"Client Secret"),"."),(0,n.yg)("img",{src:a(88042).A,alt:"Admin setting",width:"75%"})),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"When creating new Fabrics, select ",(0,n.yg)("strong",{parentName:"p"},"OAuth"),", and enter the ",(0,n.yg)("strong",{parentName:"p"},"Service Principal Client ID")," and ",(0,n.yg)("strong",{parentName:"p"},"Service Principal Client Secret"),"."),(0,n.yg)("img",{src:a(57563).A,alt:"Service Principal",width:"75%"}))))}h.isMDXComponent=!0},88042:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/data-bricks-oauth-admin-41606ebd434843adb18f01aa1317d976.png"},97443:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/data-bricks-oauth-select-fab-44a1e4746009dd36131344837268d02d.png"},57563:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/data-bricks-oauth-service-principal-baca4ddeabac94250226297c4c9683e5.png"}}]);