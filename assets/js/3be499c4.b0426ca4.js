"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[7616],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>h});var i=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=i.createContext({}),p=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return i.createElement(s.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(t),m=a,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||r;return t?i.createElement(h,o(o({ref:n},c),{},{components:t})):i.createElement(h,o({ref:n},c))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,o=new Array(r);o[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[u]="string"==typeof e?e:a,o[1]=l;for(var p=2;p<r;p++)o[p]=t[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"},95516:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var i=t(87462),a=(t(67294),t(3905));const r={title:"SAML Using AzureAD with SCIM",id:"azuread_scim",description:"SAML authentication using AzureAD with SCIM",sidebar_position:2,tags:["authentication","saml","azuread","scim"]},o=void 0,l={unversionedId:"architecture/authentication/azuread_scim",id:"architecture/authentication/azuread_scim",title:"SAML Using AzureAD with SCIM",description:"SAML authentication using AzureAD with SCIM",source:"@site/docs/architecture/authentication/azuread-scim.md",sourceDirName:"architecture/authentication",slug:"/architecture/authentication/azuread_scim",permalink:"/architecture/authentication/azuread_scim",draft:!1,tags:[{label:"authentication",permalink:"/tags/authentication"},{label:"saml",permalink:"/tags/saml"},{label:"azuread",permalink:"/tags/azuread"},{label:"scim",permalink:"/tags/scim"}],version:"current",sidebarPosition:2,frontMatter:{title:"SAML Using AzureAD with SCIM",id:"azuread_scim",description:"SAML authentication using AzureAD with SCIM",sidebar_position:2,tags:["authentication","saml","azuread","scim"]},sidebar:"defaultSidebar",previous:{title:"Azure Active Directory",permalink:"/architecture/authentication/azure_ad"},next:{title:"SAML Using Okta",permalink:"/architecture/authentication/saml_okta"}},s={},p=[{value:"Configure AzureAD",id:"configure-azuread",level:2},{value:"Configure Prophecy to connect to Azure AD",id:"configure-prophecy-to-connect-to-azure-ad",level:2},{value:"Assigning Users/Groups to Prophecy in Azure AD",id:"assigning-usersgroups-to-prophecy-in-azure-ad",level:2},{value:"Sync Users and Groups from Azure AD using SCIM",id:"sync-users-and-groups-from-azure-ad-using-scim",level:2},{value:"About SCIM provisioning in Prophecy",id:"about-scim-provisioning-in-prophecy",level:3},{value:"Requirements",id:"requirements",level:4},{value:"Enable SCIM Provisioning for <em>Prophecy Enterprise App</em> in AzureAD",id:"enable-scim-provisioning-for-prophecy-enterprise-app-in-azuread",level:3}],c={toc:p},u="wrapper";function d(e){let{components:n,...r}=e;return(0,a.kt)(u,(0,i.Z)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Single sign-on (SSO) enables you to authenticate your users using your organization\u2019s identity provider.\nThis document focuses on using AzureAD as SAML IdP for Prophecy and enabling SCIM provisioning for syncing users and\ngroups."),(0,a.kt)("h2",{id:"configure-azuread"},"Configure AzureAD"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Log into AzureAD as an administrator and create a new Enterprise Application say ",(0,a.kt)("inlineCode",{parentName:"li"},"ProphecyAzureADApp"),"."),(0,a.kt)("li",{parentName:"ol"},"In the home page search bar, search for ",(0,a.kt)("inlineCode",{parentName:"li"},"Enterprise Applications")),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"New Application")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"Create your own application")),(0,a.kt)("li",{parentName:"ol"},"Give name for the application say ",(0,a.kt)("inlineCode",{parentName:"li"},"ProphecyAzureADApp"),", choose the radio button which says ",(0,a.kt)("inlineCode",{parentName:"li"},"Integrate any other application you don't find in the gallery (Non-gallery)"),", and then click on ",(0,a.kt)("inlineCode",{parentName:"li"},"Create")," button."),(0,a.kt)("li",{parentName:"ol"},"In Manage section on the left, click ",(0,a.kt)("inlineCode",{parentName:"li"},"Single sign-on")),(0,a.kt)("li",{parentName:"ol"},"Choose ",(0,a.kt)("inlineCode",{parentName:"li"},"SAML")," as the Single sign-on method"),(0,a.kt)("li",{parentName:"ol"},"Now the form for ",(0,a.kt)("inlineCode",{parentName:"li"},"Set up Single Sign-On with SAML")," will open which will have various sections as mentioned below:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"In ",(0,a.kt)("inlineCode",{parentName:"li"},"Basic SAML Configuration")," section, provide ",(0,a.kt)("inlineCode",{parentName:"li"},"Identifier (Entity ID)")," which is a unique ID to identify this application to Azure Active Directory say ",(0,a.kt)("inlineCode",{parentName:"li"},"prophecyWithSamlEntity"),"."),(0,a.kt)("li",{parentName:"ul"},"In the same section, configure ",(0,a.kt)("inlineCode",{parentName:"li"},"Reply URL")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"Sign on URL")," with same values: ",(0,a.kt)("inlineCode",{parentName:"li"},"https://your-prophecy-ide-url.domain/api/oauth/samlCallback"),". Then click on Save."),(0,a.kt)("li",{parentName:"ul"},"In ",(0,a.kt)("inlineCode",{parentName:"li"},"Attributes & Claims")," section, click Edit button and then ",(0,a.kt)("inlineCode",{parentName:"li"},"Add new claim"),". Give ",(0,a.kt)("inlineCode",{parentName:"li"},"Name")," as ",(0,a.kt)("inlineCode",{parentName:"li"},"email")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"Source Attribute")," as ",(0,a.kt)("inlineCode",{parentName:"li"},"user.userprincipalname"),", and click Save."),(0,a.kt)("li",{parentName:"ul"},"Similarly, add one more claim by clicking on ",(0,a.kt)("inlineCode",{parentName:"li"},"Add new claim"),". Give ",(0,a.kt)("inlineCode",{parentName:"li"},"Name")," as ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"Source Attribute")," as ",(0,a.kt)("inlineCode",{parentName:"li"},"user.givenname"),", and click Save and go back to the page with ",(0,a.kt)("inlineCode",{parentName:"li"},"Set up Single Sign-On with SAML")," form."),(0,a.kt)("li",{parentName:"ul"},"From ",(0,a.kt)("inlineCode",{parentName:"li"},"SAML certificates")," section, download ",(0,a.kt)("inlineCode",{parentName:"li"},"Certificate (Base64)")," file to be used while configuring SSO in Prophecy UI."),(0,a.kt)("li",{parentName:"ul"},"From ",(0,a.kt)("inlineCode",{parentName:"li"},"Set up ProphecyAzureADApp")," section, copy ",(0,a.kt)("inlineCode",{parentName:"li"},"Login URL")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"Azure AD Identifier")," to be used while configuring SSO in Prophecy UI."))),(0,a.kt)("li",{parentName:"ol"},"Before configuring rest of the sections like ",(0,a.kt)("inlineCode",{parentName:"li"},"Users and groups")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"Provisioning")," in this Enterprise Application, lets configure SSO in Prophecy UI and get the SCIM token.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"AzureAD config example",src:t(36395).Z,width:"674",height:"679"})),(0,a.kt)("h2",{id:"configure-prophecy-to-connect-to-azure-ad"},"Configure Prophecy to connect to Azure AD"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Login to Prophecy IDE as an admin user"),(0,a.kt)("li",{parentName:"ol"},"Go to settings and SSO tab which will show ",(0,a.kt)("inlineCode",{parentName:"li"},"Authentication Provider")," as ",(0,a.kt)("inlineCode",{parentName:"li"},"ProphecyManaged"))),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"SSO Settings",src:t(63458).Z,width:"2780",height:"1282"})),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"Fill in ",(0,a.kt)("inlineCode",{parentName:"li"},"Organization ID")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"Team Name")," that you want to set for your organization and team respectively. Make sure both these fields are of the regex ",(0,a.kt)("inlineCode",{parentName:"li"},"[a-zA-z0-9]*")," and have no spaces or special characters."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Configure")," and this will generate a SCIM Token. Make a note of this token which needs to be filled later while Provisioning SCIM in AzureAD. Also, now the Authentication Provider should show as ",(0,a.kt)("inlineCode",{parentName:"li"},"SAML"),".")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"SSO Settings With SCIM token",src:t(76522).Z,width:"2770",height:"1274"})),(0,a.kt)("ol",{start:5},(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Save"),"."),(0,a.kt)("li",{parentName:"ol"},"Choose IDP as ",(0,a.kt)("inlineCode",{parentName:"li"},"Azure Active Directory")," from the drop-down."),(0,a.kt)("li",{parentName:"ol"},"Fill in ",(0,a.kt)("inlineCode",{parentName:"li"},"SSO URL")," as the Login URL you copied from Azure AD application in step 7 of above section."),(0,a.kt)("li",{parentName:"ol"},"Upload the Base64 certificate downloaded from Azure AD application in step 7 of above section."),(0,a.kt)("li",{parentName:"ol"},"Fill in ",(0,a.kt)("inlineCode",{parentName:"li"},"Entity issuer")," as ",(0,a.kt)("inlineCode",{parentName:"li"},"Identifier (Entity ID)")," you chose in Azure AD application in step 7 to identify it to Azure Active Directory. Identifier as per this documentation example will be ",(0,a.kt)("inlineCode",{parentName:"li"},"prophecyWithSamlEntity"),"."),(0,a.kt)("li",{parentName:"ol"},"Fill in ",(0,a.kt)("inlineCode",{parentName:"li"},"SSO issuer")," as ",(0,a.kt)("inlineCode",{parentName:"li"},"Azure AD Identifier")," you copied from Azure AD application in step 7 of above section."),(0,a.kt)("li",{parentName:"ol"},"Once SCIM Provisioning is enabled for the ",(0,a.kt)("em",{parentName:"li"},"Prophecy Enterprise app")," in Azure AD and users/groups are assigned to it, you can logout from Prophecy IDE and the assigned users will be able to login to Prophecy IDE via AzureAD.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"SSO Detailed Settings for AzureAD",src:t(95926).Z,width:"720",height:"585"})),(0,a.kt)("h2",{id:"assigning-usersgroups-to-prophecy-in-azure-ad"},"Assigning Users/Groups to Prophecy in Azure AD"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Go to ",(0,a.kt)("inlineCode",{parentName:"li"},"Users and Groups")," tab in ",(0,a.kt)("inlineCode",{parentName:"li"},"Manage")," section of ",(0,a.kt)("em",{parentName:"li"},"Prophecy Enterprise App")," in Azure AD"),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Add user/group")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"Users/Groups None Selected"),". Search for your users/groups and assign them to Prophecy app.")),(0,a.kt)("p",null,"Note: To be able to assign groups to an Enterprise Application in Azure, make sure your plan should be ",(0,a.kt)("inlineCode",{parentName:"p"},"Azure AD Premium P2"),"."),(0,a.kt)("h2",{id:"sync-users-and-groups-from-azure-ad-using-scim"},"Sync Users and Groups from Azure AD using SCIM"),(0,a.kt)("p",null,"This section describes how to configure your Azure AD and Prophecy to provision users and groups to Prophecy using SCIM,\nor System for Cross-domain Identity Management, an open standard that allows you to automate user provisioning."),(0,a.kt)("h3",{id:"about-scim-provisioning-in-prophecy"},"About SCIM provisioning in Prophecy"),(0,a.kt)("p",null,"Prophecy provides a SCIM connector that lets you use Azure AD to create/update users and groups/teams in Prophecy, give them the proper level of access,\nand remove access (de-provision them) when they leave your organization or no longer need access to Prophecy."),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"Prophecy Enterprise App")," in Azure AD must be assigned to users/groups in AzureAD for the SCIM connector to be triggered and\ncreate corresponding users in Prophecy."),(0,a.kt)("p",null,"Note:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Importing user/groups from AzureAD to Prophecy is supported but not vice-versa i.e. any changes made to a synced user in\nProphecy IDE will not be synced back to AzureAD and will get overwritten whenever any update to user is synced from AzureAD."),(0,a.kt)("li",{parentName:"ul"},"Any changes to user/groups in AzureAD are not immediately synced from AzureAD to Prophecy and get reflected in next synchronization cycle. If you want the changes to immediately reflect in Prophecy,\nyou need to go to ",(0,a.kt)("inlineCode",{parentName:"li"},"Provisioning")," section of ",(0,a.kt)("em",{parentName:"li"},"Prophecy Enterprise App")," and click ",(0,a.kt)("inlineCode",{parentName:"li"},"Provision on Demand"),"."),(0,a.kt)("li",{parentName:"ul"},"Updates to primary email is not supported in Prophecy via SCIM."),(0,a.kt)("li",{parentName:"ul"},"Login via secondary emails registered with AzureAD is not supported in Prophecy."),(0,a.kt)("li",{parentName:"ul"},"De-provisioning of a user from Azure deletes that user from Prophecy and not deactivates it. As a result, a\nde-provisioned user will lose their personal projects in Prophecy.")),(0,a.kt)("h4",{id:"requirements"},"Requirements"),(0,a.kt)("p",null,"To provision users/groups to your Prophecy account using SCIM,"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"you must be AzureAD admin"),(0,a.kt)("li",{parentName:"ul"},"you must be a Prophecy account admin.")),(0,a.kt)("h3",{id:"enable-scim-provisioning-for-prophecy-enterprise-app-in-azuread"},"Enable SCIM Provisioning for ",(0,a.kt)("em",{parentName:"h3"},"Prophecy Enterprise App")," in AzureAD"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Go to ",(0,a.kt)("inlineCode",{parentName:"li"},"Provisioning")," tab in ",(0,a.kt)("inlineCode",{parentName:"li"},"Manage")," section of ",(0,a.kt)("em",{parentName:"li"},"Prophecy Enterprise App")," in Azure AD and click on ",(0,a.kt)("inlineCode",{parentName:"li"},"Get Started"),"."),(0,a.kt)("li",{parentName:"ul"},"Choose the ",(0,a.kt)("inlineCode",{parentName:"li"},"Provisioning Mode")," to be ",(0,a.kt)("inlineCode",{parentName:"li"},"Automatic")," from the drop down."),(0,a.kt)("li",{parentName:"ul"},"In ",(0,a.kt)("inlineCode",{parentName:"li"},"Admin Credentials"),", provide the ",(0,a.kt)("inlineCode",{parentName:"li"},"Tenant URL")," as ",(0,a.kt)("inlineCode",{parentName:"li"},"https://your-prophecy-ide-url.domain/proscim")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"Secret Token")," as the ",(0,a.kt)("inlineCode",{parentName:"li"},"SCIM token")," copied from Prophecy IDE."),(0,a.kt)("li",{parentName:"ul"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Test Connection")," to check the connectivity with Prophecy's SCIM connector."),(0,a.kt)("li",{parentName:"ul"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Save"),"."),(0,a.kt)("li",{parentName:"ul"},"User Provisioning doesn't start automatically. You need to go back to ",(0,a.kt)("inlineCode",{parentName:"li"},"Provisioning")," section of the app and click on ",(0,a.kt)("inlineCode",{parentName:"li"},"Start Provisioning"),".")))}d.isMDXComponent=!0},36395:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azure_enterpriseapp_sso-3d4936d29f9ecbe90eb9228ca6bfa896.png"},63458:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/sso_settings-62ba5ad052ba828f7a54e744aca56185.png"},95926:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/sso_settings_detailed_azuread-f445eb479065ae18fa43e5920c81739a.png"},76522:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/sso_settings_with_token-f630a2a7a200a1985f487657cf3c0af1.png"}}]);