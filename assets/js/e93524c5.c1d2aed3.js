"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[46059],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var r=i(96540);const t={},s=r.createContext(t);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(s.Provider,{value:n},e.children)}},49051:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"administration/fabrics/prophecy-fabrics/knowledge-graph-config","title":"Knowledge graph indexer","description":"Configure automated knowledge graph indexing for Prophecy fabrics","source":"@site/docs/administration/fabrics/prophecy-fabrics/knowledge-graph.md","sourceDirName":"administration/fabrics/prophecy-fabrics","slug":"/administration/fabrics/prophecy-fabrics/knowledge-graph-config","permalink":"/administration/fabrics/prophecy-fabrics/knowledge-graph-config","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"agents","permalink":"/tags/agents"},{"inline":true,"label":"knowledge graph","permalink":"/tags/knowledge-graph"}],"version":"current","frontMatter":{"title":"Knowledge graph indexer","id":"knowledge-graph-config","description":"Configure automated knowledge graph indexing for Prophecy fabrics","tags":["agents","knowledge graph"]},"sidebar":"platformSidebar","previous":{"title":"Prophecy secrets","permalink":"/analysts/secrets"},"next":{"title":"Pipeline development","permalink":"/analysts/pipeline-development"}}');var t=i(74848),s=i(28453);const o={title:"Knowledge graph indexer",id:"knowledge-graph-config",description:"Configure automated knowledge graph indexing for Prophecy fabrics",tags:["agents","knowledge graph"]},a=void 0,l={},d=[{value:"How indexing works",id:"how-indexing-works",level:2},{value:"Configure automatic indexing",id:"configure-automatic-indexing",level:2},{value:"Manually trigger indexing",id:"manually-trigger-indexing",level:2},{value:"Add separate authentication for the indexer",id:"add-separate-authentication-for-the-indexer",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Procedure",id:"procedure",level:3},{value:"Service Principal OAuth (recommended)",id:"service-principal-oauth-recommended",level:4},{value:"User OAuth",id:"user-oauth",level:4}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.a,{href:"/knowledge-graph",children:"knowledge graph"})," is an internal index that maps your data environment. Prophecy uses knowledge graphs to help AI agents understand your ",(0,t.jsx)(n.a,{href:"/administration/fabrics/prophecy-fabrics/#fabric-architecture",children:"SQL warehouse structure"}),". The knowledge graph contains metadata about tables, schemas, columns, and data types\u2014not your actual data."]}),"\n",(0,t.jsx)(n.p,{children:"When you interact with AI agents, Prophecy uses the knowledge graph to add context to your prompts. This context helps AI agents generate accurate SQL code that references the correct tables and columns in your warehouse."}),"\n",(0,t.jsx)(n.p,{children:"Prophecy automatically indexes your data environment when you create a fabric. Afterword, you need to schedule the indexer to run automatically or manually trigger it."}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"Prophecy only indexes tables from your SQL warehouse connection. Datasets from data ingress/egress connections are not included in the knowledge graph."})}),"\n",(0,t.jsx)(n.h2,{id:"how-indexing-works",children:"How indexing works"}),"\n",(0,t.jsx)(n.p,{children:"When triggered, the knowledge graph indexer:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Connects to your SQL warehouse using configured credentials."}),"\n",(0,t.jsx)(n.li,{children:"Scans catalogs and schemas that the identity has access to in your warehouse connection."}),"\n",(0,t.jsx)(n.li,{children:"Indexes table names, schemas, column names, data types, and other metadata."}),"\n",(0,t.jsx)(n.li,{children:"Updates the knowledge graph with this information."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configure-automatic-indexing",children:"Configure automatic indexing"}),"\n",(0,t.jsx)(n.p,{children:"Configure scheduled crawling to keep your index up-to-date without manual intervention."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In Prophecy, navigate to ",(0,t.jsx)(n.strong,{children:"Metadata > Fabrics"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Select the fabric where you will enable indexing."}),"\n",(0,t.jsxs)(n.li,{children:["Open the ",(0,t.jsx)(n.strong,{children:"Connections"})," tab."]}),"\n",(0,t.jsxs)(n.li,{children:["Click the pencil icon to edit the ",(0,t.jsx)(n.strong,{children:"SQL Warehouse Connection"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["In the connection dialog, scroll to the ",(0,t.jsx)(n.strong,{children:"Knowledge Graph Indexer"})," tile and toggle on ",(0,t.jsx)(n.strong,{children:"Enable Knowledge Graph Periodic Indexing"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Configure the schedule to run hourly, daily, or weekly."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The schedule must have a defined frequency and timezone. The default timezone is the timezone from where you access Prophecy."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Hourly"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Default"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Repeat every ... from"}),(0,t.jsxs)(n.td,{children:["The interval in hours between pipeline runs, starting at a specific time.",(0,t.jsx)("br",{}),"Example: Repeat every 2 hours from 12:00 AM."]}),(0,t.jsxs)(n.td,{children:["Every 1 hour",(0,t.jsx)("br",{}),"starting at 2:00 AM"]})]})})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Daily"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Default"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Repeat at"}),(0,t.jsxs)(n.td,{children:["The time of day when the schedule will run.",(0,t.jsx)("br",{}),"Example: Repeat at 9:00 AM"]}),(0,t.jsx)(n.td,{children:"2:00 AM"})]})})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Weekly"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Default"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Repeat on"}),(0,t.jsxs)(n.td,{children:["The day(s) of the week that the pipeline will run.",(0,t.jsx)("br",{}),"Example: Repeat on Monday, Wednesday, Friday"]}),(0,t.jsx)(n.td,{children:"Sunday"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Repeat at"}),(0,t.jsxs)(n.td,{children:["The time of the day that the pipeline will run.",(0,t.jsx)("br",{}),"Example: Repeat at 9:00 AM"]}),(0,t.jsx)(n.td,{children:"2:00 AM"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"manually-trigger-indexing",children:"Manually trigger indexing"}),"\n",(0,t.jsx)(n.p,{children:"You may need to manually trigger indexing if you know that certain tables are missing from the knowledge graph. To do so:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In Prophecy, navigate to ",(0,t.jsx)(n.strong,{children:"Metadata > Fabrics"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Select the fabric where you will enable indexing."}),"\n",(0,t.jsxs)(n.li,{children:["Open the ",(0,t.jsx)(n.strong,{children:"Connections"})," tab."]}),"\n",(0,t.jsxs)(n.li,{children:["Click the pencil icon to edit the ",(0,t.jsx)(n.strong,{children:"SQL Warehouse Connection"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Scroll to the ",(0,t.jsx)(n.strong,{children:"Knowledge Graph Indexing Status"})," tile in the connection dialog."]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Start"})," to reindex the tables and track its progress. You'll be able to view the progress of processed schemas and directories."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["If more convenient, you can also start this process from the ",(0,t.jsx)(n.a,{href:"/analysts/connections#environment-browser",children:"Environment tab"})," in your project:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Open a project in the project editor."}),"\n",(0,t.jsx)(n.li,{children:"Attach to the fabric that you wish to reindex."}),"\n",(0,t.jsx)(n.li,{children:"In the left sidebar, open the Environment tab."}),"\n",(0,t.jsxs)(n.li,{children:["Below your connections, you\u2019ll see a ",(0,t.jsx)(n.strong,{children:"Missing Tables?"})," callout."]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Refresh"})," to reindex the SQL warehouse."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["You might be prompted to manually trigger indexing if the ",(0,t.jsx)(n.a,{href:"/analysts/ai-explore#troubleshooting",children:"agent"})," can\u2019t locate a table during a conversation."]})}),"\n",(0,t.jsx)(n.h2,{id:"add-separate-authentication-for-the-indexer",children:"Add separate authentication for the indexer"}),"\n",(0,t.jsx)(n.p,{children:"Prophecy lets you configure authentication credentials for the knowledge graph indexer separately from pipeline execution credentials, allowing you to control which tables get indexed and how results are scoped for different users."}),"\n",(0,t.jsx)(n.p,{children:"This means there are two types of credentials stored in a connection:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pipeline Development and Scheduled Execution"})," credentials control how pipelines authenticate when they run."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Knowledge Graph Indexer"})," credentials control how the crawler authenticates when it indexes your warehouse on an automated schedule."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If you don't add separate authentication for the indexer, it will use the pipeline development credentials when running."}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["The knowledge graph indexer always uses the same identity as the pipeline development identity if the pipeline development authentication strategy is ",(0,t.jsx)(n.a,{href:"/administration/fabrics/prophecy-fabrics/connections/databricks#personal-access-token-pat",children:"Personal Access Token"})," (rather than OAuth). This section is not applicable if you use the PAT authentication method."]})}),"\n",(0,t.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"Before configuring dedicated credentials for the knowledge graph indexer, you must:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Upgrade to Prophecy 4.2.2 or later."}),"\n",(0,t.jsxs)(n.li,{children:["Configure your SQL warehouse connection with a ",(0,t.jsx)(n.a,{href:"/administration/fabrics/prophecy-fabrics/connections/databricks",children:"Databricks connection"}),". Other SQL warehouses are not supported."]}),"\n",(0,t.jsx)(n.li,{children:"Be a Prophecy administrator. Though there are no role-based restrictions for configuring the knowledge graph indexer, you need to understand how authentication works in Prophecy."}),"\n",(0,t.jsxs)(n.li,{children:["Be a Databricks administrator. This lets you assign appropriate permissions to the identity that will be used to run the indexer. The identity must have ",(0,t.jsx)(n.code,{children:"MANAGE"})," access on the assets that you wish to index in the knowledge graph."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"The knowledge graph indexing permissions should be equal to or a superset of the pipeline execution permissions. This ensures that the same tables you use in your pipelines are indexed by the knowledge graph. However, Prophecy does not enforce this."})}),"\n",(0,t.jsx)(n.h3,{id:"procedure",children:"Procedure"}),"\n",(0,t.jsx)(n.p,{children:"To configure the knowledge graph indexer for a fabric:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["In Prophecy, navigate to ",(0,t.jsx)(n.strong,{children:"Metadata > Fabrics"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Select the fabric where you will enable indexing."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Open the ",(0,t.jsx)(n.strong,{children:"Connections"})," tab."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Click the pencil icon to edit the ",(0,t.jsx)(n.strong,{children:"SQL Warehouse Connection"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["In the dialog, scroll to the ",(0,t.jsx)(n.strong,{children:"Knowledge Graph Indexer"})," tile."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Configure authentication based on your pipeline development authentication method:"}),"\n",(0,t.jsxs)(n.p,{children:["If you use User OAuth for ",(0,t.jsx)(n.strong,{children:"pipeline development:"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Choose either OAuth (User) or OAuth (Service Principal) for the knowledge graph indexer."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["If you use Service Principal OAuth for ",(0,t.jsx)(n.strong,{children:"pipeline development:"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"You can only use Service Principal OAuth for the knowledge graph indexer."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"service-principal-oauth-recommended",children:"Service Principal OAuth (recommended)"}),"\n",(0,t.jsx)(n.p,{children:"Recommended for production and scheduled indexing. Credentials don't expire."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Configuration"}),": Reuse pipeline development credentials or provide a different ",(0,t.jsx)(n.strong,{children:"Service Principal Client ID"})," and ",(0,t.jsx)(n.strong,{children:"Client Secret"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"What gets indexed"}),": All tables that the service principal can access."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["If you use ",(0,t.jsx)(n.strong,{children:"User OAuth"})," for pipeline development, Prophecy enforces user permissions even when the indexer uses service principal credentials. Users only see tables they have permission to access."]})}),"\n",(0,t.jsx)(n.h4,{id:"user-oauth",children:"User OAuth"}),"\n",(0,t.jsx)(n.p,{children:"User OAuth should only be used for development."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Configuration"}),": Uses the same app registration as pipeline development."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"What gets indexed"}),": All tables that the individual user can access."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Limitations"}),": Requires frequent user logins. Scheduled crawling can fail when user credentials expire."]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);