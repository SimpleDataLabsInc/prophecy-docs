"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[22499],{28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var t=s(96540);const i={},r=t.createContext(i);function c(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(r.Provider,{value:n},e.children)}},61756:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"administration/fabrics/prophecy-fabrics/connections/databricks","title":"Databricks connection","description":"Learn how to connect with Databricks","source":"@site/docs/administration/fabrics/prophecy-fabrics/connections/databricks.md","sourceDirName":"administration/fabrics/prophecy-fabrics/connections","slug":"/administration/fabrics/prophecy-fabrics/connections/databricks","permalink":"/administration/fabrics/prophecy-fabrics/connections/databricks","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"connections","permalink":"/tags/connections"},{"inline":true,"label":"sql","permalink":"/tags/sql"},{"inline":true,"label":"databricks","permalink":"/tags/databricks"}],"version":"current","frontMatter":{"title":"Databricks connection","sidebar_label":"Databricks","id":"databricks","description":"Learn how to connect with Databricks","tags":["connections","sql","databricks"]},"sidebar":"platformSidebar","previous":{"title":"Azure Synapse","permalink":"/administration/fabrics/prophecy-fabrics/connections/synapse"},"next":{"title":"Google BigQuery","permalink":"/administration/fabrics/prophecy-fabrics/connections/bigquery"}}');var i=s(74848),r=s(28453);const c={title:"Databricks connection",sidebar_label:"Databricks",id:"databricks",description:"Learn how to connect with Databricks",tags:["connections","sql","databricks"]},a=void 0,o={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Connection type",id:"connection-type",level:2},{value:"Feature support",id:"feature-support",level:2},{value:"Connection parameters",id:"connection-parameters",level:2},{value:"Authentication methods",id:"authentication-methods",level:2},{value:"OAuth",id:"oauth",level:3},{value:"Personal Access Token (PAT)",id:"personal-access-token-pat",level:3},{value:"Data type mapping",id:"data-type-mapping",level:2},{value:"Fetching data",id:"fetching-data",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This page explains how to use and configure a Databricks connection in Prophecy. A Databricks connection allows Prophecy to access files, tables, and compute resources in your Databricks workspace. You can use the same connection to access any of these resources, as long as the authenticated account in the connection has the appropriate permissions."}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Prophecy connects to Databricks using the credentials you provide. These credentials are used to authenticate your session and authorize all data operations during pipeline execution, including reading from and writing to tables. To use a Databricks connection effectively, your user or service principal must have the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://docs.databricks.com/aws/en/tables/#basic-table-permissions",children:"Basic table permissions"})," defined in the Databricks documentation."]}),"\n",(0,i.jsxs)(n.li,{children:["Additional ",(0,i.jsx)(n.a,{href:"https://docs.databricks.com/aws/en/data-governance/unity-catalog/manage-privileges/privileges",children:"Unity Catalog privileges"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CREATE VOLUME"})," for permission to create the ",(0,i.jsx)(n.code,{children:"PROPHECY_ORCHESTRATOR_VOLUME"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"READ VOLUME"})," for the path ",(0,i.jsx)(n.code,{children:"/Volumes/<catalog>/<schema>/PROPHECY_ORCHESTRATOR_VOLUME"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WRITE VOLUME"})," for permission to delete intermediate files from the volume"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"connection-type",children:"Connection type"}),"\n",(0,i.jsxs)(n.p,{children:["Prophecy supports Databricks as both a SQL Warehouse connection and an Ingress/Egress connection. To learn more about these different connection types, visit ",(0,i.jsx)(n.a,{href:"/administration/fabrics/prophecy-fabrics/create-fabric#connections",children:"Prophecy fabrics"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"feature-support",children:"Feature support"}),"\n",(0,i.jsx)(n.p,{children:"The table below outlines whether the connection supports certain Prophecy features."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"Supported"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Run SQL queries"}),(0,i.jsx)(n.td,{children:"Yes \u2014 SQL Warehouse Connection only"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Read and write data with a ",(0,i.jsx)(n.a,{href:"/analysts/databricks-table",children:"Table gem"})]}),(0,i.jsx)(n.td,{children:"Yes \u2014 SQL Warehouse Connection only"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Read data with a ",(0,i.jsx)(n.a,{href:"/analysts/databricks",children:"Source gem"})]}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Write data with a ",(0,i.jsx)(n.a,{href:"/analysts/databricks",children:"Target gem"})]}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Browse data in the ",(0,i.jsx)(n.a,{href:"/analysts/project-editor#sidebar",children:"Environment browser"})]}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Index tables in the ",(0,i.jsx)(n.a,{href:"/knowledge-graph",children:"Knowledge Graph"})]}),(0,i.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"connection-parameters",children:"Connection parameters"}),"\n",(0,i.jsx)(n.p,{children:"To create a connection with Databricks, enter the following parameters."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Connection Name"}),(0,i.jsx)(n.td,{children:"Name to identify your connection."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"JDBC URL"}),(0,i.jsxs)(n.td,{children:["URL to connect to your SQL warehouse. For example: ",(0,i.jsx)(n.code,{children:"jdbc:databricks://<databricks-instance>:443/default;transportMode=http;ssl=1;AuthMech=3;httpPath=/sql/1.0/warehouses/<warehouse-id>"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Catalog"}),(0,i.jsx)(n.td,{children:"Default write location for target tables."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Schema"}),(0,i.jsx)(n.td,{children:"Default write location for target tables."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Authentication method"}),(0,i.jsxs)(n.td,{children:["How you want to authenticate your Databricks account. Learn more in ",(0,i.jsx)(n.a,{href:"#authentication-methods",children:"Authentication methods"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Select a cluster to run the script on"}),(0,i.jsxs)(n.td,{children:["Cluster where ",(0,i.jsx)(n.a,{href:"/analysts/script",children:"Script gems"})," run. Specify a cluster if you want to install libraries on your cluster to use in your scripts.",(0,i.jsx)("br",{}),"The dropdown will only display running clusters (inactive clusters will not appear). ",(0,i.jsx)("br",{}),"If not specified, Script gems run on Databricks Serverless."]})]})]})]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["When you use Databricks as your primary SQL warehouse, Prophecy also uses the catalog and schema you define in the connection to store temporary tables during ",(0,i.jsx)(n.a,{href:"/analysts/pipeline-execution#external-data-handling",children:"pipeline execution"}),". Therefore, you must have write access to the schema in Databricks. To avoid conflicts, define distinct catalog and schema locations for each fabric."]})}),"\n",(0,i.jsx)(n.h2,{id:"authentication-methods",children:"Authentication methods"}),"\n",(0,i.jsx)(n.p,{children:"You can configure your Databricks connection using the following authentication methods."}),"\n",(0,i.jsx)(n.h3,{id:"oauth",children:"OAuth"}),"\n",(0,i.jsx)(n.p,{children:"When you select OAuth as your authentication method for the connection, Prophecy can authenticate using either user-based (U2M) or service principal-based (M2M) OAuth. A single fabric cannot use both methods for the same connection. To use both U2M and M2M, create separate fabrics."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"OAuth Type"}),(0,i.jsx)(n.th,{children:"Authentication"}),(0,i.jsx)(n.th,{children:"Requirements"}),(0,i.jsx)(n.th,{children:"Token Expiry"}),(0,i.jsx)(n.th,{children:"Best For"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"User-based (U2M)"})}),(0,i.jsx)(n.td,{children:"Individual user accounts"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/oauth-setup",children:"App Registration"})}),(0,i.jsx)(n.td,{children:"Periodic re-authentication required"}),(0,i.jsx)(n.td,{children:"Interactive development"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Service Principal (M2M)"})}),(0,i.jsx)(n.td,{children:"Service principal credentials"}),(0,i.jsx)(n.td,{children:"Service Principal Client ID and Service Principal Client Secret"}),(0,i.jsx)(n.td,{children:"No expiration"}),(0,i.jsx)(n.td,{children:"Scheduled jobs, automation"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"You can schedule pipelines with user-based OAuth, but you\u2019ll need to re-authenticate periodically. Prophecy estimates token expiry based on Databricks\u2019 response and prompts you when re-authentication is needed. To avoid interruptions, switch to service principal-based OAuth for production workloads."}),"\n",(0,i.jsx)(n.p,{children:"Use different fabrics for development and production to align authentication with your environment\u2019s needs."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Environment"}),(0,i.jsx)(n.th,{children:"OAuth Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Development"})}),(0,i.jsx)(n.td,{children:"User-based (U2M)"}),(0,i.jsx)(n.td,{children:"Developers log in with personal Databricks accounts. Reflects individual permissions and enhances security through regular re-authentication."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Production"})}),(0,i.jsx)(n.td,{children:"Service Principal (M2M)"}),(0,i.jsx)(n.td,{children:"Pipelines run under a shared service principal for continuous, unattended operation. Access should be restricted to trusted users since credentials are shared."})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"personal-access-token-pat",children:"Personal Access Token (PAT)"}),"\n",(0,i.jsxs)(n.p,{children:["When you choose ",(0,i.jsx)(n.strong,{children:"Personal Access Token"})," (PAT) for the authentication method, you'll authenticate using a ",(0,i.jsx)(n.a,{href:"https://docs.databricks.com/aws/en/dev-tools/auth/pat",children:"Databricks personal access token"}),". When you set up the connection, you will use a ",(0,i.jsx)(n.a,{href:"/analysts/secrets",children:"secret"})," to enter your PAT."]}),"\n",(0,i.jsx)(n.p,{children:"Using the PAT authentication method:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All team members who have access to the fabric can use the connection in their projects."}),"\n",(0,i.jsx)(n.li,{children:"No additional authentication is required. Team members automatically inherit the access and permissions of the stored connection credentials."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"data-type-mapping",children:"Data type mapping"}),"\n",(0,i.jsx)(n.p,{children:"When Prophecy processes data from Databricks using an external SQL warehouse, it converts Databricks data types to compatible types."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Databricks"}),(0,i.jsx)(n.th,{children:"BigQuery"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"INT"}),(0,i.jsxs)(n.td,{children:["INT64",(0,i.jsx)("br",{}),"Alias: Integer"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TINYINT"}),(0,i.jsxs)(n.td,{children:["INT64",(0,i.jsx)("br",{}),"Alias: Integer"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SMALLINT"}),(0,i.jsxs)(n.td,{children:["INT64",(0,i.jsx)("br",{}),"Alias: Integer"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"BIGINT"}),(0,i.jsxs)(n.td,{children:["INT64",(0,i.jsx)("br",{}),"Alias: Integer"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"STRING"}),(0,i.jsxs)(n.td,{children:["STRING",(0,i.jsx)("br",{}),"Alias: String"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"BOOLEAN"}),(0,i.jsxs)(n.td,{children:["BOOL",(0,i.jsx)("br",{}),"Alias: Boolean"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DECIMAL"}),(0,i.jsxs)(n.td,{children:["NUMERIC",(0,i.jsx)("br",{}),"Alias: Numeric"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"FLOAT"}),(0,i.jsxs)(n.td,{children:["FLOAT64",(0,i.jsx)("br",{}),"Alias: Float"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DOUBLE"}),(0,i.jsxs)(n.td,{children:["FLOAT64",(0,i.jsx)("br",{}),"Alias: Float"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"BINARY"}),(0,i.jsxs)(n.td,{children:["BYTES",(0,i.jsx)("br",{}),"Alias: Bytes"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TIMESTAMP"}),(0,i.jsxs)(n.td,{children:["TIMESTAMP",(0,i.jsx)("br",{}),"Alias: Timestamp"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DATE"}),(0,i.jsxs)(n.td,{children:["DATE",(0,i.jsx)("br",{}),"Alias: Date"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"MAP"}),(0,i.jsxs)(n.td,{children:["JSON",(0,i.jsx)("br",{}),"Alias: JSON"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ARRAY"}),(0,i.jsxs)(n.td,{children:["ARRAY",(0,i.jsx)("br",{}),"Alias: Array"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"STRUCT"}),(0,i.jsxs)(n.td,{children:["STRUCT",(0,i.jsx)("br",{}),"Alias: Struct"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"VOID"}),(0,i.jsxs)(n.td,{children:["BYTES",(0,i.jsx)("br",{}),"Alias: Bytes"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"VARIANT"}),(0,i.jsxs)(n.td,{children:["STRUCT",(0,i.jsx)("br",{}),"Alias: Struct"]})]})]})]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Learn more in ",(0,i.jsx)(n.a,{href:"/analysts/data-types",children:"Supported data types"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"fetching-data",children:"Fetching data"}),"\n",(0,i.jsx)(n.p,{children:"Prophecy fetches data from Databricks connections in the following ways:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["When you browse a Databricks connection in the ",(0,i.jsx)(n.a,{href:"/analysts/pipelines",children:"Environment browser"}),", Prophecy fetches data on demand as you expand folders. You can manually refresh the Environment browser to see updated files."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"When a pipeline runs, Source gems will read the latest available version of the data. If the schema of your data in Databricks changes, Prophecy will automatically use the new schema."}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);