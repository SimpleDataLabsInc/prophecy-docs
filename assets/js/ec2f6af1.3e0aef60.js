"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[22499],{28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>c});var n=s(96540);const i={},r=n.createContext(i);function a(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(r.Provider,{value:t},e.children)}},61756:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>l,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"administration/fabrics/prophecy-fabrics/connections/databricks","title":"Databricks connection","description":"Learn how to connect with Databricks","source":"@site/docs/administration/fabrics/prophecy-fabrics/connections/databricks.md","sourceDirName":"administration/fabrics/prophecy-fabrics/connections","slug":"/administration/fabrics/prophecy-fabrics/connections/databricks","permalink":"/administration/fabrics/prophecy-fabrics/connections/databricks","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"connections","permalink":"/tags/connections"},{"inline":true,"label":"sql","permalink":"/tags/sql"},{"inline":true,"label":"databricks","permalink":"/tags/databricks"}],"version":"current","frontMatter":{"title":"Databricks connection","sidebar_label":"Databricks","id":"databricks","description":"Learn how to connect with Databricks","tags":["connections","sql","databricks"]},"sidebar":"adminSidebar","previous":{"title":"Azure Synapse","permalink":"/administration/fabrics/prophecy-fabrics/connections/synapse"},"next":{"title":"Google BigQuery","permalink":"/administration/fabrics/prophecy-fabrics/connections/bigquery"}}');var i=s(74848),r=s(28453);const a={title:"Databricks connection",sidebar_label:"Databricks",id:"databricks",description:"Learn how to connect with Databricks",tags:["connections","sql","databricks"]},c=void 0,o={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Connection type",id:"connection-type",level:2},{value:"Feature support",id:"feature-support",level:2},{value:"Connection parameters",id:"connection-parameters",level:2},{value:"Data type mapping",id:"data-type-mapping",level:2},{value:"Authentication methods",id:"authentication-methods",level:2},{value:"OAuth",id:"oauth",level:3},{value:"Choose the appropriate OAuth method",id:"choose-the-appropriate-oauth-method",level:4},{value:"Personal Access Token (PAT)",id:"personal-access-token-pat",level:3},{value:"Fetching data",id:"fetching-data",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"This page explains how to use and configure a Databricks connection in Prophecy. A Databricks connection allows Prophecy to access files, tables, and compute resources in your Databricks workspace. You can use the same connection to access any of these resources, as long as the authenticated account in the connection has the appropriate permissions."}),"\n",(0,i.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(t.p,{children:"Prophecy connects to Databricks using the credentials you provide. These credentials are used to authenticate your session and authorize all data operations during pipeline execution, including reading from and writing to tables. To use a Databricks connection effectively, your user or service principal must have the following:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://docs.databricks.com/aws/en/tables/#basic-table-permissions",children:"Basic table permissions"})," defined in the Databricks documentation."]}),"\n",(0,i.jsxs)(t.li,{children:["Additional ",(0,i.jsx)(t.a,{href:"https://docs.databricks.com/aws/en/data-governance/unity-catalog/manage-privileges/privileges",children:"Unity Catalog privileges"}),":","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"CREATE VOLUME"})," for permission to create the ",(0,i.jsx)(t.code,{children:"PROPHECY_ORCHESTRATOR_VOLUME"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"READ VOLUME"})," for the path ",(0,i.jsx)(t.code,{children:"/Volumes/<catalog>/<schema>/PROPHECY_ORCHESTRATOR_VOLUME"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"WRITE VOLUME"})," for permission to delete intermediate files from the volume"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"connection-type",children:"Connection type"}),"\n",(0,i.jsxs)(t.p,{children:["Prophecy supports Databricks as both a SQL Warehouse connection and an Ingress/Egress connection. To learn more about these different connection types, visit ",(0,i.jsx)(t.a,{href:"/administration/fabrics/prophecy-fabrics/#connections",children:"Prophecy fabrics"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"feature-support",children:"Feature support"}),"\n",(0,i.jsx)(t.p,{children:"The table below outlines whether the connection supports certain Prophecy features."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Feature"}),(0,i.jsx)(t.th,{children:"Supported"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Run SQL queries"}),(0,i.jsx)(t.td,{children:"Yes \u2014 SQL Warehouse Connection only"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsxs)(t.td,{children:["Read and write data with a ",(0,i.jsx)(t.a,{href:"/analysts/databricks-table",children:"Table gem"})]}),(0,i.jsx)(t.td,{children:"Yes \u2014 SQL Warehouse Connection only"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsxs)(t.td,{children:["Read data with a ",(0,i.jsx)(t.a,{href:"/analysts/databricks",children:"Source gem"})]}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsxs)(t.td,{children:["Write data with a ",(0,i.jsx)(t.a,{href:"/analysts/databricks",children:"Target gem"})]}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsxs)(t.td,{children:["Browse data in the ",(0,i.jsx)(t.a,{href:"/analysts/project-editor#sidebar",children:"Environment browser"})]}),(0,i.jsx)(t.td,{children:"Yes"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"connection-parameters",children:"Connection parameters"}),"\n",(0,i.jsx)(t.p,{children:"To create a connection with Databricks, enter the following parameters."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Parameter"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Connection Name"}),(0,i.jsx)(t.td,{children:"Name to identify your connection."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"JDBC URL"}),(0,i.jsxs)(t.td,{children:["URL to connect to your SQL warehouse",(0,i.jsx)("br",{}),"Example: ",(0,i.jsx)(t.code,{children:"jdbc:databricks://<databricks-instance>:443/default;transportMode=http;ssl=1;AuthMech=3;httpPath=/sql/1.0/warehouses/<warehouse-id>"})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Catalog"}),(0,i.jsx)(t.td,{children:"Default write location for target tables."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Schema"}),(0,i.jsx)(t.td,{children:"Default write location for target tables."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Authentication method"}),(0,i.jsxs)(t.td,{children:["How you want to authenticate your Databricks account. Learn more in ",(0,i.jsx)(t.a,{href:"#authentication-methods",children:"Authentication methods"}),"."]})]})]})]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:["When you use Databricks as your primary SQL warehouse, Prophecy also uses the catalog and schema you define in the connection to store temporary tables during ",(0,i.jsx)(t.a,{href:"/analysts/pipeline-execution#external-data-handling",children:"pipeline execution"}),". Therefore, you must have write access to the schema in Databricks. To avoid conflicts, define distinct catalog and schema locations for each fabric."]})}),"\n",(0,i.jsx)(t.h2,{id:"data-type-mapping",children:"Data type mapping"}),"\n",(0,i.jsx)(t.p,{children:"When Prophecy processes data from Databricks using an external SQL warehouse, it converts Databricks data types to compatible types."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Databricks"}),(0,i.jsx)(t.th,{children:"BigQuery"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"INT"}),(0,i.jsxs)(t.td,{children:["INT64",(0,i.jsx)("br",{}),"Alias: Integer"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"TINYINT"}),(0,i.jsxs)(t.td,{children:["INT64",(0,i.jsx)("br",{}),"Alias: Integer"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"SMALLINT"}),(0,i.jsxs)(t.td,{children:["INT64",(0,i.jsx)("br",{}),"Alias: Integer"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"BIGINT"}),(0,i.jsxs)(t.td,{children:["INT64",(0,i.jsx)("br",{}),"Alias: Integer"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"STRING"}),(0,i.jsxs)(t.td,{children:["STRING",(0,i.jsx)("br",{}),"Alias: String"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"BOOLEAN"}),(0,i.jsxs)(t.td,{children:["BOOL",(0,i.jsx)("br",{}),"Alias: Boolean"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"DECIMAL"}),(0,i.jsxs)(t.td,{children:["NUMERIC",(0,i.jsx)("br",{}),"Alias: Numeric"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"FLOAT"}),(0,i.jsxs)(t.td,{children:["FLOAT64",(0,i.jsx)("br",{}),"Alias: Float"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"DOUBLE"}),(0,i.jsxs)(t.td,{children:["FLOAT64",(0,i.jsx)("br",{}),"Alias: Float"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"BINARY"}),(0,i.jsxs)(t.td,{children:["BYTES",(0,i.jsx)("br",{}),"Alias: Bytes"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"TIMESTAMP"}),(0,i.jsxs)(t.td,{children:["TIMESTAMP",(0,i.jsx)("br",{}),"Alias: Timestamp"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"DATE"}),(0,i.jsxs)(t.td,{children:["DATE",(0,i.jsx)("br",{}),"Alias: Date"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"MAP"}),(0,i.jsxs)(t.td,{children:["JSON",(0,i.jsx)("br",{}),"Alias: JSON"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ARRAY"}),(0,i.jsxs)(t.td,{children:["ARRAY",(0,i.jsx)("br",{}),"Alias: Array"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"STRUCT"}),(0,i.jsxs)(t.td,{children:["STRUCT",(0,i.jsx)("br",{}),"Alias: Struct"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"VOID"}),(0,i.jsxs)(t.td,{children:["BYTES",(0,i.jsx)("br",{}),"Alias: Bytes"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"VARIANT"}),(0,i.jsxs)(t.td,{children:["STRUCT",(0,i.jsx)("br",{}),"Alias: Struct"]})]})]})]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:["Learn more in ",(0,i.jsx)(t.a,{href:"/analysts/data-types",children:"Supported data types"}),"."]})}),"\n",(0,i.jsx)(t.h2,{id:"authentication-methods",children:"Authentication methods"}),"\n",(0,i.jsx)(t.p,{children:"You can configure your Databricks connection using the following authentication methods."}),"\n",(0,i.jsx)(t.h3,{id:"oauth",children:"OAuth"}),"\n",(0,i.jsxs)(t.p,{children:["When you choose ",(0,i.jsx)(t.a,{href:"/databricks-oauth-authentication",children:"Databricks OAuth"})," for the authentication method, there are two modes."]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"OAuth Method"}),(0,i.jsx)(t.th,{children:"Description"}),(0,i.jsx)(t.th,{children:"Use cases"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"User"}),(0,i.jsx)(t.td,{children:"Each user signs in with their own Databricks account when prompted during interactive sessions."}),(0,i.jsx)(t.td,{children:"Development workflows, testing, or when real-time user interaction is needed."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Service Principal"}),(0,i.jsxs)(t.td,{children:["Prophecy uses a ",(0,i.jsx)(t.a,{href:"https://docs.databricks.com/aws/en/admin/users-groups/service-principals",children:"service principal"})," to authenticate without user interaction."]}),(0,i.jsx)(t.td,{children:"Automated or scheduled pipelines that require stable, long-term access without re-authentication interruptions."})]})]})]}),"\n",(0,i.jsx)(t.h4,{id:"choose-the-appropriate-oauth-method",children:"Choose the appropriate OAuth method"}),"\n",(0,i.jsxs)(t.p,{children:["We ",(0,i.jsx)(t.a,{href:"/administration/team-based-access",children:"recommend using separate fabrics"})," for development and production environments. Each fabric should use a different OAuth method to align with its purpose."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Development fabric"}),": Utilize user-based OAuth."]}),"\n",(0,i.jsx)(t.p,{children:"Developers authenticate using their own Databricks accounts so they only have access to the correct set of resources. Regular re-authentication enforces better security and reflects changes in individual user permissions."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Production fabric"}),": Use service principal-based OAuth."]}),"\n",(0,i.jsx)(t.p,{children:"For automated or scheduled pipelines, use a service principal to ensure uninterrupted access. Unlike user identities, service principals don't expire or become deactivated, so pipelines continue running reliably. Limit fabric access to trusted users, since all members share the service principal\u2019s credentials."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.admonition,{type:"info",children:[(0,i.jsx)(t.p,{children:"You can use User OAuth to schedule pipelines without service principal credentials. However, you'll need to periodically re-authenticate each Databricks connection in the fabric to keep schedules running."}),(0,i.jsx)(t.p,{children:"Because Prophecy can't retrieve the exact token expiration time from Databricks, it estimates when to prompt you for re-authentication. To avoid interruptions, we recommend switching to Service Principal OAuth when deploying projects to production."})]}),"\n",(0,i.jsx)(t.h3,{id:"personal-access-token-pat",children:"Personal Access Token (PAT)"}),"\n",(0,i.jsxs)(t.p,{children:["When you choose ",(0,i.jsx)(t.strong,{children:"Personal Access Token"})," (PAT) for the authentication method, you'll authenticate using a ",(0,i.jsx)(t.a,{href:"https://docs.databricks.com/aws/en/dev-tools/auth/pat",children:"Databricks personal access token"}),". When you set up the connection, you will use a ",(0,i.jsx)(t.a,{href:"/administration/secrets/",children:"secret"})," to enter your PAT."]}),"\n",(0,i.jsx)(t.p,{children:"Using the PAT authentication method:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"All team members who have access to the fabric can use the connection in their projects."}),"\n",(0,i.jsx)(t.li,{children:"No additional authentication is required. Team members automatically inherit the access and permissions of the stored connection credentials."}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"fetching-data",children:"Fetching data"}),"\n",(0,i.jsx)(t.p,{children:"Prophecy fetches data from Databricks connections in the following ways:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["When you browse a Databricks connection in the ",(0,i.jsx)(t.a,{href:"/analysts/pipelines",children:"Environment browser"}),", Prophecy fetches data on demand as you expand folders. You can manually refresh the Environment browser to see updated files."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"When a pipeline runs, Source gems will read the latest available version of the data. If the schema of your data in Databricks changes, Prophecy will automatically use the new schema."}),"\n"]}),"\n"]})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);