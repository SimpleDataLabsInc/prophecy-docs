"use strict";(self.webpackChunkdocs_4=self.webpackChunkdocs_4||[]).push([[26734],{28453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>c});var i=t(96540);const s={},n=i.createContext(s);function o(e){const r=i.useContext(n);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(n.Provider,{value:r},e.children)}},32323:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"analysts/development/gems/custom/script","title":"Script gem","description":"Leverage a Python script in your pipeline","source":"@site/docs/analysts/development/gems/custom/script.md","sourceDirName":"analysts/development/gems/custom","slug":"/analysts/script","permalink":"/analysts/script","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"gems","permalink":"/tags/gems"},{"inline":true,"label":"analyst","permalink":"/tags/analyst"},{"inline":true,"label":"custom","permalink":"/tags/custom"}],"version":"current","frontMatter":{"title":"Script gem","sidebar_label":"Script","id":"script","slug":"/analysts/script","description":"Leverage a Python script in your pipeline","tags":["gems","analyst","custom"]},"sidebar":"platformSidebar","previous":{"title":"RestAPI","permalink":"/analysts/rest-api"},"next":{"title":"StoredProcedure","permalink":"/analysts/stored-procedure-gem"}}');var s=t(74848),n=t(28453);const o={title:"Script gem",sidebar_label:"Script",id:"script",slug:"/analysts/script",description:"Leverage a Python script in your pipeline",tags:["gems","analyst","custom"]},c=void 0,a={},l=[{value:"Parameters",id:"parameters",level:2},{value:"Where the script runs",id:"where-the-script-runs",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Permission error with service principals",id:"permission-error-with-service-principals",level:3}];function d(e){const r={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.p,{children:"Use the Script gem to embed a custom Python script in your pipeline."}),"\n",(0,s.jsx)(r.admonition,{title:"Interactive Gem Example",type:"info",children:(0,s.jsxs)(r.p,{children:["The Script gem has a corresponding interactive gem example. See ",(0,s.jsx)(r.a,{href:"/analysts/gems#interactive-gem-examples",children:"Interactive gem examples"})," to learn how to run sample pipelines for this and other gems."]})}),"\n",(0,s.jsx)(r.h2,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Parameter"}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsx)(r.tbody,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Script"}),(0,s.jsx)(r.td,{children:"Where you will write your Python script"})]})})]}),"\n",(0,s.jsx)(r.admonition,{type:"info",children:(0,s.jsxs)(r.p,{children:["Number of inputs and outputs can be changed as needed by clicking the ",(0,s.jsx)(r.code,{children:"+"})," button on the respective tab."]})}),"\n",(0,s.jsx)(r.h2,{id:"where-the-script-runs",children:"Where the script runs"}),"\n",(0,s.jsxs)(r.p,{children:["The execution environment for the Script gem depends on the ",(0,s.jsx)(r.a,{href:"/administration/fabrics/prophecy-fabrics/#supported-primary-sql-warehouses",children:"SQL warehouse"})," configured in your Prophecy fabric."]}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"SQL warehouse provider"}),(0,s.jsx)(r.th,{children:"Execution environment"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Databricks"}),(0,s.jsx)(r.td,{children:"Databricks Serverless"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Prophecy In Memory"}),(0,s.jsx)(r.td,{children:"Prophecy Automate"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"BigQuery"}),(0,s.jsx)(r.td,{children:"Prophecy Automate"})]})]})]}),"\n",(0,s.jsx)(r.p,{children:"This ensures your Python logic runs in an environment optimized for your data platform."}),"\n",(0,s.jsx)(r.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(r.h3,{id:"permission-error-with-service-principals",children:"Permission error with service principals"}),"\n",(0,s.jsxs)(r.p,{children:["When using a fabric with ",(0,s.jsx)(r.a,{href:"/administration/fabrics/prophecy-fabrics/connections/databricks#oauth",children:"service principal authentication for Databricks"}),", you may encounter the following error:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"Failed due to: Unable to get run status for job id: INTERNAL_ERROR\nCannot read the python file dbfs:/prophecy_tmp/prophecy_script_gem_[uuid].py\nUser does not have permission SELECT on ANY File\n"})}),"\n",(0,s.jsx)(r.p,{children:"This occurs because the Script gem uploads Python scripts to DBFS for execution. Service principals require explicit permissions to read files from DBFS."}),"\n",(0,s.jsxs)(r.p,{children:["To solve this, contact your Databricks administrator for assistance. One workaround is to grant the service principal ",(0,s.jsx)(r.code,{children:"SELECT"})," permission on ",(0,s.jsx)(r.code,{children:"ANY FILE"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sql",children:"GRANT SELECT ON ANY FILE TO <your_service_principal_uuid>;\n"})}),"\n",(0,s.jsx)(r.admonition,{type:"caution",children:(0,s.jsxs)(r.p,{children:["Granting ",(0,s.jsx)(r.code,{children:"SELECT ON ANY FILE"})," provides broad read access to the file system. Consider the security implications for your environment before implementing this workaround."]})})]})}function p(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);